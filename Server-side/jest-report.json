{"numFailedTestSuites":19,"numFailedTests":241,"numPassedTestSuites":11,"numPassedTests":89,"numPendingTestSuites":1,"numPendingTests":10,"numRuntimeErrorTestSuites":2,"numTodoTests":0,"numTotalTestSuites":31,"numTotalTests":340,"openHandles":[],"snapshot":{"added":0,"didUpdate":false,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0},"startTime":1762160850945,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["离线支付服务测试 - 真实数据库","createOfflinePayment"],"duration":513,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service-real-db.test.js:27:16)"],"fullName":"离线支付服务测试 - 真实数据库 createOfflinePayment 应该成功创建离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功创建离线支付记录"},{"ancestorTitles":["离线支付服务测试 - 真实数据库","createOfflinePayment"],"duration":411,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service-real-db.test.js:27:16)"],"fullName":"离线支付服务测试 - 真实数据库 createOfflinePayment 应该在缺少必要参数时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在缺少必要参数时抛出错误"},{"ancestorTitles":["离线支付服务测试 - 真实数据库","createOfflinePayment"],"duration":392,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service-real-db.test.js:27:16)"],"fullName":"离线支付服务测试 - 真实数据库 createOfflinePayment 应该在账单不存在时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在账单不存在时抛出错误"},{"ancestorTitles":["离线支付服务测试 - 真实数据库","createOfflinePayment"],"duration":407,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service-real-db.test.js:27:16)"],"fullName":"离线支付服务测试 - 真实数据库 createOfflinePayment 应该在用户不存在时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不存在时抛出错误"},{"ancestorTitles":["离线支付服务测试 - 真实数据库","syncOfflinePayment"],"duration":500,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service-real-db.test.js:27:16)"],"fullName":"离线支付服务测试 - 真实数据库 syncOfflinePayment 应该成功同步离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功同步离线支付记录"},{"ancestorTitles":["离线支付服务测试 - 真实数据库","syncOfflinePayment"],"duration":482,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service-real-db.test.js:27:16)"],"fullName":"离线支付服务测试 - 真实数据库 syncOfflinePayment 应该在支付记录不存在时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录不存在时抛出错误"},{"ancestorTitles":["离线支付服务测试 - 真实数据库","syncOfflinePayment"],"duration":338,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service-real-db.test.js:27:16)"],"fullName":"离线支付服务测试 - 真实数据库 syncOfflinePayment 应该在支付记录状态不正确时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录状态不正确时抛出错误"},{"ancestorTitles":["离线支付服务测试 - 真实数据库","getUserOfflinePayments"],"duration":334,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service-real-db.test.js:27:16)"],"fullName":"离线支付服务测试 - 真实数据库 getUserOfflinePayments 应该成功获取用户离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户离线支付记录"},{"ancestorTitles":["离线支付服务测试 - 真实数据库","getUserOfflinePayments"],"duration":331,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service-real-db.test.js:27:16)"],"fullName":"离线支付服务测试 - 真实数据库 getUserOfflinePayments 应该正确处理分页","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该正确处理分页"},{"ancestorTitles":["离线支付服务测试 - 真实数据库","getUserOfflinePayments"],"duration":338,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service-real-db.test.js:27:16)"],"fullName":"离线支付服务测试 - 真实数据库 getUserOfflinePayments 应该根据状态筛选支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该根据状态筛选支付记录"}],"endTime":1762160856498,"message":"  ● 离线支付服务测试 - 真实数据库 › createOfflinePayment › 应该成功创建离线支付记录\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/offline-payment-service-real-db.test.js:27:16)\n\n  ● 离线支付服务测试 - 真实数据库 › createOfflinePayment › 应该在缺少必要参数时抛出错误\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/offline-payment-service-real-db.test.js:27:16)\n\n  ● 离线支付服务测试 - 真实数据库 › createOfflinePayment › 应该在账单不存在时抛出错误\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/offline-payment-service-real-db.test.js:27:16)\n\n  ● 离线支付服务测试 - 真实数据库 › createOfflinePayment › 应该在用户不存在时抛出错误\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/offline-payment-service-real-db.test.js:27:16)\n\n  ● 离线支付服务测试 - 真实数据库 › syncOfflinePayment › 应该成功同步离线支付记录\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/offline-payment-service-real-db.test.js:27:16)\n\n  ● 离线支付服务测试 - 真实数据库 › syncOfflinePayment › 应该在支付记录不存在时抛出错误\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/offline-payment-service-real-db.test.js:27:16)\n\n  ● 离线支付服务测试 - 真实数据库 › syncOfflinePayment › 应该在支付记录状态不正确时抛出错误\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/offline-payment-service-real-db.test.js:27:16)\n\n  ● 离线支付服务测试 - 真实数据库 › getUserOfflinePayments › 应该成功获取用户离线支付记录\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/offline-payment-service-real-db.test.js:27:16)\n\n  ● 离线支付服务测试 - 真实数据库 › getUserOfflinePayments › 应该正确处理分页\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/offline-payment-service-real-db.test.js:27:16)\n\n  ● 离线支付服务测试 - 真实数据库 › getUserOfflinePayments › 应该根据状态筛选支付记录\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/offline-payment-service-real-db.test.js:27:16)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service-real-db.test.js","startTime":1762160850989,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["支付流程优化控制器测试 - 真实数据库","createOfflinePayment"],"duration":430,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-optimization-controller-real-db.test.js:27:16)"],"fullName":"支付流程优化控制器测试 - 真实数据库 createOfflinePayment 应该成功创建离线支付","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功创建离线支付"},{"ancestorTitles":["支付流程优化控制器测试 - 真实数据库","createOfflinePayment"],"duration":351,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-optimization-controller-real-db.test.js:27:16)"],"fullName":"支付流程优化控制器测试 - 真实数据库 createOfflinePayment 应该在缺少必要参数时返回错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在缺少必要参数时返回错误"},{"ancestorTitles":["支付流程优化控制器测试 - 真实数据库","createOfflinePayment"],"duration":317,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-optimization-controller-real-db.test.js:27:16)"],"fullName":"支付流程优化控制器测试 - 真实数据库 createOfflinePayment 应该在账单不存在时返回错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在账单不存在时返回错误"},{"ancestorTitles":["支付流程优化控制器测试 - 真实数据库","syncOfflinePayment"],"duration":336,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-optimization-controller-real-db.test.js:27:16)"],"fullName":"支付流程优化控制器测试 - 真实数据库 syncOfflinePayment 应该成功同步离线支付","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功同步离线支付"},{"ancestorTitles":["支付流程优化控制器测试 - 真实数据库","syncOfflinePayment"],"duration":321,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-optimization-controller-real-db.test.js:27:16)"],"fullName":"支付流程优化控制器测试 - 真实数据库 syncOfflinePayment 应该在ID无效时返回错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在ID无效时返回错误"},{"ancestorTitles":["支付流程优化控制器测试 - 真实数据库","syncOfflinePayment"],"duration":301,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-optimization-controller-real-db.test.js:27:16)"],"fullName":"支付流程优化控制器测试 - 真实数据库 syncOfflinePayment 应该在支付记录不存在时返回错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录不存在时返回错误"},{"ancestorTitles":["支付流程优化控制器测试 - 真实数据库","getUserOfflinePayments"],"duration":346,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-optimization-controller-real-db.test.js:27:16)"],"fullName":"支付流程优化控制器测试 - 真实数据库 getUserOfflinePayments 应该成功获取用户离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户离线支付记录"},{"ancestorTitles":["支付流程优化控制器测试 - 真实数据库","getUserOfflinePayments"],"duration":295,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-optimization-controller-real-db.test.js:27:16)"],"fullName":"支付流程优化控制器测试 - 真实数据库 getUserOfflinePayments 应该正确处理分页","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该正确处理分页"},{"ancestorTitles":["支付流程优化控制器测试 - 真实数据库","getUserOfflinePayments"],"duration":291,"failureDetails":[{"name":"SequelizeValidationError","errors":[{"message":"users.password_hash cannot be null","type":"notNull Violation","path":"password_hash","value":null,"origin":"CORE","instance":{"dataValues":{"id":{"val":"gen_random_uuid()"},"username":"testuser","email":"test@example.com","name":"测试用户","updated_at":{},"created_at":{}},"_previousDataValues":{},"uniqno":1,"_changed":{},"_options":{"isNewRecord":true,"_schema":null,"_schemaDelimiter":""},"isNewRecord":true},"validatorKey":"is_null","validatorName":null,"validatorArgs":[]}]}],"failureMessages":["SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n    at InstanceValidator._validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:78:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at InstanceValidator._validateAndRunHooks (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:111:7)\n    at InstanceValidator.validate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\instance-validator.js:93:12)\n    at model.save (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:4077:7)\n    at Function.create (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2305:12)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-optimization-controller-real-db.test.js:27:16)"],"fullName":"支付流程优化控制器测试 - 真实数据库 getUserOfflinePayments 应该根据状态筛选支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该根据状态筛选支付记录"}],"endTime":1762160860362,"message":"  ● 支付流程优化控制器测试 - 真实数据库 › createOfflinePayment › 应该成功创建离线支付\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/payment-optimization-controller-real-db.test.js:27:16)\n\n  ● 支付流程优化控制器测试 - 真实数据库 › createOfflinePayment › 应该在缺少必要参数时返回错误\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/payment-optimization-controller-real-db.test.js:27:16)\n\n  ● 支付流程优化控制器测试 - 真实数据库 › createOfflinePayment › 应该在账单不存在时返回错误\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/payment-optimization-controller-real-db.test.js:27:16)\n\n  ● 支付流程优化控制器测试 - 真实数据库 › syncOfflinePayment › 应该成功同步离线支付\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/payment-optimization-controller-real-db.test.js:27:16)\n\n  ● 支付流程优化控制器测试 - 真实数据库 › syncOfflinePayment › 应该在ID无效时返回错误\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/payment-optimization-controller-real-db.test.js:27:16)\n\n  ● 支付流程优化控制器测试 - 真实数据库 › syncOfflinePayment › 应该在支付记录不存在时返回错误\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/payment-optimization-controller-real-db.test.js:27:16)\n\n  ● 支付流程优化控制器测试 - 真实数据库 › getUserOfflinePayments › 应该成功获取用户离线支付记录\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/payment-optimization-controller-real-db.test.js:27:16)\n\n  ● 支付流程优化控制器测试 - 真实数据库 › getUserOfflinePayments › 应该正确处理分页\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/payment-optimization-controller-real-db.test.js:27:16)\n\n  ● 支付流程优化控制器测试 - 真实数据库 › getUserOfflinePayments › 应该根据状态筛选支付记录\n\n    SequelizeValidationError: notNull Violation: users.password_hash cannot be null\n\n      25 |\n      26 |     // 创建测试用户\n    > 27 |     testUser = await models.User.create({\n         |                ^\n      28 |       username: 'testuser',\n      29 |       email: 'test@example.com',\n      30 |       password: 'password123',\n\n      at InstanceValidator._validate (node_modules/sequelize/src/instance-validator.js:78:13)\n      at InstanceValidator._validateAndRunHooks (node_modules/sequelize/src/instance-validator.js:111:7)\n      at InstanceValidator.validate (node_modules/sequelize/src/instance-validator.js:93:12)\n      at model.save (node_modules/sequelize/src/model.js:4077:7)\n      at Function.create (node_modules/sequelize/src/model.js:2305:12)\n      at Object.<anonymous> (tests/unit/payment-optimization-controller-real-db.test.js:27:16)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-optimization-controller-real-db.test.js","startTime":1762160856515,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["简单API集成测试","变量初始化测试"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toBeDefined()\n\nReceived: undefined","pass":false}}],"failureMessages":["Error: expect(received).toBeDefined()\n\nReceived: undefined\n    at Object.toBeDefined (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\simple.test.js:140:24)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"简单API集成测试 变量初始化测试 应该正确初始化所有测试变量","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"应该正确初始化所有测试变量"},{"ancestorTitles":["简单API集成测试","GET /api/rooms/:id"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"简单API集成测试 GET /api/rooms/:id 应该成功获取寝室详情","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"应该成功获取寝室详情"}],"endTime":1762160861535,"message":"  ● 简单API集成测试 › 变量初始化测试 › 应该正确初始化所有测试变量\n\n    expect(received).toBeDefined()\n\n    Received: undefined\n\n      138 |       expect(testUser).toBeDefined();\n      139 |       expect(testUser.id).toBeDefined();\n    > 140 |       expect(testRoom).toBeDefined();\n          |                        ^\n      141 |       expect(testRoom.id).toBeDefined();\n      142 |       expect(testRoomCode).toBeDefined();\n      143 |       expect(authToken).toBeDefined();\n\n      at Object.toBeDefined (tests/integration/simple.test.js:140:24)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\simple.test.js","startTime":1762160860374,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["RoomController单元测试","createRoom"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'mockResolvedValueOnce')\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:86:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"RoomController单元测试 createRoom 应该成功创建寝室","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功创建寝室"},{"ancestorTitles":["RoomController单元测试","createRoom"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).not.toHaveBeenCalled()\n\nExpected number of calls: 0\nReceived number of calls: 1\n\n1: called with 0 arguments","pass":true}}],"failureMessages":["Error: expect(jest.fn()).not.toHaveBeenCalled()\n\nExpected number of calls: 0\nReceived number of calls: 1\n\n1: called with 0 arguments\n    at Object.toHaveBeenCalled (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:150:36)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 createRoom 应该在缺少必填字段时返回400错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"应该在缺少必填字段时返回400错误"},{"ancestorTitles":["RoomController单元测试","createRoom"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'mockResolvedValueOnce')\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:162:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"RoomController单元测试 createRoom 应该在数据库错误时回滚事务并返回500错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在数据库错误时回滚事务并返回500错误"},{"ancestorTitles":["RoomController单元测试","getRooms"],"duration":6,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"data\": ObjectContaining {\"pagination\": ObjectContaining {\"limit\": 10, \"page\": 1, \"total\": 2, \"totalPages\": 1}, \"rooms\": ArrayContaining [ObjectContaining {\"id\": 1, \"name\": \"测试寝室1\"}]}, \"message\": \"获取寝室列表成功\", \"success\": true}\nReceived: {\"data\": {\"pagination\": {\"limit\": 10, \"page\": 1, \"total\": 0, \"totalPages\": 0}, \"rooms\": []}, \"message\": \"获取寝室列表成功\", \"success\": true}\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"data\": ObjectContaining {\"pagination\": ObjectContaining {\"limit\": 10, \"page\": 1, \"total\": 2, \"totalPages\": 1}, \"rooms\": ArrayContaining [ObjectContaining {\"id\": 1, \"name\": \"测试寝室1\"}]}, \"message\": \"获取寝室列表成功\", \"success\": true}\nReceived: {\"data\": {\"pagination\": {\"limit\": 10, \"page\": 1, \"total\": 0, \"totalPages\": 0}, \"rooms\": []}, \"message\": \"获取寝室列表成功\", \"success\": true}\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:231:28)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 getRooms 应该成功获取寝室列表","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"应该成功获取寝室列表"},{"ancestorTitles":["RoomController单元测试","getRooms"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\nExpected number of calls: 2\nReceived number of calls: 0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\nExpected number of calls: 2\nReceived number of calls: 0\n    at Object.toHaveBeenCalledTimes (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:273:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 getRooms 应该支持按状态筛选寝室","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该支持按状态筛选寝室"},{"ancestorTitles":["RoomController单元测试","getRoomById"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 200\nReceived: 500\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 200\nReceived: 500\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:305:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 getRoomById 应该成功获取寝室详情","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取寝室详情"},{"ancestorTitles":["RoomController单元测试","getRoomById"],"duration":189,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 404\nReceived: 500\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 404\nReceived: 500\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:329:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 getRoomById 应该在寝室不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在寝室不存在时返回404错误"},{"ancestorTitles":["RoomController单元测试","updateRoom"],"duration":75,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 200\nReceived: 500\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 200\nReceived: 500\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:358:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 updateRoom 应该成功更新寝室信息","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功更新寝室信息"},{"ancestorTitles":["RoomController单元测试","updateRoom"],"duration":96,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 404\nReceived: 500\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 404\nReceived: 500\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:383:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 updateRoom 应该在寝室不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在寝室不存在时返回404错误"},{"ancestorTitles":["RoomController单元测试","updateRoom"],"duration":73,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 403\nReceived: 500\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 403\nReceived: 500\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:405:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 updateRoom 应该在用户不是寝室创建者时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不是寝室创建者时返回403错误"},{"ancestorTitles":["RoomController单元测试","joinRoom"],"duration":97,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 200\nReceived: 404\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 200\nReceived: 404\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:432:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 joinRoom 应该成功通过邀请码加入寝室","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功通过邀请码加入寝室"},{"ancestorTitles":["RoomController单元测试","joinRoom"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"RoomController单元测试 joinRoom 应该在邀请码无效时返回404错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该在邀请码无效时返回404错误"},{"ancestorTitles":["RoomController单元测试","joinRoom"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 409\nReceived: 404\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 409\nReceived: 404\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:475:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 joinRoom 应该在用户已加入寝室时返回409错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户已加入寝室时返回409错误"},{"ancestorTitles":["RoomController单元测试","joinRoom"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 409\nReceived: 404\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 409\nReceived: 404\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:499:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 joinRoom 应该在寝室成员已满时返回409错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在寝室成员已满时返回409错误"},{"ancestorTitles":["RoomController单元测试","leaveRoom"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 200\nReceived: 500\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 200\nReceived: 500\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:525:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 leaveRoom 应该成功退出寝室","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功退出寝室"},{"ancestorTitles":["RoomController单元测试","leaveRoom"],"duration":72,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 404\nReceived: 500\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 404\nReceived: 500\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:545:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 leaveRoom 应该在寝室不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在寝室不存在时返回404错误"},{"ancestorTitles":["RoomController单元测试","leaveRoom"],"duration":75,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 400\nReceived: 500\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 400\nReceived: 500\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:568:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 leaveRoom 应该在用户不是寝室成员时返回400错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不是寝室成员时返回400错误"},{"ancestorTitles":["RoomController单元测试","leaveRoom"],"duration":110,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 400\nReceived: 500\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 400\nReceived: 500\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:591:30)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"RoomController单元测试 leaveRoom 应该在用户是寝室创建者时返回400错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户是寝室创建者时返回400错误"},{"ancestorTitles":["RoomController单元测试","getRoomMembers"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: roomController.getRoomMembers is not a function\n    at Object.getRoomMembers (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:633:28)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"RoomController单元测试 getRoomMembers 应该成功获取寝室成员列表","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取寝室成员列表"},{"ancestorTitles":["RoomController单元测试","getRoomMembers"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: roomController.getRoomMembers is not a function\n    at Object.getRoomMembers (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:663:28)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"RoomController单元测试 getRoomMembers 应该在用户不是寝室成员时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不是寝室成员时返回403错误"},{"ancestorTitles":["RoomController单元测试","removeMember"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: roomController.removeMember is not a function\n    at Object.removeMember (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:689:28)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"RoomController单元测试 removeMember 应该成功移除寝室成员","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功移除寝室成员"},{"ancestorTitles":["RoomController单元测试","removeMember"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: roomController.removeMember is not a function\n    at Object.removeMember (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:710:28)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"RoomController单元测试 removeMember 应该在用户不是寝室创建者时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不是寝室创建者时返回403错误"},{"ancestorTitles":["RoomController单元测试","removeMember"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: roomController.removeMember is not a function\n    at Object.removeMember (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js:731:28)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"RoomController单元测试 removeMember 应该在尝试移除创建者时返回400错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在尝试移除创建者时返回400错误"}],"endTime":1762160862827,"message":"  ● RoomController单元测试 › createRoom › 应该成功创建寝室\n\n    TypeError: Cannot read properties of undefined (reading 'mockResolvedValueOnce')\n\n      84 |       // 模拟数据库查询结果\n      85 |       mockClient.query\n    > 86 |         .mockResolvedValueOnce({}) // BEGIN\n         |          ^\n      87 |         .mockResolvedValueOnce({ rows: [{ id: 1, name: '测试寝室' }] }) // 插入寝室\n      88 |         .mockResolvedValueOnce({}) // 插入用户寝室关系\n      89 |         .mockResolvedValueOnce({}) // 更新用户角色\n\n      at Object.mockResolvedValueOnce (tests/unit/room-controller.test.js:86:10)\n\n  ● RoomController单元测试 › createRoom › 应该在缺少必填字段时返回400错误\n\n    expect(jest.fn()).not.toHaveBeenCalled()\n\n    Expected number of calls: 0\n    Received number of calls: 1\n\n    1: called with 0 arguments\n\n      148 |       \n      149 |       // 验证数据库连接未被调用\n    > 150 |       expect(mockPool.connect).not.toHaveBeenCalled();\n          |                                    ^\n      151 |     });\n      152 |     \n      153 |     it('应该在数据库错误时回滚事务并返回500错误', async () => {\n\n      at Object.toHaveBeenCalled (tests/unit/room-controller.test.js:150:36)\n\n  ● RoomController单元测试 › createRoom › 应该在数据库错误时回滚事务并返回500错误\n\n    TypeError: Cannot read properties of undefined (reading 'mockResolvedValueOnce')\n\n      160 |       // 模拟数据库错误\n      161 |       mockClient.query\n    > 162 |         .mockResolvedValueOnce({}) // BEGIN\n          |          ^\n      163 |         .mockRejectedValueOnce(new Error('数据库连接错误')); // 插入寝室失败\n      164 |       \n      165 |       // 模拟ROLLBACK\n\n      at Object.mockResolvedValueOnce (tests/unit/room-controller.test.js:162:10)\n\n  ● RoomController单元测试 › getRooms › 应该成功获取寝室列表\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: ObjectContaining {\"data\": ObjectContaining {\"pagination\": ObjectContaining {\"limit\": 10, \"page\": 1, \"total\": 2, \"totalPages\": 1}, \"rooms\": ArrayContaining [ObjectContaining {\"id\": 1, \"name\": \"测试寝室1\"}]}, \"message\": \"获取寝室列表成功\", \"success\": true}\n    Received: {\"data\": {\"pagination\": {\"limit\": 10, \"page\": 1, \"total\": 0, \"totalPages\": 0}, \"rooms\": []}, \"message\": \"获取寝室列表成功\", \"success\": true}\n\n    Number of calls: 1\n\n      229 |       // 验证响应\n      230 |       expect(mockRes.status).toHaveBeenCalledWith(200);\n    > 231 |       expect(mockRes.json).toHaveBeenCalledWith(\n          |                            ^\n      232 |         expect.objectContaining({\n      233 |           success: true,\n      234 |           message: '获取寝室列表成功',\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:231:28)\n\n  ● RoomController单元测试 › getRooms › 应该支持按状态筛选寝室\n\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\n\n    Expected number of calls: 2\n    Received number of calls: 0\n\n      271 |       \n      272 |       // 验证数据库查询被调用\n    > 273 |       expect(mockPool.query).toHaveBeenCalledTimes(2);\n          |                              ^\n      274 |       \n      275 |       // 验证查询包含状态筛选\n      276 |       expect(mockPool.query.mock.calls[0][0]).toContain('r.status = $1');\n\n      at Object.toHaveBeenCalledTimes (tests/unit/room-controller.test.js:273:30)\n\n  ● RoomController单元测试 › getRoomById › 应该成功获取寝室详情\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 200\n    Received: 500\n\n    Number of calls: 1\n\n      303 |       \n      304 |       // 验证响应\n    > 305 |       expect(mockRes.status).toHaveBeenCalledWith(200);\n          |                              ^\n      306 |       expect(mockRes.json).toHaveBeenCalledWith(\n      307 |         expect.objectContaining({\n      308 |           success: true,\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:305:30)\n\n  ● RoomController单元测试 › getRoomById › 应该在寝室不存在时返回404错误\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 404\n    Received: 500\n\n    Number of calls: 1\n\n      327 |       \n      328 |       // 验证响应\n    > 329 |       expect(mockRes.status).toHaveBeenCalledWith(404);\n          |                              ^\n      330 |       expect(mockRes.json).toHaveBeenCalledWith(\n      331 |         expect.objectContaining({\n      332 |           success: false,\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:329:30)\n\n  ● RoomController单元测试 › updateRoom › 应该成功更新寝室信息\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 200\n    Received: 500\n\n    Number of calls: 1\n\n      356 |       \n      357 |       // 验证响应\n    > 358 |       expect(mockRes.status).toHaveBeenCalledWith(200);\n          |                              ^\n      359 |       expect(mockRes.json).toHaveBeenCalledWith(\n      360 |         expect.objectContaining({\n      361 |           success: true,\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:358:30)\n\n  ● RoomController单元测试 › updateRoom › 应该在寝室不存在时返回404错误\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 404\n    Received: 500\n\n    Number of calls: 1\n\n      381 |       \n      382 |       // 验证响应\n    > 383 |       expect(mockRes.status).toHaveBeenCalledWith(404);\n          |                              ^\n      384 |       expect(mockRes.json).toHaveBeenCalledWith(\n      385 |         expect.objectContaining({\n      386 |           success: false,\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:383:30)\n\n  ● RoomController单元测试 › updateRoom › 应该在用户不是寝室创建者时返回403错误\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 403\n    Received: 500\n\n    Number of calls: 1\n\n      403 |       \n      404 |       // 验证响应\n    > 405 |       expect(mockRes.status).toHaveBeenCalledWith(403);\n          |                              ^\n      406 |       expect(mockRes.json).toHaveBeenCalledWith(\n      407 |         expect.objectContaining({\n      408 |           success: false,\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:405:30)\n\n  ● RoomController单元测试 › joinRoom › 应该成功通过邀请码加入寝室\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 200\n    Received: 404\n\n    Number of calls: 1\n\n      430 |       \n      431 |       // 验证响应\n    > 432 |       expect(mockRes.status).toHaveBeenCalledWith(200);\n          |                              ^\n      433 |       expect(mockRes.json).toHaveBeenCalledWith(\n      434 |         expect.objectContaining({\n      435 |           success: true,\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:432:30)\n\n  ● RoomController单元测试 › joinRoom › 应该在用户已加入寝室时返回409错误\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 409\n    Received: 404\n\n    Number of calls: 1\n\n      473 |       \n      474 |       // 验证响应\n    > 475 |       expect(mockRes.status).toHaveBeenCalledWith(409);\n          |                              ^\n      476 |       expect(mockRes.json).toHaveBeenCalledWith(\n      477 |         expect.objectContaining({\n      478 |           success: false,\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:475:30)\n\n  ● RoomController单元测试 › joinRoom › 应该在寝室成员已满时返回409错误\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 409\n    Received: 404\n\n    Number of calls: 1\n\n      497 |       \n      498 |       // 验证响应\n    > 499 |       expect(mockRes.status).toHaveBeenCalledWith(409);\n          |                              ^\n      500 |       expect(mockRes.json).toHaveBeenCalledWith(\n      501 |         expect.objectContaining({\n      502 |           success: false,\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:499:30)\n\n  ● RoomController单元测试 › leaveRoom › 应该成功退出寝室\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 200\n    Received: 500\n\n    Number of calls: 1\n\n      523 |       \n      524 |       // 验证响应\n    > 525 |       expect(mockRes.status).toHaveBeenCalledWith(200);\n          |                              ^\n      526 |       expect(mockRes.json).toHaveBeenCalledWith(\n      527 |         expect.objectContaining({\n      528 |           success: true,\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:525:30)\n\n  ● RoomController单元测试 › leaveRoom › 应该在寝室不存在时返回404错误\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 404\n    Received: 500\n\n    Number of calls: 1\n\n      543 |       \n      544 |       // 验证响应\n    > 545 |       expect(mockRes.status).toHaveBeenCalledWith(404);\n          |                              ^\n      546 |       expect(mockRes.json).toHaveBeenCalledWith(\n      547 |         expect.objectContaining({\n      548 |           success: false,\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:545:30)\n\n  ● RoomController单元测试 › leaveRoom › 应该在用户不是寝室成员时返回400错误\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 400\n    Received: 500\n\n    Number of calls: 1\n\n      566 |       \n      567 |       // 验证响应\n    > 568 |       expect(mockRes.status).toHaveBeenCalledWith(400);\n          |                              ^\n      569 |       expect(mockRes.json).toHaveBeenCalledWith(\n      570 |         expect.objectContaining({\n      571 |           success: false,\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:568:30)\n\n  ● RoomController单元测试 › leaveRoom › 应该在用户是寝室创建者时返回400错误\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 400\n    Received: 500\n\n    Number of calls: 1\n\n      589 |       \n      590 |       // 验证响应\n    > 591 |       expect(mockRes.status).toHaveBeenCalledWith(400);\n          |                              ^\n      592 |       expect(mockRes.json).toHaveBeenCalledWith(\n      593 |         expect.objectContaining({\n      594 |           success: false,\n\n      at Object.toHaveBeenCalledWith (tests/unit/room-controller.test.js:591:30)\n\n  ● RoomController单元测试 › getRoomMembers › 应该成功获取寝室成员列表\n\n    TypeError: roomController.getRoomMembers is not a function\n\n      631 |       \n      632 |       // 调用控制器方法\n    > 633 |       await roomController.getRoomMembers(mockReq, mockRes);\n          |                            ^\n      634 |       \n      635 |       // 验证响应\n      636 |       expect(mockRes.status).toHaveBeenCalledWith(200);\n\n      at Object.getRoomMembers (tests/unit/room-controller.test.js:633:28)\n\n  ● RoomController单元测试 › getRoomMembers › 应该在用户不是寝室成员时返回403错误\n\n    TypeError: roomController.getRoomMembers is not a function\n\n      661 |       \n      662 |       // 调用控制器方法\n    > 663 |       await roomController.getRoomMembers(mockReq, mockRes);\n          |                            ^\n      664 |       \n      665 |       // 验证响应\n      666 |       expect(mockRes.status).toHaveBeenCalledWith(403);\n\n      at Object.getRoomMembers (tests/unit/room-controller.test.js:663:28)\n\n  ● RoomController单元测试 › removeMember › 应该成功移除寝室成员\n\n    TypeError: roomController.removeMember is not a function\n\n      687 |       \n      688 |       // 调用控制器方法\n    > 689 |       await roomController.removeMember(mockReq, mockRes);\n          |                            ^\n      690 |       \n      691 |       // 验证响应\n      692 |       expect(mockRes.status).toHaveBeenCalledWith(200);\n\n      at Object.removeMember (tests/unit/room-controller.test.js:689:28)\n\n  ● RoomController单元测试 › removeMember › 应该在用户不是寝室创建者时返回403错误\n\n    TypeError: roomController.removeMember is not a function\n\n      708 |       \n      709 |       // 调用控制器方法\n    > 710 |       await roomController.removeMember(mockReq, mockRes);\n          |                            ^\n      711 |       \n      712 |       // 验证响应\n      713 |       expect(mockRes.status).toHaveBeenCalledWith(403);\n\n      at Object.removeMember (tests/unit/room-controller.test.js:710:28)\n\n  ● RoomController单元测试 › removeMember › 应该在尝试移除创建者时返回400错误\n\n    TypeError: roomController.removeMember is not a function\n\n      729 |       \n      730 |       // 调用控制器方法\n    > 731 |       await roomController.removeMember(mockReq, mockRes);\n          |                            ^\n      732 |       \n      733 |       // 验证响应\n      734 |       expect(mockRes.status).toHaveBeenCalledWith(400);\n\n      at Object.removeMember (tests/unit/room-controller.test.js:731:28)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\room-controller.test.js","startTime":1762160861545,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["寝室API集成测试 - 简化版","变量初始化测试"],"duration":0,"failureDetails":[{}],"failureMessages":["Error: 寝室创建失败: 服务器内部错误\n    at createTestRoom (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\simple-rooms.test.js:91:11)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\simple-rooms.test.js:120:18)"],"fullName":"寝室API集成测试 - 简化版 变量初始化测试 应该正确初始化所有测试变量","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该正确初始化所有测试变量"},{"ancestorTitles":["寝室API集成测试 - 简化版","GET /api/rooms"],"duration":0,"failureDetails":[{}],"failureMessages":["Error: 寝室创建失败: 服务器内部错误\n    at createTestRoom (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\simple-rooms.test.js:91:11)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\simple-rooms.test.js:120:18)"],"fullName":"寝室API集成测试 - 简化版 GET /api/rooms 应该成功获取用户寝室列表","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户寝室列表"},{"ancestorTitles":["寝室API集成测试 - 简化版","GET /api/rooms/:id"],"duration":0,"failureDetails":[{}],"failureMessages":["Error: 寝室创建失败: 服务器内部错误\n    at createTestRoom (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\simple-rooms.test.js:91:11)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\simple-rooms.test.js:120:18)"],"fullName":"寝室API集成测试 - 简化版 GET /api/rooms/:id 应该成功获取寝室详情","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取寝室详情"}],"endTime":1762160863871,"message":"  ● 寝室API集成测试 - 简化版 › 变量初始化测试 › 应该正确初始化所有测试变量\n\n    寝室创建失败: 服务器内部错误\n\n      89 |   if (response.status !== 201) {\n      90 |     console.error('寝室创建失败:', response.body);\n    > 91 |     throw new Error(`寝室创建失败: ${response.body.message}`);\n         |           ^\n      92 |   }\n      93 |   \n      94 |   console.log('寝室创建成功:', response.body.data);\n\n      at createTestRoom (tests/integration/simple-rooms.test.js:91:11)\n      at Object.<anonymous> (tests/integration/simple-rooms.test.js:120:18)\n\n  ● 寝室API集成测试 - 简化版 › GET /api/rooms › 应该成功获取用户寝室列表\n\n    寝室创建失败: 服务器内部错误\n\n      89 |   if (response.status !== 201) {\n      90 |     console.error('寝室创建失败:', response.body);\n    > 91 |     throw new Error(`寝室创建失败: ${response.body.message}`);\n         |           ^\n      92 |   }\n      93 |   \n      94 |   console.log('寝室创建成功:', response.body.data);\n\n      at createTestRoom (tests/integration/simple-rooms.test.js:91:11)\n      at Object.<anonymous> (tests/integration/simple-rooms.test.js:120:18)\n\n  ● 寝室API集成测试 - 简化版 › GET /api/rooms/:id › 应该成功获取寝室详情\n\n    寝室创建失败: 服务器内部错误\n\n      89 |   if (response.status !== 201) {\n      90 |     console.error('寝室创建失败:', response.body);\n    > 91 |     throw new Error(`寝室创建失败: ${response.body.message}`);\n         |           ^\n      92 |   }\n      93 |   \n      94 |   console.log('寝室创建成功:', response.body.data);\n\n      at createTestRoom (tests/integration/simple-rooms.test.js:91:11)\n      at Object.<anonymous> (tests/integration/simple-rooms.test.js:120:18)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\simple-rooms.test.js","startTime":1762160862843,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["离线支付功能集成测试","创建离线支付记录"],"duration":0,"failureDetails":[{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"离线支付功能集成测试 创建离线支付记录 应该成功创建离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功创建离线支付记录"},{"ancestorTitles":["离线支付功能集成测试","创建离线支付记录"],"duration":0,"failureDetails":[{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"离线支付功能集成测试 创建离线支付记录 应该在缺少必要参数时返回错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在缺少必要参数时返回错误"},{"ancestorTitles":["离线支付功能集成测试","创建离线支付记录"],"duration":0,"failureDetails":[{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"离线支付功能集成测试 创建离线支付记录 应该在账单不存在时返回错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在账单不存在时返回错误"},{"ancestorTitles":["离线支付功能集成测试","获取用户离线支付记录"],"duration":0,"failureDetails":[{},{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)","TypeError: Cannot read properties of undefined (reading 'id')\n    at Object.id (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:227:26)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付功能集成测试 获取用户离线支付记录 应该成功获取用户离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户离线支付记录"},{"ancestorTitles":["离线支付功能集成测试","获取用户离线支付记录"],"duration":0,"failureDetails":[{},{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)","TypeError: Cannot read properties of undefined (reading 'id')\n    at Object.id (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:227:26)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付功能集成测试 获取用户离线支付记录 应该支持按状态筛选离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该支持按状态筛选离线支付记录"},{"ancestorTitles":["离线支付功能集成测试","获取待同步的离线支付记录"],"duration":0,"failureDetails":[{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"离线支付功能集成测试 获取待同步的离线支付记录 应该成功获取待同步的离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取待同步的离线支付记录"},{"ancestorTitles":["离线支付功能集成测试","标记支付同步失败"],"duration":0,"failureDetails":[{},{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)","TypeError: Cannot read properties of undefined (reading 'id')\n    at Object.id (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:329:26)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付功能集成测试 标记支付同步失败 应该成功标记支付同步失败","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功标记支付同步失败"},{"ancestorTitles":["离线支付功能集成测试","标记支付同步失败"],"duration":0,"failureDetails":[{},{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)","TypeError: Cannot read properties of undefined (reading 'id')\n    at Object.id (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:329:26)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付功能集成测试 标记支付同步失败 应该在支付记录不存在时返回错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录不存在时返回错误"},{"ancestorTitles":["离线支付功能集成测试","重试同步失败的支付记录"],"duration":0,"failureDetails":[{},{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)","TypeError: Cannot read properties of undefined (reading 'id')\n    at Object.id (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:387:26)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付功能集成测试 重试同步失败的支付记录 应该成功重试同步失败的支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功重试同步失败的支付记录"},{"ancestorTitles":["离线支付功能集成测试","重试同步失败的支付记录"],"duration":0,"failureDetails":[{},{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)","TypeError: Cannot read properties of undefined (reading 'id')\n    at Object.id (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:387:26)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付功能集成测试 重试同步失败的支付记录 应该在支付记录不存在时返回错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录不存在时返回错误"},{"ancestorTitles":["离线支付功能集成测试","重试同步失败的支付记录"],"duration":0,"failureDetails":[{},{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)","TypeError: Cannot read properties of undefined (reading 'id')\n    at Object.id (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:387:26)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付功能集成测试 重试同步失败的支付记录 应该在支付记录状态不正确时返回错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录状态不正确时返回错误"},{"ancestorTitles":["离线支付功能集成测试","同步离线支付记录"],"duration":0,"failureDetails":[{},{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)","TypeError: Cannot read properties of undefined (reading 'id')\n    at Object.id (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:480:26)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付功能集成测试 同步离线支付记录 应该成功同步离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功同步离线支付记录"},{"ancestorTitles":["离线支付功能集成测试","同步离线支付记录"],"duration":0,"failureDetails":[{},{}],"failureMessages":["Error: 房间创建失败，状态码: 500\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:69:13)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)","TypeError: Cannot read properties of undefined (reading 'id')\n    at Object.id (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js:480:26)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付功能集成测试 同步离线支付记录 应该在支付记录不存在时返回错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录不存在时返回错误"}],"endTime":1762160864745,"message":"  ● 离线支付功能集成测试 › 创建离线支付记录 › 应该成功创建离线支付记录\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 创建离线支付记录 › 应该在缺少必要参数时返回错误\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 创建离线支付记录 › 应该在账单不存在时返回错误\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 获取用户离线支付记录 › 应该成功获取用户离线支付记录\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 获取用户离线支付记录 › 应该成功获取用户离线支付记录\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      225 |       // 创建一个离线支付记录用于测试\n      226 |       const paymentData = {\n    > 227 |         billId: testBill.id,\n          |                          ^\n      228 |         amount: 50.00,\n      229 |         paymentMethod: 'alipay',\n      230 |         note: '获取记录测试',\n\n      at Object.id (tests/integration/offline-payments.test.js:227:26)\n\n  ● 离线支付功能集成测试 › 获取用户离线支付记录 › 应该支持按状态筛选离线支付记录\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 获取用户离线支付记录 › 应该支持按状态筛选离线支付记录\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      225 |       // 创建一个离线支付记录用于测试\n      226 |       const paymentData = {\n    > 227 |         billId: testBill.id,\n          |                          ^\n      228 |         amount: 50.00,\n      229 |         paymentMethod: 'alipay',\n      230 |         note: '获取记录测试',\n\n      at Object.id (tests/integration/offline-payments.test.js:227:26)\n\n  ● 离线支付功能集成测试 › 获取待同步的离线支付记录 › 应该成功获取待同步的离线支付记录\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 标记支付同步失败 › 应该成功标记支付同步失败\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 标记支付同步失败 › 应该成功标记支付同步失败\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      327 |       // 创建一个离线支付记录用于测试\n      328 |       const paymentData = {\n    > 329 |         billId: testBill.id,\n          |                          ^\n      330 |         amount: 75.00,\n      331 |         paymentMethod: 'wechat',\n      332 |         note: '同步失败测试',\n\n      at Object.id (tests/integration/offline-payments.test.js:329:26)\n\n  ● 离线支付功能集成测试 › 标记支付同步失败 › 应该在支付记录不存在时返回错误\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 标记支付同步失败 › 应该在支付记录不存在时返回错误\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      327 |       // 创建一个离线支付记录用于测试\n      328 |       const paymentData = {\n    > 329 |         billId: testBill.id,\n          |                          ^\n      330 |         amount: 75.00,\n      331 |         paymentMethod: 'wechat',\n      332 |         note: '同步失败测试',\n\n      at Object.id (tests/integration/offline-payments.test.js:329:26)\n\n  ● 离线支付功能集成测试 › 重试同步失败的支付记录 › 应该成功重试同步失败的支付记录\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 重试同步失败的支付记录 › 应该成功重试同步失败的支付记录\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      385 |       // 创建一个离线支付记录并标记为同步失败\n      386 |       const paymentData = {\n    > 387 |         billId: testBill.id,\n          |                          ^\n      388 |         amount: 25.00,\n      389 |         paymentMethod: 'bank_transfer',\n      390 |         note: '重试同步测试',\n\n      at Object.id (tests/integration/offline-payments.test.js:387:26)\n\n  ● 离线支付功能集成测试 › 重试同步失败的支付记录 › 应该在支付记录不存在时返回错误\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 重试同步失败的支付记录 › 应该在支付记录不存在时返回错误\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      385 |       // 创建一个离线支付记录并标记为同步失败\n      386 |       const paymentData = {\n    > 387 |         billId: testBill.id,\n          |                          ^\n      388 |         amount: 25.00,\n      389 |         paymentMethod: 'bank_transfer',\n      390 |         note: '重试同步测试',\n\n      at Object.id (tests/integration/offline-payments.test.js:387:26)\n\n  ● 离线支付功能集成测试 › 重试同步失败的支付记录 › 应该在支付记录状态不正确时返回错误\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 重试同步失败的支付记录 › 应该在支付记录状态不正确时返回错误\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      385 |       // 创建一个离线支付记录并标记为同步失败\n      386 |       const paymentData = {\n    > 387 |         billId: testBill.id,\n          |                          ^\n      388 |         amount: 25.00,\n      389 |         paymentMethod: 'bank_transfer',\n      390 |         note: '重试同步测试',\n\n      at Object.id (tests/integration/offline-payments.test.js:387:26)\n\n  ● 离线支付功能集成测试 › 同步离线支付记录 › 应该成功同步离线支付记录\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 同步离线支付记录 › 应该成功同步离线支付记录\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      478 |       // 创建一个离线支付记录用于测试\n      479 |       const paymentData = {\n    > 480 |         billId: testBill.id,\n          |                          ^\n      481 |         amount: 35.00,\n      482 |         paymentMethod: 'cash',\n      483 |         note: '同步测试',\n\n      at Object.id (tests/integration/offline-payments.test.js:480:26)\n\n  ● 离线支付功能集成测试 › 同步离线支付记录 › 应该在支付记录不存在时返回错误\n\n    房间创建失败，状态码: 500\n\n      67 |     \n      68 |     if (roomResponse.status !== 201) {\n    > 69 |       throw new Error(`房间创建失败，状态码: ${roomResponse.status}`);\n         |             ^\n      70 |     }\n      71 |     \n      72 |     testRoom = roomResponse.body.data;\n\n      at Object.<anonymous> (tests/integration/offline-payments.test.js:69:13)\n\n  ● 离线支付功能集成测试 › 同步离线支付记录 › 应该在支付记录不存在时返回错误\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      478 |       // 创建一个离线支付记录用于测试\n      479 |       const paymentData = {\n    > 480 |         billId: testBill.id,\n          |                          ^\n      481 |         amount: 35.00,\n      482 |         paymentMethod: 'cash',\n      483 |         note: '同步测试',\n\n      at Object.id (tests/integration/offline-payments.test.js:480:26)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\offline-payments.test.js","startTime":1762160863882,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["支付提醒服务测试","createPaymentReminder"],"duration":1,"failureDetails":[{}],"failureMessages":["Error: 缺少必要参数\n    at Object.createPaymentReminder (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:37:13)\n    at Object.createPaymentReminder (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:54:51)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付提醒服务测试 createPaymentReminder 应该成功创建支付提醒","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功创建支付提醒"},{"ancestorTitles":["支付提醒服务测试","createPaymentReminder"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"支付提醒服务测试 createPaymentReminder 应该在缺少必要参数时抛出错误","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"应该在缺少必要参数时抛出错误"},{"ancestorTitles":["支付提醒服务测试","createPaymentReminder"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"数据库连接失败\"\nReceived message:   \"缺少必要参数\"\n\n      35 |     \n      36 |     if (!billId || !userId || !reminderType || !reminderTime || !channel) {\n    > 37 |       throw new Error('缺少必要参数');\n         |             ^\n      38 |     }\n      39 |     \n      40 |     // 检查账单是否存在\n\n      at Object.createPaymentReminder (services/payment-reminder-service.js:37:13)\n      at Object.createPaymentReminder (tests/unit/payment-reminder-service.test.js:108:43)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"数据库连接失败\"\nReceived message:   \"缺少必要参数\"\n\n      35 |     \n      36 |     if (!billId || !userId || !reminderType || !reminderTime || !channel) {\n    > 37 |       throw new Error('缺少必要参数');\n         |             ^\n      38 |     }\n      39 |     \n      40 |     // 检查账单是否存在\n\n      at Object.createPaymentReminder (services/payment-reminder-service.js:37:13)\n      at Object.createPaymentReminder (tests/unit/payment-reminder-service.test.js:108:43)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"数据库连接失败\"\nReceived message:   \"缺少必要参数\"\n\n      35 |     \n      36 |     if (!billId || !userId || !reminderType || !reminderTime || !channel) {\n    > 37 |       throw new Error('缺少必要参数');\n         |             ^\n      38 |     }\n      39 |     \n      40 |     // 检查账单是否存在\n\n      at Object.createPaymentReminder (services/payment-reminder-service.js:37:13)\n      at Object.createPaymentReminder (tests/unit/payment-reminder-service.test.js:108:43)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:109:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付提醒服务测试 createPaymentReminder 应该在数据库查询失败时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在数据库查询失败时抛出错误"},{"ancestorTitles":["支付提醒服务测试","sendPaymentReminder"],"duration":228,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"id\" = 1;"},"original":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"id\" = 1;"},"sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"id\" = 1;","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.select (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1001:12)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1824:21)\n    at Function.findOne (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1998:12)\n    at Function.findByPk (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1955:12)\n    at Object.sendPaymentReminder (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:86:22)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:160:22)"],"fullName":"支付提醒服务测试 sendPaymentReminder 应该成功发送邮件提醒","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功发送邮件提醒"},{"ancestorTitles":["支付提醒服务测试","sendPaymentReminder"],"duration":3,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"id\" = 1;"},"original":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"id\" = 1;"},"sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"id\" = 1;","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.select (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1001:12)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1824:21)\n    at Function.findOne (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1998:12)\n    at Function.findByPk (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1955:12)\n    at Object.sendPaymentReminder (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:86:22)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:222:22)"],"fullName":"支付提醒服务测试 sendPaymentReminder 应该成功发送短信提醒","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功发送短信提醒"},{"ancestorTitles":["支付提醒服务测试","sendPaymentReminder"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"提醒记录不存在\"\nReceived message:   \"column bill.amount does not exist\"\n\n      84 |     \n      85 |     // 查找提醒记录\n    > 86 |     const reminder = await PaymentReminder.findByPk(reminderId, {\n         |                      ^\n      87 |       include: [\n      88 |         {\n      89 |           model: Bill,\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.sendPaymentReminder (services/payment-reminder-service.js:86:22)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:246:7)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"提醒记录不存在\"\nReceived message:   \"column bill.amount does not exist\"\n\n      84 |     \n      85 |     // 查找提醒记录\n    > 86 |     const reminder = await PaymentReminder.findByPk(reminderId, {\n         |                      ^\n      87 |       include: [\n      88 |         {\n      89 |           model: Bill,\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.sendPaymentReminder (services/payment-reminder-service.js:86:22)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:246:7)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"提醒记录不存在\"\nReceived message:   \"column bill.amount does not exist\"\n\n      84 |     \n      85 |     // 查找提醒记录\n    > 86 |     const reminder = await PaymentReminder.findByPk(reminderId, {\n         |                      ^\n      87 |       include: [\n      88 |         {\n      89 |           model: Bill,\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.sendPaymentReminder (services/payment-reminder-service.js:86:22)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:246:7)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:247:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付提醒服务测试 sendPaymentReminder 应该在提醒记录不存在时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在提醒记录不存在时抛出错误"},{"ancestorTitles":["支付提醒服务测试","sendPaymentReminder"],"duration":2,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"id\" = 1;"},"original":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"id\" = 1;"},"sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"id\" = 1;","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.select (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1001:12)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1824:21)\n    at Function.findOne (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1998:12)\n    at Function.findByPk (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1955:12)\n    at Object.sendPaymentReminder (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:86:22)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:269:22)"],"fullName":"支付提醒服务测试 sendPaymentReminder 应该在提醒已发送时返回相应消息","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在提醒已发送时返回相应消息"},{"ancestorTitles":["支付提醒服务测试","sendPaymentReminder"],"duration":2,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"id\" = 1;"},"original":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"id\" = 1;"},"sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"id\" = 1;","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.select (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1001:12)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1824:21)\n    at Function.findOne (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1998:12)\n    at Function.findByPk (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1955:12)\n    at Object.sendPaymentReminder (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:86:22)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:324:22)"],"fullName":"支付提醒服务测试 sendPaymentReminder 应该在邮件发送失败时标记提醒状态为失败","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在邮件发送失败时标记提醒状态为失败"},{"ancestorTitles":["支付提醒服务测试","getUserPaymentReminders"],"duration":5,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":200,"name":"error","severity":"ERROR","code":"42883","hint":"No operator matches the given name and argument types. You might need to add explicit type casts.","position":"206","file":"parse_oper.c","line":"644","routine":"op_error","sql":"SELECT count(\"PaymentReminder\".\"id\") AS \"count\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" WHERE \"PaymentReminder\".\"userId\" = 1;"},"original":{"length":200,"name":"error","severity":"ERROR","code":"42883","hint":"No operator matches the given name and argument types. You might need to add explicit type casts.","position":"206","file":"parse_oper.c","line":"644","routine":"op_error","sql":"SELECT count(\"PaymentReminder\".\"id\") AS \"count\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" WHERE \"PaymentReminder\".\"userId\" = 1;"},"sql":"SELECT count(\"PaymentReminder\".\"id\") AS \"count\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" WHERE \"PaymentReminder\".\"userId\" = 1;","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.rawSelect (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1043:18)\n    at Function.aggregate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2067:19)\n    at Function.count (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2124:20)\n    at async Promise.all (index 0)\n    at Function.findAndCountAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2183:27)\n    at Object.getUserPaymentReminders (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:193:40)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:372:22)"],"fullName":"支付提醒服务测试 getUserPaymentReminders 应该成功获取用户支付提醒列表","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户支付提醒列表"},{"ancestorTitles":["支付提醒服务测试","getUserPaymentReminders"],"duration":6,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"用户ID无效\"\nReceived message:   \"column bill.amount does not exist\"\n\n      191 |     \n      192 |     // 查询支付提醒记录\n    > 193 |     const { count, rows: reminders } = await PaymentReminder.findAndCountAll({\n          |                                        ^\n      194 |       where: whereClause,\n      195 |       include: [\n      196 |         {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n          at async Promise.all (index 1)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at Object.getUserPaymentReminders (services/payment-reminder-service.js:193:40)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:415:7)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"用户ID无效\"\nReceived message:   \"column bill.amount does not exist\"\n\n      191 |     \n      192 |     // 查询支付提醒记录\n    > 193 |     const { count, rows: reminders } = await PaymentReminder.findAndCountAll({\n          |                                        ^\n      194 |       where: whereClause,\n      195 |       include: [\n      196 |         {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n          at async Promise.all (index 1)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at Object.getUserPaymentReminders (services/payment-reminder-service.js:193:40)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:415:7)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"用户ID无效\"\nReceived message:   \"column bill.amount does not exist\"\n\n      191 |     \n      192 |     // 查询支付提醒记录\n    > 193 |     const { count, rows: reminders } = await PaymentReminder.findAndCountAll({\n          |                                        ^\n      194 |       where: whereClause,\n      195 |       include: [\n      196 |         {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n          at async Promise.all (index 1)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at Object.getUserPaymentReminders (services/payment-reminder-service.js:193:40)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:415:7)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:416:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付提醒服务测试 getUserPaymentReminders 应该在用户ID无效时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户ID无效时抛出错误"},{"ancestorTitles":["支付提醒服务测试","getPendingReminders"],"duration":7,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"status\" = 'pending' AND \"PaymentReminder\".\"reminderTime\" <= '1970-01-01 00:00:00.001 +00:00' ORDER BY \"PaymentReminder\".\"reminderTime\" ASC LIMIT 10 OFFSET 0;"},"original":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"status\" = 'pending' AND \"PaymentReminder\".\"reminderTime\" <= '1970-01-01 00:00:00.001 +00:00' ORDER BY \"PaymentReminder\".\"reminderTime\" ASC LIMIT 10 OFFSET 0;"},"sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"status\" = 'pending' AND \"PaymentReminder\".\"reminderTime\" <= '1970-01-01 00:00:00.001 +00:00' ORDER BY \"PaymentReminder\".\"reminderTime\" ASC LIMIT 10 OFFSET 0;","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.select (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1001:12)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1824:21)\n    at async Promise.all (index 1)\n    at Function.findAndCountAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2183:27)\n    at Object.getPendingReminders (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:244:40)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:446:22)"],"fullName":"支付提醒服务测试 getPendingReminders 应该成功获取待发送的提醒","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取待发送的提醒"},{"ancestorTitles":["支付提醒服务测试","sendPendingReminders"],"duration":3,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"status\" = 'pending' AND \"PaymentReminder\".\"reminderTime\" <= '2025-11-03 09:07:45.425 +00:00' ORDER BY \"PaymentReminder\".\"reminderTime\" ASC LIMIT NaN OFFSET NaN;"},"original":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"status\" = 'pending' AND \"PaymentReminder\".\"reminderTime\" <= '2025-11-03 09:07:45.425 +00:00' ORDER BY \"PaymentReminder\".\"reminderTime\" ASC LIMIT NaN OFFSET NaN;"},"sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"status\" = 'pending' AND \"PaymentReminder\".\"reminderTime\" <= '2025-11-03 09:07:45.425 +00:00' ORDER BY \"PaymentReminder\".\"reminderTime\" ASC LIMIT NaN OFFSET NaN;","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.select (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1001:12)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1824:21)\n    at async Promise.all (index 1)\n    at Function.findAndCountAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2183:27)\n    at getPendingReminders (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:244:40)\n    at Object.sendPendingReminders (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:293:34)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:495:22)"],"fullName":"支付提醒服务测试 sendPendingReminders 应该成功批量发送待发送的提醒","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功批量发送待发送的提醒"},{"ancestorTitles":["支付提醒服务测试","sendPendingReminders"],"duration":5,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"status\" = 'pending' AND \"PaymentReminder\".\"reminderTime\" <= '2025-11-03 09:07:45.429 +00:00' ORDER BY \"PaymentReminder\".\"reminderTime\" ASC LIMIT NaN OFFSET NaN;"},"original":{"length":110,"name":"error","severity":"ERROR","code":"42703","position":"397","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn","sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"status\" = 'pending' AND \"PaymentReminder\".\"reminderTime\" <= '2025-11-03 09:07:45.429 +00:00' ORDER BY \"PaymentReminder\".\"reminderTime\" ASC LIMIT NaN OFFSET NaN;"},"sql":"SELECT \"PaymentReminder\".\"id\", \"PaymentReminder\".\"billId\", \"PaymentReminder\".\"userId\", \"PaymentReminder\".\"reminderTime\", \"PaymentReminder\".\"reminderType\", \"PaymentReminder\".\"message\", \"PaymentReminder\".\"status\", \"PaymentReminder\".\"sentAt\", \"PaymentReminder\".\"errorMessage\", \"PaymentReminder\".\"created_at\", \"PaymentReminder\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"dueDate\" AS \"bill.dueDate\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\", \"user\".\"phone\" AS \"user.phone\" FROM \"payment_reminders\" AS \"PaymentReminder\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"PaymentReminder\".\"billId\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"PaymentReminder\".\"userId\" = \"user\".\"id\" WHERE \"PaymentReminder\".\"status\" = 'pending' AND \"PaymentReminder\".\"reminderTime\" <= '2025-11-03 09:07:45.429 +00:00' ORDER BY \"PaymentReminder\".\"reminderTime\" ASC LIMIT NaN OFFSET NaN;","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.select (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1001:12)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1824:21)\n    at async Promise.all (index 1)\n    at Function.findAndCountAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2183:27)\n    at getPendingReminders (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:244:40)\n    at Object.sendPendingReminders (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:293:34)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:530:22)"],"fullName":"支付提醒服务测试 sendPendingReminders 应该处理部分发送失败的情况","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该处理部分发送失败的情况"},{"ancestorTitles":["支付提醒服务测试","createAutoReminders"],"duration":1,"failureDetails":[{"name":"SequelizeEagerLoadingError"}],"failureMessages":["SequelizeEagerLoadingError: User is associated to Room using an alias. You've included an alias (members), but it does not match the alias(es) defined in your association (creator).\n    at Function._getIncludedAssociation (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:751:15)\n    at Function._validateIncludedElement (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:646:53)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:542:37\n    at Array.map (<anonymous>)\n    at Function._validateIncludedElements (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:537:39)\n    at Function._validateIncludedElement (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:732:38)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:542:37\n    at Array.map (<anonymous>)\n    at Function._validateIncludedElements (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:537:39)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1794:12)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.findOne (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1998:12)\n    at Function.findByPk (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1955:12)\n    at Object.createAutoReminders (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:345:18)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:563:22)"],"fullName":"支付提醒服务测试 createAutoReminders 应该为账单创建自动提醒","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该为账单创建自动提醒"},{"ancestorTitles":["支付提醒服务测试","createAutoReminders"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"账单不存在\"\nReceived message:   \"User is associated to Room using an alias. You've included an alias (members), but it does not match the alias(es) defined in your association (creator).\"\n\n      343 |     \n      344 |     // 检查账单是否存在\n    > 345 |     const bill = await Bill.findByPk(billId, {\n          |                  ^\n      346 |       include: [\n      347 |         {\n      348 |           model: Room,\n\n      at Function._getIncludedAssociation (node_modules/sequelize/src/model.js:751:15)\n      at Function._validateIncludedElement (node_modules/sequelize/src/model.js:646:53)\n      at node_modules/sequelize/src/model.js:542:37\n          at Array.map (<anonymous>)\n      at Function._validateIncludedElements (node_modules/sequelize/src/model.js:537:39)\n      at Function._validateIncludedElement (node_modules/sequelize/src/model.js:732:38)\n      at node_modules/sequelize/src/model.js:542:37\n          at Array.map (<anonymous>)\n      at Function._validateIncludedElements (node_modules/sequelize/src/model.js:537:39)\n      at Function.findAll (node_modules/sequelize/src/model.js:1794:12)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createAutoReminders (services/payment-reminder-service.js:345:18)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:582:7)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"账单不存在\"\nReceived message:   \"User is associated to Room using an alias. You've included an alias (members), but it does not match the alias(es) defined in your association (creator).\"\n\n      343 |     \n      344 |     // 检查账单是否存在\n    > 345 |     const bill = await Bill.findByPk(billId, {\n          |                  ^\n      346 |       include: [\n      347 |         {\n      348 |           model: Room,\n\n      at Function._getIncludedAssociation (node_modules/sequelize/src/model.js:751:15)\n      at Function._validateIncludedElement (node_modules/sequelize/src/model.js:646:53)\n      at node_modules/sequelize/src/model.js:542:37\n          at Array.map (<anonymous>)\n      at Function._validateIncludedElements (node_modules/sequelize/src/model.js:537:39)\n      at Function._validateIncludedElement (node_modules/sequelize/src/model.js:732:38)\n      at node_modules/sequelize/src/model.js:542:37\n          at Array.map (<anonymous>)\n      at Function._validateIncludedElements (node_modules/sequelize/src/model.js:537:39)\n      at Function.findAll (node_modules/sequelize/src/model.js:1794:12)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createAutoReminders (services/payment-reminder-service.js:345:18)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:582:7)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"账单不存在\"\nReceived message:   \"User is associated to Room using an alias. You've included an alias (members), but it does not match the alias(es) defined in your association (creator).\"\n\n      343 |     \n      344 |     // 检查账单是否存在\n    > 345 |     const bill = await Bill.findByPk(billId, {\n          |                  ^\n      346 |       include: [\n      347 |         {\n      348 |           model: Room,\n\n      at Function._getIncludedAssociation (node_modules/sequelize/src/model.js:751:15)\n      at Function._validateIncludedElement (node_modules/sequelize/src/model.js:646:53)\n      at node_modules/sequelize/src/model.js:542:37\n          at Array.map (<anonymous>)\n      at Function._validateIncludedElements (node_modules/sequelize/src/model.js:537:39)\n      at Function._validateIncludedElement (node_modules/sequelize/src/model.js:732:38)\n      at node_modules/sequelize/src/model.js:542:37\n          at Array.map (<anonymous>)\n      at Function._validateIncludedElements (node_modules/sequelize/src/model.js:537:39)\n      at Function.findAll (node_modules/sequelize/src/model.js:1794:12)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createAutoReminders (services/payment-reminder-service.js:345:18)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:582:7)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:583:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付提醒服务测试 createAutoReminders 应该在账单不存在时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在账单不存在时抛出错误"},{"ancestorTitles":["支付提醒服务测试","createAutoReminders"],"duration":1,"failureDetails":[{"name":"SequelizeEagerLoadingError"}],"failureMessages":["SequelizeEagerLoadingError: User is associated to Room using an alias. You've included an alias (members), but it does not match the alias(es) defined in your association (creator).\n    at Function._getIncludedAssociation (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:751:15)\n    at Function._validateIncludedElement (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:646:53)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:542:37\n    at Array.map (<anonymous>)\n    at Function._validateIncludedElements (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:537:39)\n    at Function._validateIncludedElement (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:732:38)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:542:37\n    at Array.map (<anonymous>)\n    at Function._validateIncludedElements (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:537:39)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1794:12)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Function.findOne (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1998:12)\n    at Function.findByPk (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1955:12)\n    at Object.createAutoReminders (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-reminder-service.js:345:18)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js:607:22)"],"fullName":"支付提醒服务测试 createAutoReminders 应该在账单即将到期时创建即时提醒","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在账单即将到期时创建即时提醒"}],"endTime":1762160865451,"message":"  ● 支付提醒服务测试 › createPaymentReminder › 应该成功创建支付提醒\n\n    缺少必要参数\n\n      35 |     \n      36 |     if (!billId || !userId || !reminderType || !reminderTime || !channel) {\n    > 37 |       throw new Error('缺少必要参数');\n         |             ^\n      38 |     }\n      39 |     \n      40 |     // 检查账单是否存在\n\n      at Object.createPaymentReminder (services/payment-reminder-service.js:37:13)\n      at Object.createPaymentReminder (tests/unit/payment-reminder-service.test.js:54:51)\n\n  ● 支付提醒服务测试 › createPaymentReminder › 应该在数据库查询失败时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"数据库连接失败\"\n    Received message:   \"缺少必要参数\"\n\n          35 |     \n          36 |     if (!billId || !userId || !reminderType || !reminderTime || !channel) {\n        > 37 |       throw new Error('缺少必要参数');\n             |             ^\n          38 |     }\n          39 |     \n          40 |     // 检查账单是否存在\n\n      at Object.createPaymentReminder (services/payment-reminder-service.js:37:13)\n      at Object.createPaymentReminder (tests/unit/payment-reminder-service.test.js:108:43)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/payment-reminder-service.test.js:109:18)\n\n  ● 支付提醒服务测试 › sendPaymentReminder › 应该成功发送邮件提醒\n\n\n\n      84 |     \n      85 |     // 查找提醒记录\n    > 86 |     const reminder = await PaymentReminder.findByPk(reminderId, {\n         |                      ^\n      87 |       include: [\n      88 |         {\n      89 |           model: Bill,\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.sendPaymentReminder (services/payment-reminder-service.js:86:22)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:160:22)\n\n  ● 支付提醒服务测试 › sendPaymentReminder › 应该成功发送短信提醒\n\n\n\n      84 |     \n      85 |     // 查找提醒记录\n    > 86 |     const reminder = await PaymentReminder.findByPk(reminderId, {\n         |                      ^\n      87 |       include: [\n      88 |         {\n      89 |           model: Bill,\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.sendPaymentReminder (services/payment-reminder-service.js:86:22)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:222:22)\n\n  ● 支付提醒服务测试 › sendPaymentReminder › 应该在提醒记录不存在时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"提醒记录不存在\"\n    Received message:   \"column bill.amount does not exist\"\n\n          84 |     \n          85 |     // 查找提醒记录\n        > 86 |     const reminder = await PaymentReminder.findByPk(reminderId, {\n             |                      ^\n          87 |       include: [\n          88 |         {\n          89 |           model: Bill,\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.sendPaymentReminder (services/payment-reminder-service.js:86:22)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:246:7)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/payment-reminder-service.test.js:247:18)\n\n  ● 支付提醒服务测试 › sendPaymentReminder › 应该在提醒已发送时返回相应消息\n\n\n\n      84 |     \n      85 |     // 查找提醒记录\n    > 86 |     const reminder = await PaymentReminder.findByPk(reminderId, {\n         |                      ^\n      87 |       include: [\n      88 |         {\n      89 |           model: Bill,\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.sendPaymentReminder (services/payment-reminder-service.js:86:22)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:269:22)\n\n  ● 支付提醒服务测试 › sendPaymentReminder › 应该在邮件发送失败时标记提醒状态为失败\n\n\n\n      84 |     \n      85 |     // 查找提醒记录\n    > 86 |     const reminder = await PaymentReminder.findByPk(reminderId, {\n         |                      ^\n      87 |       include: [\n      88 |         {\n      89 |           model: Bill,\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.sendPaymentReminder (services/payment-reminder-service.js:86:22)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:324:22)\n\n  ● 支付提醒服务测试 › getUserPaymentReminders › 应该成功获取用户支付提醒列表\n\n\n\n      191 |     \n      192 |     // 查询支付提醒记录\n    > 193 |     const { count, rows: reminders } = await PaymentReminder.findAndCountAll({\n          |                                        ^\n      194 |       where: whereClause,\n      195 |       include: [\n      196 |         {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.rawSelect (node_modules/sequelize/src/dialects/abstract/query-interface.js:1043:18)\n      at Function.aggregate (node_modules/sequelize/src/model.js:2067:19)\n      at Function.count (node_modules/sequelize/src/model.js:2124:20)\n          at async Promise.all (index 0)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at Object.getUserPaymentReminders (services/payment-reminder-service.js:193:40)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:372:22)\n\n  ● 支付提醒服务测试 › getUserPaymentReminders › 应该在用户ID无效时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"用户ID无效\"\n    Received message:   \"column bill.amount does not exist\"\n\n          191 |     \n          192 |     // 查询支付提醒记录\n        > 193 |     const { count, rows: reminders } = await PaymentReminder.findAndCountAll({\n              |                                        ^\n          194 |       where: whereClause,\n          195 |       include: [\n          196 |         {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n                at async Promise.all (index 1)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at Object.getUserPaymentReminders (services/payment-reminder-service.js:193:40)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:415:7)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/payment-reminder-service.test.js:416:18)\n\n  ● 支付提醒服务测试 › getPendingReminders › 应该成功获取待发送的提醒\n\n\n\n      242 |     \n      243 |     // 查询待发送的支付提醒\n    > 244 |     const { count, rows: reminders } = await PaymentReminder.findAndCountAll({\n          |                                        ^\n      245 |       where: {\n      246 |         status: 'pending',\n      247 |         reminderTime: {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n          at async Promise.all (index 1)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at Object.getPendingReminders (services/payment-reminder-service.js:244:40)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:446:22)\n\n  ● 支付提醒服务测试 › sendPendingReminders › 应该成功批量发送待发送的提醒\n\n\n\n      242 |     \n      243 |     // 查询待发送的支付提醒\n    > 244 |     const { count, rows: reminders } = await PaymentReminder.findAndCountAll({\n          |                                        ^\n      245 |       where: {\n      246 |         status: 'pending',\n      247 |         reminderTime: {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n          at async Promise.all (index 1)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at getPendingReminders (services/payment-reminder-service.js:244:40)\n      at Object.sendPendingReminders (services/payment-reminder-service.js:293:34)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:495:22)\n\n  ● 支付提醒服务测试 › sendPendingReminders › 应该处理部分发送失败的情况\n\n\n\n      242 |     \n      243 |     // 查询待发送的支付提醒\n    > 244 |     const { count, rows: reminders } = await PaymentReminder.findAndCountAll({\n          |                                        ^\n      245 |       where: {\n      246 |         status: 'pending',\n      247 |         reminderTime: {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n          at async Promise.all (index 1)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at getPendingReminders (services/payment-reminder-service.js:244:40)\n      at Object.sendPendingReminders (services/payment-reminder-service.js:293:34)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:530:22)\n\n  ● 支付提醒服务测试 › createAutoReminders › 应该为账单创建自动提醒\n\n    SequelizeEagerLoadingError: User is associated to Room using an alias. You've included an alias (members), but it does not match the alias(es) defined in your association (creator).\n\n      343 |     \n      344 |     // 检查账单是否存在\n    > 345 |     const bill = await Bill.findByPk(billId, {\n          |                  ^\n      346 |       include: [\n      347 |         {\n      348 |           model: Room,\n\n      at Function._getIncludedAssociation (node_modules/sequelize/src/model.js:751:15)\n      at Function._validateIncludedElement (node_modules/sequelize/src/model.js:646:53)\n      at node_modules/sequelize/src/model.js:542:37\n          at Array.map (<anonymous>)\n      at Function._validateIncludedElements (node_modules/sequelize/src/model.js:537:39)\n      at Function._validateIncludedElement (node_modules/sequelize/src/model.js:732:38)\n      at node_modules/sequelize/src/model.js:542:37\n          at Array.map (<anonymous>)\n      at Function._validateIncludedElements (node_modules/sequelize/src/model.js:537:39)\n      at Function.findAll (node_modules/sequelize/src/model.js:1794:12)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createAutoReminders (services/payment-reminder-service.js:345:18)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:563:22)\n\n  ● 支付提醒服务测试 › createAutoReminders › 应该在账单不存在时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"账单不存在\"\n    Received message:   \"User is associated to Room using an alias. You've included an alias (members), but it does not match the alias(es) defined in your association (creator).\"\n\n          343 |     \n          344 |     // 检查账单是否存在\n        > 345 |     const bill = await Bill.findByPk(billId, {\n              |                  ^\n          346 |       include: [\n          347 |         {\n          348 |           model: Room,\n\n      at Function._getIncludedAssociation (node_modules/sequelize/src/model.js:751:15)\n      at Function._validateIncludedElement (node_modules/sequelize/src/model.js:646:53)\n      at node_modules/sequelize/src/model.js:542:37\n                at Array.map (<anonymous>)\n      at Function._validateIncludedElements (node_modules/sequelize/src/model.js:537:39)\n      at Function._validateIncludedElement (node_modules/sequelize/src/model.js:732:38)\n      at node_modules/sequelize/src/model.js:542:37\n                at Array.map (<anonymous>)\n      at Function._validateIncludedElements (node_modules/sequelize/src/model.js:537:39)\n      at Function.findAll (node_modules/sequelize/src/model.js:1794:12)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createAutoReminders (services/payment-reminder-service.js:345:18)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:582:7)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/payment-reminder-service.test.js:583:18)\n\n  ● 支付提醒服务测试 › createAutoReminders › 应该在账单即将到期时创建即时提醒\n\n    SequelizeEagerLoadingError: User is associated to Room using an alias. You've included an alias (members), but it does not match the alias(es) defined in your association (creator).\n\n      343 |     \n      344 |     // 检查账单是否存在\n    > 345 |     const bill = await Bill.findByPk(billId, {\n          |                  ^\n      346 |       include: [\n      347 |         {\n      348 |           model: Room,\n\n      at Function._getIncludedAssociation (node_modules/sequelize/src/model.js:751:15)\n      at Function._validateIncludedElement (node_modules/sequelize/src/model.js:646:53)\n      at node_modules/sequelize/src/model.js:542:37\n          at Array.map (<anonymous>)\n      at Function._validateIncludedElements (node_modules/sequelize/src/model.js:537:39)\n      at Function._validateIncludedElement (node_modules/sequelize/src/model.js:732:38)\n      at node_modules/sequelize/src/model.js:542:37\n          at Array.map (<anonymous>)\n      at Function._validateIncludedElements (node_modules/sequelize/src/model.js:537:39)\n      at Function.findAll (node_modules/sequelize/src/model.js:1794:12)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createAutoReminders (services/payment-reminder-service.js:345:18)\n      at Object.<anonymous> (tests/unit/payment-reminder-service.test.js:607:22)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-reminder-service.test.js","startTime":1762160864757,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["离线支付服务测试","createOfflinePayment"],"duration":218,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":200,"name":"error","severity":"ERROR","code":"42883","hint":"No operator matches the given name and argument types. You might need to add explicit type casts.","position":"171","file":"parse_oper.c","line":"644","routine":"op_error","sql":"SELECT \"id\", \"room_id\", \"title\", \"description\", \"total_amount\", \"status\", \"creator_id\", \"due_date\", \"created_at\", \"updated_at\" FROM \"bills\" AS \"bills\" WHERE \"bills\".\"id\" = 1;"},"original":{"length":200,"name":"error","severity":"ERROR","code":"42883","hint":"No operator matches the given name and argument types. You might need to add explicit type casts.","position":"171","file":"parse_oper.c","line":"644","routine":"op_error","sql":"SELECT \"id\", \"room_id\", \"title\", \"description\", \"total_amount\", \"status\", \"creator_id\", \"due_date\", \"created_at\", \"updated_at\" FROM \"bills\" AS \"bills\" WHERE \"bills\".\"id\" = 1;"},"sql":"SELECT \"id\", \"room_id\", \"title\", \"description\", \"total_amount\", \"status\", \"creator_id\", \"due_date\", \"created_at\", \"updated_at\" FROM \"bills\" AS \"bills\" WHERE \"bills\".\"id\" = 1;","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.select (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1001:12)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1824:21)\n    at Function.findOne (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1998:12)\n    at Function.findByPk (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1955:12)\n    at Object.createOfflinePayment (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\offline-payment-service.js:44:18)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:61:22)"],"fullName":"离线支付服务测试 createOfflinePayment 应该成功创建离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功创建离线支付记录"},{"ancestorTitles":["离线支付服务测试","createOfflinePayment"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"离线支付服务测试 createOfflinePayment 应该在缺少必要参数时抛出错误","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"应该在缺少必要参数时抛出错误"},{"ancestorTitles":["离线支付服务测试","createOfflinePayment"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"账单不存在\"\nReceived message:   \"operator does not exist: uuid = integer\"\n\n      42 |     \n      43 |     // 检查账单是否存在\n    > 44 |     const bill = await Bill.findByPk(billId);\n         |                  ^\n      45 |     if (!bill) {\n      46 |       throw new Error('账单不存在');\n      47 |     }\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createOfflinePayment (services/offline-payment-service.js:44:18)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:108:7)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"账单不存在\"\nReceived message:   \"operator does not exist: uuid = integer\"\n\n      42 |     \n      43 |     // 检查账单是否存在\n    > 44 |     const bill = await Bill.findByPk(billId);\n         |                  ^\n      45 |     if (!bill) {\n      46 |       throw new Error('账单不存在');\n      47 |     }\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createOfflinePayment (services/offline-payment-service.js:44:18)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:108:7)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"账单不存在\"\nReceived message:   \"operator does not exist: uuid = integer\"\n\n      42 |     \n      43 |     // 检查账单是否存在\n    > 44 |     const bill = await Bill.findByPk(billId);\n         |                  ^\n      45 |     if (!bill) {\n      46 |       throw new Error('账单不存在');\n      47 |     }\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createOfflinePayment (services/offline-payment-service.js:44:18)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:108:7)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:109:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付服务测试 createOfflinePayment 应该在账单不存在时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在账单不存在时抛出错误"},{"ancestorTitles":["离线支付服务测试","createOfflinePayment"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"用户不存在\"\nReceived message:   \"operator does not exist: uuid = integer\"\n\n      42 |     \n      43 |     // 检查账单是否存在\n    > 44 |     const bill = await Bill.findByPk(billId);\n         |                  ^\n      45 |     if (!bill) {\n      46 |       throw new Error('账单不存在');\n      47 |     }\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createOfflinePayment (services/offline-payment-service.js:44:18)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:127:7)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"用户不存在\"\nReceived message:   \"operator does not exist: uuid = integer\"\n\n      42 |     \n      43 |     // 检查账单是否存在\n    > 44 |     const bill = await Bill.findByPk(billId);\n         |                  ^\n      45 |     if (!bill) {\n      46 |       throw new Error('账单不存在');\n      47 |     }\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createOfflinePayment (services/offline-payment-service.js:44:18)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:127:7)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"用户不存在\"\nReceived message:   \"operator does not exist: uuid = integer\"\n\n      42 |     \n      43 |     // 检查账单是否存在\n    > 44 |     const bill = await Bill.findByPk(billId);\n         |                  ^\n      45 |     if (!bill) {\n      46 |       throw new Error('账单不存在');\n      47 |     }\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createOfflinePayment (services/offline-payment-service.js:44:18)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:127:7)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:128:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付服务测试 createOfflinePayment 应该在用户不存在时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不存在时抛出错误"},{"ancestorTitles":["离线支付服务测试","syncOfflinePayment"],"duration":1,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":191,"name":"error","severity":"ERROR","code":"42703","hint":"Perhaps you meant to reference the column \"offline_payments.paymentMethod\".","position":"46","file":"parse_relation.c","line":"3838","routine":"errorMissingColumn","sql":"SELECT \"id\", \"bill_id\", \"user_id\", \"amount\", \"payment_method\", \"notes\", \"payment_time\", \"status\", \"last_sync_attempt\", \"sync_attempts\", \"synced_at\", \"created_at\", \"updated_at\" FROM \"offline_payments\" AS \"offline_payments\" WHERE \"offline_payments\".\"id\" = 'payment-uuid';"},"original":{"length":191,"name":"error","severity":"ERROR","code":"42703","hint":"Perhaps you meant to reference the column \"offline_payments.paymentMethod\".","position":"46","file":"parse_relation.c","line":"3838","routine":"errorMissingColumn","sql":"SELECT \"id\", \"bill_id\", \"user_id\", \"amount\", \"payment_method\", \"notes\", \"payment_time\", \"status\", \"last_sync_attempt\", \"sync_attempts\", \"synced_at\", \"created_at\", \"updated_at\" FROM \"offline_payments\" AS \"offline_payments\" WHERE \"offline_payments\".\"id\" = 'payment-uuid';"},"sql":"SELECT \"id\", \"bill_id\", \"user_id\", \"amount\", \"payment_method\", \"notes\", \"payment_time\", \"status\", \"last_sync_attempt\", \"sync_attempts\", \"synced_at\", \"created_at\", \"updated_at\" FROM \"offline_payments\" AS \"offline_payments\" WHERE \"offline_payments\".\"id\" = 'payment-uuid';","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.select (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1001:12)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1824:21)\n    at Function.findOne (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1998:12)\n    at Function.findByPk (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1955:12)\n    at Object.syncOfflinePayment (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\offline-payment-service.js:88:21)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:162:22)"],"fullName":"离线支付服务测试 syncOfflinePayment 应该成功同步离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功同步离线支付记录"},{"ancestorTitles":["离线支付服务测试","syncOfflinePayment"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"支付记录不存在\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      86 |     \n      87 |     // 查找离线支付记录\n    > 88 |     const payment = await OfflinePayment.findByPk(paymentId);\n         |                     ^\n      89 |     \n      90 |     if (!payment) {\n      91 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.syncOfflinePayment (services/offline-payment-service.js:88:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:189:7)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"支付记录不存在\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      86 |     \n      87 |     // 查找离线支付记录\n    > 88 |     const payment = await OfflinePayment.findByPk(paymentId);\n         |                     ^\n      89 |     \n      90 |     if (!payment) {\n      91 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.syncOfflinePayment (services/offline-payment-service.js:88:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:189:7)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"支付记录不存在\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      86 |     \n      87 |     // 查找离线支付记录\n    > 88 |     const payment = await OfflinePayment.findByPk(paymentId);\n         |                     ^\n      89 |     \n      90 |     if (!payment) {\n      91 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.syncOfflinePayment (services/offline-payment-service.js:88:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:189:7)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:190:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付服务测试 syncOfflinePayment 应该在支付记录不存在时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录不存在时抛出错误"},{"ancestorTitles":["离线支付服务测试","syncOfflinePayment"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"只能同步离线待同步状态的支付记录\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      86 |     \n      87 |     // 查找离线支付记录\n    > 88 |     const payment = await OfflinePayment.findByPk(paymentId);\n         |                     ^\n      89 |     \n      90 |     if (!payment) {\n      91 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.syncOfflinePayment (services/offline-payment-service.js:88:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:208:7)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"只能同步离线待同步状态的支付记录\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      86 |     \n      87 |     // 查找离线支付记录\n    > 88 |     const payment = await OfflinePayment.findByPk(paymentId);\n         |                     ^\n      89 |     \n      90 |     if (!payment) {\n      91 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.syncOfflinePayment (services/offline-payment-service.js:88:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:208:7)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"只能同步离线待同步状态的支付记录\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      86 |     \n      87 |     // 查找离线支付记录\n    > 88 |     const payment = await OfflinePayment.findByPk(paymentId);\n         |                     ^\n      89 |     \n      90 |     if (!payment) {\n      91 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.syncOfflinePayment (services/offline-payment-service.js:88:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:208:7)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:209:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付服务测试 syncOfflinePayment 应该在支付记录状态不正确时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录状态不正确时抛出错误"},{"ancestorTitles":["离线支付服务测试","getUserOfflinePayments"],"duration":4,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":200,"name":"error","severity":"ERROR","code":"42883","hint":"No operator matches the given name and argument types. You might need to add explicit type casts.","position":"210","file":"parse_oper.c","line":"644","routine":"op_error","sql":"SELECT count(\"offline_payments\".\"id\") AS \"count\" FROM \"offline_payments\" AS \"offline_payments\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"offline_payments\".\"bill_id\" = \"bill\".\"id\" WHERE \"offline_payments\".\"userId\" = 1 AND \"offline_payments\".\"status\" = 'pending';"},"original":{"length":200,"name":"error","severity":"ERROR","code":"42883","hint":"No operator matches the given name and argument types. You might need to add explicit type casts.","position":"210","file":"parse_oper.c","line":"644","routine":"op_error","sql":"SELECT count(\"offline_payments\".\"id\") AS \"count\" FROM \"offline_payments\" AS \"offline_payments\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"offline_payments\".\"bill_id\" = \"bill\".\"id\" WHERE \"offline_payments\".\"userId\" = 1 AND \"offline_payments\".\"status\" = 'pending';"},"sql":"SELECT count(\"offline_payments\".\"id\") AS \"count\" FROM \"offline_payments\" AS \"offline_payments\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"offline_payments\".\"bill_id\" = \"bill\".\"id\" WHERE \"offline_payments\".\"userId\" = 1 AND \"offline_payments\".\"status\" = 'pending';","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.rawSelect (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1043:18)\n    at Function.aggregate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2067:19)\n    at Function.count (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2124:20)\n    at async Promise.all (index 0)\n    at Function.findAndCountAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2183:27)\n    at Object.getUserOfflinePayments (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\offline-payment-service.js:147:39)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:253:22)"],"fullName":"离线支付服务测试 getUserOfflinePayments 应该成功获取用户离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户离线支付记录"},{"ancestorTitles":["离线支付服务测试","getUserOfflinePayments"],"duration":5,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"Cannot read properties of null (reading 'isOffline')\"\nReceived message:   \"column offline_payments.payment_method does not exist\"\n\n      145 |     \n      146 |     // 查询离线支付记录\n    > 147 |     const { count, rows: payments } = await OfflinePayment.findAndCountAll({\n          |                                       ^\n      148 |       where: whereClause,\n      149 |       include: [\n      150 |         {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n          at async Promise.all (index 1)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at Object.getUserOfflinePayments (services/offline-payment-service.js:147:39)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:291:7)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"Cannot read properties of null (reading 'isOffline')\"\nReceived message:   \"column offline_payments.payment_method does not exist\"\n\n      145 |     \n      146 |     // 查询离线支付记录\n    > 147 |     const { count, rows: payments } = await OfflinePayment.findAndCountAll({\n          |                                       ^\n      148 |       where: whereClause,\n      149 |       include: [\n      150 |         {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n          at async Promise.all (index 1)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at Object.getUserOfflinePayments (services/offline-payment-service.js:147:39)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:291:7)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"Cannot read properties of null (reading 'isOffline')\"\nReceived message:   \"column offline_payments.payment_method does not exist\"\n\n      145 |     \n      146 |     // 查询离线支付记录\n    > 147 |     const { count, rows: payments } = await OfflinePayment.findAndCountAll({\n          |                                       ^\n      148 |       where: whereClause,\n      149 |       include: [\n      150 |         {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n          at async Promise.all (index 1)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at Object.getUserOfflinePayments (services/offline-payment-service.js:147:39)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:291:7)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:292:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付服务测试 getUserOfflinePayments 应该在用户ID无效时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户ID无效时抛出错误"},{"ancestorTitles":["离线支付服务测试","getPendingSyncPayments"],"duration":4,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":207,"name":"error","severity":"ERROR","code":"42703","hint":"Perhaps you meant to reference the column \"offline_payments.paymentMethod\".","position":"122","file":"parse_relation.c","line":"3838","routine":"errorMissingColumn","sql":"SELECT \"offline_payments\".\"id\", \"offline_payments\".\"bill_id\", \"offline_payments\".\"user_id\", \"offline_payments\".\"amount\", \"offline_payments\".\"payment_method\", \"offline_payments\".\"notes\", \"offline_payments\".\"payment_time\", \"offline_payments\".\"status\", \"offline_payments\".\"last_sync_attempt\", \"offline_payments\".\"sync_attempts\", \"offline_payments\".\"synced_at\", \"offline_payments\".\"created_at\", \"offline_payments\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"status\" AS \"bill.status\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\" FROM \"offline_payments\" AS \"offline_payments\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"offline_payments\".\"bill_id\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"offline_payments\".\"user_id\" = \"user\".\"id\" WHERE \"offline_payments\".\"status\" = 'pending' ORDER BY \"offline_payments\".\"created_at\" ASC LIMIT 10 OFFSET 0;"},"original":{"length":207,"name":"error","severity":"ERROR","code":"42703","hint":"Perhaps you meant to reference the column \"offline_payments.paymentMethod\".","position":"122","file":"parse_relation.c","line":"3838","routine":"errorMissingColumn","sql":"SELECT \"offline_payments\".\"id\", \"offline_payments\".\"bill_id\", \"offline_payments\".\"user_id\", \"offline_payments\".\"amount\", \"offline_payments\".\"payment_method\", \"offline_payments\".\"notes\", \"offline_payments\".\"payment_time\", \"offline_payments\".\"status\", \"offline_payments\".\"last_sync_attempt\", \"offline_payments\".\"sync_attempts\", \"offline_payments\".\"synced_at\", \"offline_payments\".\"created_at\", \"offline_payments\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"status\" AS \"bill.status\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\" FROM \"offline_payments\" AS \"offline_payments\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"offline_payments\".\"bill_id\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"offline_payments\".\"user_id\" = \"user\".\"id\" WHERE \"offline_payments\".\"status\" = 'pending' ORDER BY \"offline_payments\".\"created_at\" ASC LIMIT 10 OFFSET 0;"},"sql":"SELECT \"offline_payments\".\"id\", \"offline_payments\".\"bill_id\", \"offline_payments\".\"user_id\", \"offline_payments\".\"amount\", \"offline_payments\".\"payment_method\", \"offline_payments\".\"notes\", \"offline_payments\".\"payment_time\", \"offline_payments\".\"status\", \"offline_payments\".\"last_sync_attempt\", \"offline_payments\".\"sync_attempts\", \"offline_payments\".\"synced_at\", \"offline_payments\".\"created_at\", \"offline_payments\".\"updated_at\", \"bill\".\"id\" AS \"bill.id\", \"bill\".\"title\" AS \"bill.title\", \"bill\".\"amount\" AS \"bill.amount\", \"bill\".\"status\" AS \"bill.status\", \"user\".\"id\" AS \"user.id\", \"user\".\"name\" AS \"user.name\", \"user\".\"email\" AS \"user.email\" FROM \"offline_payments\" AS \"offline_payments\" LEFT OUTER JOIN \"bills\" AS \"bill\" ON \"offline_payments\".\"bill_id\" = \"bill\".\"id\" LEFT OUTER JOIN \"users\" AS \"user\" ON \"offline_payments\".\"user_id\" = \"user\".\"id\" WHERE \"offline_payments\".\"status\" = 'pending' ORDER BY \"offline_payments\".\"created_at\" ASC LIMIT 10 OFFSET 0;","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.select (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1001:12)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1824:21)\n    at async Promise.all (index 1)\n    at Function.findAndCountAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:2183:27)\n    at Object.getPendingSyncPayments (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\offline-payment-service.js:197:39)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:326:22)"],"fullName":"离线支付服务测试 getPendingSyncPayments 应该成功获取待同步的离线支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取待同步的离线支付记录"},{"ancestorTitles":["离线支付服务测试","markPaymentSyncFailed"],"duration":4,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":191,"name":"error","severity":"ERROR","code":"42703","hint":"Perhaps you meant to reference the column \"offline_payments.paymentMethod\".","position":"46","file":"parse_relation.c","line":"3838","routine":"errorMissingColumn","sql":"SELECT \"id\", \"bill_id\", \"user_id\", \"amount\", \"payment_method\", \"notes\", \"payment_time\", \"status\", \"last_sync_attempt\", \"sync_attempts\", \"synced_at\", \"created_at\", \"updated_at\" FROM \"offline_payments\" AS \"offline_payments\" WHERE \"offline_payments\".\"id\" = 'payment-uuid';"},"original":{"length":191,"name":"error","severity":"ERROR","code":"42703","hint":"Perhaps you meant to reference the column \"offline_payments.paymentMethod\".","position":"46","file":"parse_relation.c","line":"3838","routine":"errorMissingColumn","sql":"SELECT \"id\", \"bill_id\", \"user_id\", \"amount\", \"payment_method\", \"notes\", \"payment_time\", \"status\", \"last_sync_attempt\", \"sync_attempts\", \"synced_at\", \"created_at\", \"updated_at\" FROM \"offline_payments\" AS \"offline_payments\" WHERE \"offline_payments\".\"id\" = 'payment-uuid';"},"sql":"SELECT \"id\", \"bill_id\", \"user_id\", \"amount\", \"payment_method\", \"notes\", \"payment_time\", \"status\", \"last_sync_attempt\", \"sync_attempts\", \"synced_at\", \"created_at\", \"updated_at\" FROM \"offline_payments\" AS \"offline_payments\" WHERE \"offline_payments\".\"id\" = 'payment-uuid';","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.select (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1001:12)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1824:21)\n    at Function.findOne (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1998:12)\n    at Function.findByPk (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1955:12)\n    at Object.markPaymentSyncFailed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\offline-payment-service.js:244:21)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:383:22)"],"fullName":"离线支付服务测试 markPaymentSyncFailed 应该成功标记支付同步失败","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功标记支付同步失败"},{"ancestorTitles":["离线支付服务测试","markPaymentSyncFailed"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"支付记录不存在\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      242 |     \n      243 |     // 查找离线支付记录\n    > 244 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      245 |     \n      246 |     if (!payment) {\n      247 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.markPaymentSyncFailed (services/offline-payment-service.js:244:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:406:7)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"支付记录不存在\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      242 |     \n      243 |     // 查找离线支付记录\n    > 244 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      245 |     \n      246 |     if (!payment) {\n      247 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.markPaymentSyncFailed (services/offline-payment-service.js:244:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:406:7)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"支付记录不存在\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      242 |     \n      243 |     // 查找离线支付记录\n    > 244 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      245 |     \n      246 |     if (!payment) {\n      247 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.markPaymentSyncFailed (services/offline-payment-service.js:244:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:406:7)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:407:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付服务测试 markPaymentSyncFailed 应该在支付记录不存在时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录不存在时抛出错误"},{"ancestorTitles":["离线支付服务测试","markPaymentSyncFailed"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"只能标记待同步状态的支付记录\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      242 |     \n      243 |     // 查找离线支付记录\n    > 244 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      245 |     \n      246 |     if (!payment) {\n      247 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.markPaymentSyncFailed (services/offline-payment-service.js:244:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:425:7)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"只能标记待同步状态的支付记录\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      242 |     \n      243 |     // 查找离线支付记录\n    > 244 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      245 |     \n      246 |     if (!payment) {\n      247 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.markPaymentSyncFailed (services/offline-payment-service.js:244:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:425:7)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"只能标记待同步状态的支付记录\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      242 |     \n      243 |     // 查找离线支付记录\n    > 244 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      245 |     \n      246 |     if (!payment) {\n      247 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.markPaymentSyncFailed (services/offline-payment-service.js:244:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:425:7)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:426:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付服务测试 markPaymentSyncFailed 应该在支付记录状态不正确时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录状态不正确时抛出错误"},{"ancestorTitles":["离线支付服务测试","retryPaymentSync"],"duration":2,"failureDetails":[{"name":"SequelizeDatabaseError","parent":{"length":191,"name":"error","severity":"ERROR","code":"42703","hint":"Perhaps you meant to reference the column \"offline_payments.paymentMethod\".","position":"46","file":"parse_relation.c","line":"3838","routine":"errorMissingColumn","sql":"SELECT \"id\", \"bill_id\", \"user_id\", \"amount\", \"payment_method\", \"notes\", \"payment_time\", \"status\", \"last_sync_attempt\", \"sync_attempts\", \"synced_at\", \"created_at\", \"updated_at\" FROM \"offline_payments\" AS \"offline_payments\" WHERE \"offline_payments\".\"id\" = 'payment-uuid';"},"original":{"length":191,"name":"error","severity":"ERROR","code":"42703","hint":"Perhaps you meant to reference the column \"offline_payments.paymentMethod\".","position":"46","file":"parse_relation.c","line":"3838","routine":"errorMissingColumn","sql":"SELECT \"id\", \"bill_id\", \"user_id\", \"amount\", \"payment_method\", \"notes\", \"payment_time\", \"status\", \"last_sync_attempt\", \"sync_attempts\", \"synced_at\", \"created_at\", \"updated_at\" FROM \"offline_payments\" AS \"offline_payments\" WHERE \"offline_payments\".\"id\" = 'payment-uuid';"},"sql":"SELECT \"id\", \"bill_id\", \"user_id\", \"amount\", \"payment_method\", \"notes\", \"payment_time\", \"status\", \"last_sync_attempt\", \"sync_attempts\", \"synced_at\", \"created_at\", \"updated_at\" FROM \"offline_payments\" AS \"offline_payments\" WHERE \"offline_payments\".\"id\" = 'payment-uuid';","parameters":{}}],"failureMessages":["Error: \n    at Query.run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\postgres\\query.js:76:25)\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\sequelize.js:650:28\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at PostgresQueryInterface.select (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\dialects\\abstract\\query-interface.js:1001:12)\n    at Function.findAll (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1824:21)\n    at Function.findOne (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1998:12)\n    at Function.findByPk (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\sequelize\\src\\model.js:1955:12)\n    at Object.retryPaymentSync (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\offline-payment-service.js:279:21)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:461:22)"],"fullName":"离线支付服务测试 retryPaymentSync 应该成功重试同步失败的支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功重试同步失败的支付记录"},{"ancestorTitles":["离线支付服务测试","retryPaymentSync"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"支付记录不存在\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      277 |     \n      278 |     // 查找离线支付记录\n    > 279 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      280 |     \n      281 |     if (!payment) {\n      282 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.retryPaymentSync (services/offline-payment-service.js:279:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:483:7)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"支付记录不存在\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      277 |     \n      278 |     // 查找离线支付记录\n    > 279 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      280 |     \n      281 |     if (!payment) {\n      282 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.retryPaymentSync (services/offline-payment-service.js:279:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:483:7)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"支付记录不存在\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      277 |     \n      278 |     // 查找离线支付记录\n    > 279 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      280 |     \n      281 |     if (!payment) {\n      282 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.retryPaymentSync (services/offline-payment-service.js:279:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:483:7)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:484:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付服务测试 retryPaymentSync 应该在支付记录不存在时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录不存在时抛出错误"},{"ancestorTitles":["离线支付服务测试","retryPaymentSync"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"只能重试同步失败状态的支付记录\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      277 |     \n      278 |     // 查找离线支付记录\n    > 279 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      280 |     \n      281 |     if (!payment) {\n      282 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.retryPaymentSync (services/offline-payment-service.js:279:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:501:7)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"只能重试同步失败状态的支付记录\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      277 |     \n      278 |     // 查找离线支付记录\n    > 279 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      280 |     \n      281 |     if (!payment) {\n      282 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.retryPaymentSync (services/offline-payment-service.js:279:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:501:7)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"只能重试同步失败状态的支付记录\"\nReceived message:   \"column \\\"payment_method\\\" does not exist\"\n\n      277 |     \n      278 |     // 查找离线支付记录\n    > 279 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      280 |     \n      281 |     if (!payment) {\n      282 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.retryPaymentSync (services/offline-payment-service.js:279:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:501:7)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js:502:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"离线支付服务测试 retryPaymentSync 应该在支付记录状态不正确时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付记录状态不正确时抛出错误"}],"endTime":1762160866142,"message":"  ● 离线支付服务测试 › createOfflinePayment › 应该成功创建离线支付记录\n\n\n\n      42 |     \n      43 |     // 检查账单是否存在\n    > 44 |     const bill = await Bill.findByPk(billId);\n         |                  ^\n      45 |     if (!bill) {\n      46 |       throw new Error('账单不存在');\n      47 |     }\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createOfflinePayment (services/offline-payment-service.js:44:18)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:61:22)\n\n  ● 离线支付服务测试 › createOfflinePayment › 应该在账单不存在时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"账单不存在\"\n    Received message:   \"operator does not exist: uuid = integer\"\n\n          42 |     \n          43 |     // 检查账单是否存在\n        > 44 |     const bill = await Bill.findByPk(billId);\n             |                  ^\n          45 |     if (!bill) {\n          46 |       throw new Error('账单不存在');\n          47 |     }\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createOfflinePayment (services/offline-payment-service.js:44:18)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:108:7)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/offline-payment-service.test.js:109:18)\n\n  ● 离线支付服务测试 › createOfflinePayment › 应该在用户不存在时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"用户不存在\"\n    Received message:   \"operator does not exist: uuid = integer\"\n\n          42 |     \n          43 |     // 检查账单是否存在\n        > 44 |     const bill = await Bill.findByPk(billId);\n             |                  ^\n          45 |     if (!bill) {\n          46 |       throw new Error('账单不存在');\n          47 |     }\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.createOfflinePayment (services/offline-payment-service.js:44:18)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:127:7)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/offline-payment-service.test.js:128:18)\n\n  ● 离线支付服务测试 › syncOfflinePayment › 应该成功同步离线支付记录\n\n\n\n      86 |     \n      87 |     // 查找离线支付记录\n    > 88 |     const payment = await OfflinePayment.findByPk(paymentId);\n         |                     ^\n      89 |     \n      90 |     if (!payment) {\n      91 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.syncOfflinePayment (services/offline-payment-service.js:88:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:162:22)\n\n  ● 离线支付服务测试 › syncOfflinePayment › 应该在支付记录不存在时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"支付记录不存在\"\n    Received message:   \"column \\\"payment_method\\\" does not exist\"\n\n          86 |     \n          87 |     // 查找离线支付记录\n        > 88 |     const payment = await OfflinePayment.findByPk(paymentId);\n             |                     ^\n          89 |     \n          90 |     if (!payment) {\n          91 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.syncOfflinePayment (services/offline-payment-service.js:88:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:189:7)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/offline-payment-service.test.js:190:18)\n\n  ● 离线支付服务测试 › syncOfflinePayment › 应该在支付记录状态不正确时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"只能同步离线待同步状态的支付记录\"\n    Received message:   \"column \\\"payment_method\\\" does not exist\"\n\n          86 |     \n          87 |     // 查找离线支付记录\n        > 88 |     const payment = await OfflinePayment.findByPk(paymentId);\n             |                     ^\n          89 |     \n          90 |     if (!payment) {\n          91 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.syncOfflinePayment (services/offline-payment-service.js:88:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:208:7)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/offline-payment-service.test.js:209:18)\n\n  ● 离线支付服务测试 › getUserOfflinePayments › 应该成功获取用户离线支付记录\n\n\n\n      145 |     \n      146 |     // 查询离线支付记录\n    > 147 |     const { count, rows: payments } = await OfflinePayment.findAndCountAll({\n          |                                       ^\n      148 |       where: whereClause,\n      149 |       include: [\n      150 |         {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.rawSelect (node_modules/sequelize/src/dialects/abstract/query-interface.js:1043:18)\n      at Function.aggregate (node_modules/sequelize/src/model.js:2067:19)\n      at Function.count (node_modules/sequelize/src/model.js:2124:20)\n          at async Promise.all (index 0)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at Object.getUserOfflinePayments (services/offline-payment-service.js:147:39)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:253:22)\n\n  ● 离线支付服务测试 › getUserOfflinePayments › 应该在用户ID无效时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"Cannot read properties of null (reading 'isOffline')\"\n    Received message:   \"column offline_payments.payment_method does not exist\"\n\n          145 |     \n          146 |     // 查询离线支付记录\n        > 147 |     const { count, rows: payments } = await OfflinePayment.findAndCountAll({\n              |                                       ^\n          148 |       where: whereClause,\n          149 |       include: [\n          150 |         {\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n                at async Promise.all (index 1)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at Object.getUserOfflinePayments (services/offline-payment-service.js:147:39)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:291:7)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/offline-payment-service.test.js:292:18)\n\n  ● 离线支付服务测试 › getPendingSyncPayments › 应该成功获取待同步的离线支付记录\n\n\n\n      195 |     \n      196 |     // 查询待同步的离线支付记录\n    > 197 |     const { count, rows: payments } = await OfflinePayment.findAndCountAll({\n          |                                       ^\n      198 |       where: {\n      199 |         status: 'pending'\n      200 |       },\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n          at async Promise.all (index 1)\n      at Function.findAndCountAll (node_modules/sequelize/src/model.js:2183:27)\n      at Object.getPendingSyncPayments (services/offline-payment-service.js:197:39)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:326:22)\n\n  ● 离线支付服务测试 › markPaymentSyncFailed › 应该成功标记支付同步失败\n\n\n\n      242 |     \n      243 |     // 查找离线支付记录\n    > 244 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      245 |     \n      246 |     if (!payment) {\n      247 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.markPaymentSyncFailed (services/offline-payment-service.js:244:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:383:22)\n\n  ● 离线支付服务测试 › markPaymentSyncFailed › 应该在支付记录不存在时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"支付记录不存在\"\n    Received message:   \"column \\\"payment_method\\\" does not exist\"\n\n          242 |     \n          243 |     // 查找离线支付记录\n        > 244 |     const payment = await OfflinePayment.findByPk(paymentId);\n              |                     ^\n          245 |     \n          246 |     if (!payment) {\n          247 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.markPaymentSyncFailed (services/offline-payment-service.js:244:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:406:7)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/offline-payment-service.test.js:407:18)\n\n  ● 离线支付服务测试 › markPaymentSyncFailed › 应该在支付记录状态不正确时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"只能标记待同步状态的支付记录\"\n    Received message:   \"column \\\"payment_method\\\" does not exist\"\n\n          242 |     \n          243 |     // 查找离线支付记录\n        > 244 |     const payment = await OfflinePayment.findByPk(paymentId);\n              |                     ^\n          245 |     \n          246 |     if (!payment) {\n          247 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.markPaymentSyncFailed (services/offline-payment-service.js:244:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:425:7)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/offline-payment-service.test.js:426:18)\n\n  ● 离线支付服务测试 › retryPaymentSync › 应该成功重试同步失败的支付记录\n\n\n\n      277 |     \n      278 |     // 查找离线支付记录\n    > 279 |     const payment = await OfflinePayment.findByPk(paymentId);\n          |                     ^\n      280 |     \n      281 |     if (!payment) {\n      282 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.retryPaymentSync (services/offline-payment-service.js:279:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:461:22)\n\n  ● 离线支付服务测试 › retryPaymentSync › 应该在支付记录不存在时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"支付记录不存在\"\n    Received message:   \"column \\\"payment_method\\\" does not exist\"\n\n          277 |     \n          278 |     // 查找离线支付记录\n        > 279 |     const payment = await OfflinePayment.findByPk(paymentId);\n              |                     ^\n          280 |     \n          281 |     if (!payment) {\n          282 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.retryPaymentSync (services/offline-payment-service.js:279:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:483:7)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/offline-payment-service.test.js:484:18)\n\n  ● 离线支付服务测试 › retryPaymentSync › 应该在支付记录状态不正确时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"只能重试同步失败状态的支付记录\"\n    Received message:   \"column \\\"payment_method\\\" does not exist\"\n\n          277 |     \n          278 |     // 查找离线支付记录\n        > 279 |     const payment = await OfflinePayment.findByPk(paymentId);\n              |                     ^\n          280 |     \n          281 |     if (!payment) {\n          282 |       throw new Error('支付记录不存在');\n\n      at Query.run (node_modules/sequelize/src/dialects/postgres/query.js:76:25)\n      at node_modules/sequelize/src/sequelize.js:650:28\n      at PostgresQueryInterface.select (node_modules/sequelize/src/dialects/abstract/query-interface.js:1001:12)\n      at Function.findAll (node_modules/sequelize/src/model.js:1824:21)\n      at Function.findOne (node_modules/sequelize/src/model.js:1998:12)\n      at Function.findByPk (node_modules/sequelize/src/model.js:1955:12)\n      at Object.retryPaymentSync (services/offline-payment-service.js:279:21)\n      at Object.<anonymous> (tests/unit/offline-payment-service.test.js:501:7)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/offline-payment-service.test.js:502:18)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\offline-payment-service.test.js","startTime":1762160865466,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["用户管理API集成测试","POST /api/auth/register"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 POST /api/auth/register 应该成功注册新用户","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功注册新用户"},{"ancestorTitles":["用户管理API集成测试","POST /api/auth/register"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 POST /api/auth/register 应该在缺少必填字段时返回400","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在缺少必填字段时返回400"},{"ancestorTitles":["用户管理API集成测试","POST /api/auth/register"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 POST /api/auth/register 应该在用户名已存在时返回409","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户名已存在时返回409"},{"ancestorTitles":["用户管理API集成测试","POST /api/auth/register"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 POST /api/auth/register 应该在邮箱已存在时返回409","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在邮箱已存在时返回409"},{"ancestorTitles":["用户管理API集成测试","POST /api/auth/login"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 POST /api/auth/login 应该成功登录并返回token","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功登录并返回token"},{"ancestorTitles":["用户管理API集成测试","POST /api/auth/login"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 POST /api/auth/login 应该在缺少必填字段时返回400","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在缺少必填字段时返回400"},{"ancestorTitles":["用户管理API集成测试","POST /api/auth/login"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 POST /api/auth/login 应该在用户不存在时返回401","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不存在时返回401"},{"ancestorTitles":["用户管理API集成测试","POST /api/auth/refresh"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 POST /api/auth/refresh 应该成功刷新token","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功刷新token"},{"ancestorTitles":["用户管理API集成测试","POST /api/auth/refresh"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 POST /api/auth/refresh 应该在缺少刷新token时返回400","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在缺少刷新token时返回400"},{"ancestorTitles":["用户管理API集成测试","GET /api/users/profile"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 GET /api/users/profile 应该成功获取用户资料","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户资料"},{"ancestorTitles":["用户管理API集成测试","GET /api/users/profile"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 GET /api/users/profile 应该在未提供认证令牌时返回401","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在未提供认证令牌时返回401"},{"ancestorTitles":["用户管理API集成测试","PUT /api/users/profile"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 PUT /api/users/profile 应该成功更新用户资料","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功更新用户资料"},{"ancestorTitles":["用户管理API集成测试","PUT /api/users/profile"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 PUT /api/users/profile 应该在未提供认证令牌时返回401","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在未提供认证令牌时返回401"},{"ancestorTitles":["用户管理API集成测试","PUT /api/users/password"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 PUT /api/users/password 应该成功修改密码","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功修改密码"},{"ancestorTitles":["用户管理API集成测试","PUT /api/users/password"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 PUT /api/users/password 应该在当前密码错误时返回400","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在当前密码错误时返回400"},{"ancestorTitles":["用户管理API集成测试","PUT /api/users/password"],"duration":0,"failureDetails":[{"length":420,"name":"error","severity":"ERROR","code":"23514","detail":"Failing row contains (26540f50-7816-4bc4-8b00-fb090a1a2bad, testuser, test@example.com, null, $2a$10$1eSqInXhfxKzNqVsMQeUcu58EXkfQaunjTEGB.qpZwReGqmolurEy, Test User, null, user, active, null, 2025-11-03 17:07:46.880596, 2025-11-03 17:07:46.880596).","schema":"public","table":"users","constraint":"users_role_check","file":"execMain.c","line":"2067","routine":"ExecConstraints"}],"failureMessages":["error: new row for relation \"users\" violates check constraint \"users_role_check\"\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js:22:24)"],"fullName":"用户管理API集成测试 PUT /api/users/password 应该在未提供认证令牌时返回401","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在未提供认证令牌时返回401"}],"endTime":1762160866966,"message":"  ● 用户管理API集成测试 › POST /api/auth/register › 应该成功注册新用户\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › POST /api/auth/register › 应该在缺少必填字段时返回400\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › POST /api/auth/register › 应该在用户名已存在时返回409\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › POST /api/auth/register › 应该在邮箱已存在时返回409\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › POST /api/auth/login › 应该成功登录并返回token\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › POST /api/auth/login › 应该在缺少必填字段时返回400\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › POST /api/auth/login › 应该在用户不存在时返回401\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › POST /api/auth/refresh › 应该成功刷新token\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › POST /api/auth/refresh › 应该在缺少刷新token时返回400\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › GET /api/users/profile › 应该成功获取用户资料\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › GET /api/users/profile › 应该在未提供认证令牌时返回401\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › PUT /api/users/profile › 应该成功更新用户资料\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › PUT /api/users/profile › 应该在未提供认证令牌时返回401\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › PUT /api/users/password › 应该成功修改密码\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › PUT /api/users/password › 应该在当前密码错误时返回400\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n\n  ● 用户管理API集成测试 › PUT /api/users/password › 应该在未提供认证令牌时返回401\n\n    error: new row for relation \"users\" violates check constraint \"users_role_check\"\n\n      20 |     \n      21 |     // 创建测试用户\n    > 22 |     const userResult = await pool.query(\n         |                        ^\n      23 |       'INSERT INTO users (username, email, password_hash, name, role) VALUES ($1, $2, $3, $4, $5) RETURNING *',\n      24 |       ['testuser', 'test@example.com', hashedPassword, 'Test User', 'user']\n      25 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/users.test.js:22:24)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\users.test.js","startTime":1762160866160,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["账单管理API测试","POST /api/bills"],"duration":1,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 POST /api/bills 应该成功创建账单","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功创建账单"},{"ancestorTitles":["账单管理API测试","POST /api/bills"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 POST /api/bills 应该在未提供认证令牌时返回401","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在未提供认证令牌时返回401"},{"ancestorTitles":["账单管理API测试","POST /api/bills"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 POST /api/bills 应该在缺少必填字段时返回400","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在缺少必填字段时返回400"},{"ancestorTitles":["账单管理API测试","GET /api/bills"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 GET /api/bills 应该成功获取账单列表","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取账单列表"},{"ancestorTitles":["账单管理API测试","GET /api/bills"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 GET /api/bills 应该支持按寝室筛选账单","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该支持按寝室筛选账单"},{"ancestorTitles":["账单管理API测试","GET /api/bills/:id"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 GET /api/bills/:id 应该成功获取特定账单详情","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取特定账单详情"},{"ancestorTitles":["账单管理API测试","GET /api/bills/:id"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 GET /api/bills/:id 应该在账单不存在时返回404","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在账单不存在时返回404"},{"ancestorTitles":["账单管理API测试","PUT /api/bills/:id"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 PUT /api/bills/:id 应该成功更新账单","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功更新账单"},{"ancestorTitles":["账单管理API测试","PUT /api/bills/:id"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 PUT /api/bills/:id 应该在账单不存在时返回404","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在账单不存在时返回404"},{"ancestorTitles":["账单管理API测试","POST /api/bills/:id/review"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 POST /api/bills/:id/review 应该成功审核账单","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功审核账单"},{"ancestorTitles":["账单管理API测试","POST /api/bills/:id/review"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 POST /api/bills/:id/review 应该在账单不存在时返回404","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在账单不存在时返回404"},{"ancestorTitles":["账单管理API测试","POST /api/bills/:id/confirm-payment"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 POST /api/bills/:id/confirm-payment 应该成功确认账单支付","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功确认账单支付"},{"ancestorTitles":["账单管理API测试","POST /api/bills/:id/confirm-payment"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 POST /api/bills/:id/confirm-payment 应该在分摊ID不存在时返回400","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在分摊ID不存在时返回400"},{"ancestorTitles":["账单管理API测试","GET /api/bills/user-stats"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 GET /api/bills/user-stats 应该成功获取用户账单统计","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户账单统计"},{"ancestorTitles":["账单管理API测试","DELETE /api/bills/:id"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 DELETE /api/bills/:id 应该成功删除账单","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功删除账单"},{"ancestorTitles":["账单管理API测试","DELETE /api/bills/:id"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js:20:24)"],"fullName":"账单管理API测试 DELETE /api/bills/:id 应该在账单不存在时返回404","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在账单不存在时返回404"}],"endTime":1762160867711,"message":"  ● 账单管理API测试 › POST /api/bills › 应该成功创建账单\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › POST /api/bills › 应该在未提供认证令牌时返回401\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › POST /api/bills › 应该在缺少必填字段时返回400\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › GET /api/bills › 应该成功获取账单列表\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › GET /api/bills › 应该支持按寝室筛选账单\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › GET /api/bills/:id › 应该成功获取特定账单详情\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › GET /api/bills/:id › 应该在账单不存在时返回404\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › PUT /api/bills/:id › 应该成功更新账单\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › PUT /api/bills/:id › 应该在账单不存在时返回404\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › POST /api/bills/:id/review › 应该成功审核账单\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › POST /api/bills/:id/review › 应该在账单不存在时返回404\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › POST /api/bills/:id/confirm-payment › 应该成功确认账单支付\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › POST /api/bills/:id/confirm-payment › 应该在分摊ID不存在时返回400\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › GET /api/bills/user-stats › 应该成功获取用户账单统计\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › DELETE /api/bills/:id › 应该成功删除账单\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n\n  ● 账单管理API测试 › DELETE /api/bills/:id › 应该在账单不存在时返回404\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      18 |   beforeAll(async () => {\n      19 |     // 创建测试用户\n    > 20 |     const userResult = await pool.query(\n         |                        ^\n      21 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      22 |       ['testuser', 'test@example.com', 'password123', 'user']\n      23 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/bills.test.js:20:24)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills.test.js","startTime":1762160866980,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["支付流程优化集成测试","离线支付流程"],"duration":167,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'authenticate')\n    at Object.authenticate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\payment-optimization.test.js:15:21)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付流程优化集成测试 离线支付流程 应该完成完整的离线支付流程","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该完成完整的离线支付流程"},{"ancestorTitles":["支付流程优化集成测试","支付提醒流程"],"duration":2,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'authenticate')\n    at Object.authenticate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\payment-optimization.test.js:15:21)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付流程优化集成测试 支付提醒流程 应该完成完整的支付提醒流程","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该完成完整的支付提醒流程"},{"ancestorTitles":["支付流程优化集成测试","支付记录查询流程"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'authenticate')\n    at Object.authenticate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\payment-optimization.test.js:15:21)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付流程优化集成测试 支付记录查询流程 应该完成支付记录查询流程","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该完成支付记录查询流程"},{"ancestorTitles":["支付流程优化集成测试","定时任务管理"],"duration":3,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'authenticate')\n    at Object.authenticate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\payment-optimization.test.js:15:21)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付流程优化集成测试 定时任务管理 应该完成定时任务管理流程","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该完成定时任务管理流程"},{"ancestorTitles":["支付流程优化集成测试","错误处理"],"duration":2,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'authenticate')\n    at Object.authenticate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\payment-optimization.test.js:15:21)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付流程优化集成测试 错误处理 应该处理无效的认证","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该处理无效的认证"},{"ancestorTitles":["支付流程优化集成测试","错误处理"],"duration":2,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'authenticate')\n    at Object.authenticate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\payment-optimization.test.js:15:21)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付流程优化集成测试 错误处理 应该处理无效的支付ID","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该处理无效的支付ID"},{"ancestorTitles":["支付流程优化集成测试","错误处理"],"duration":2,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'authenticate')\n    at Object.authenticate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\payment-optimization.test.js:15:21)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付流程优化集成测试 错误处理 应该处理无效的任务名称","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该处理无效的任务名称"},{"ancestorTitles":["支付流程优化集成测试","错误处理"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of undefined (reading 'authenticate')\n    at Object.authenticate (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\payment-optimization.test.js:15:21)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusHook (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:281:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:95:7)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付流程优化集成测试 错误处理 应该处理缺少必要参数的请求","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该处理缺少必要参数的请求"}],"coverage":{},"endTime":1762160888032,"message":"  ● 支付流程优化集成测试 › 离线支付流程 › 应该完成完整的离线支付流程\n\n    TypeError: Cannot read properties of undefined (reading 'authenticate')\n\n      13 |   beforeAll(async () => {\n      14 |     // 确保数据库连接\n    > 15 |     await sequelize.authenticate();\n         |                     ^\n      16 |   });\n      17 |\n      18 |   afterAll(async () => {\n\n      at Object.authenticate (tests/integration/payment-optimization.test.js:15:21)\n\n  ● 支付流程优化集成测试 › 支付提醒流程 › 应该完成完整的支付提醒流程\n\n    TypeError: Cannot read properties of undefined (reading 'authenticate')\n\n      13 |   beforeAll(async () => {\n      14 |     // 确保数据库连接\n    > 15 |     await sequelize.authenticate();\n         |                     ^\n      16 |   });\n      17 |\n      18 |   afterAll(async () => {\n\n      at Object.authenticate (tests/integration/payment-optimization.test.js:15:21)\n\n  ● 支付流程优化集成测试 › 支付记录查询流程 › 应该完成支付记录查询流程\n\n    TypeError: Cannot read properties of undefined (reading 'authenticate')\n\n      13 |   beforeAll(async () => {\n      14 |     // 确保数据库连接\n    > 15 |     await sequelize.authenticate();\n         |                     ^\n      16 |   });\n      17 |\n      18 |   afterAll(async () => {\n\n      at Object.authenticate (tests/integration/payment-optimization.test.js:15:21)\n\n  ● 支付流程优化集成测试 › 定时任务管理 › 应该完成定时任务管理流程\n\n    TypeError: Cannot read properties of undefined (reading 'authenticate')\n\n      13 |   beforeAll(async () => {\n      14 |     // 确保数据库连接\n    > 15 |     await sequelize.authenticate();\n         |                     ^\n      16 |   });\n      17 |\n      18 |   afterAll(async () => {\n\n      at Object.authenticate (tests/integration/payment-optimization.test.js:15:21)\n\n  ● 支付流程优化集成测试 › 错误处理 › 应该处理无效的认证\n\n    TypeError: Cannot read properties of undefined (reading 'authenticate')\n\n      13 |   beforeAll(async () => {\n      14 |     // 确保数据库连接\n    > 15 |     await sequelize.authenticate();\n         |                     ^\n      16 |   });\n      17 |\n      18 |   afterAll(async () => {\n\n      at Object.authenticate (tests/integration/payment-optimization.test.js:15:21)\n\n  ● 支付流程优化集成测试 › 错误处理 › 应该处理无效的支付ID\n\n    TypeError: Cannot read properties of undefined (reading 'authenticate')\n\n      13 |   beforeAll(async () => {\n      14 |     // 确保数据库连接\n    > 15 |     await sequelize.authenticate();\n         |                     ^\n      16 |   });\n      17 |\n      18 |   afterAll(async () => {\n\n      at Object.authenticate (tests/integration/payment-optimization.test.js:15:21)\n\n  ● 支付流程优化集成测试 › 错误处理 › 应该处理无效的任务名称\n\n    TypeError: Cannot read properties of undefined (reading 'authenticate')\n\n      13 |   beforeAll(async () => {\n      14 |     // 确保数据库连接\n    > 15 |     await sequelize.authenticate();\n         |                     ^\n      16 |   });\n      17 |\n      18 |   afterAll(async () => {\n\n      at Object.authenticate (tests/integration/payment-optimization.test.js:15:21)\n\n  ● 支付流程优化集成测试 › 错误处理 › 应该处理缺少必要参数的请求\n\n    TypeError: Cannot read properties of undefined (reading 'authenticate')\n\n      13 |   beforeAll(async () => {\n      14 |     // 确保数据库连接\n    > 15 |     await sequelize.authenticate();\n         |                     ^\n      16 |   });\n      17 |\n      18 |   afterAll(async () => {\n\n      at Object.authenticate (tests/integration/payment-optimization.test.js:15:21)\n\n\n  ● Test suite failed to run\n\n    TypeError: Cannot read properties of undefined (reading 'close')\n\n      18 |   afterAll(async () => {\n      19 |     // 关闭数据库连接\n    > 20 |     await sequelize.close();\n         |                     ^\n      21 |   });\n      22 |\n      23 |   beforeEach(async () => {\n\n      at Object.close (tests/integration/payment-optimization.test.js:20:21)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\payment-optimization.test.js","startTime":1762160888032,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["费用管理API测试","POST /api/expenses"],"duration":1,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 POST /api/expenses 应该成功创建费用记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功创建费用记录"},{"ancestorTitles":["费用管理API测试","POST /api/expenses"],"duration":1,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 POST /api/expenses 应该在未提供认证令牌时返回401","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在未提供认证令牌时返回401"},{"ancestorTitles":["费用管理API测试","POST /api/expenses"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 POST /api/expenses 应该在缺少必填字段时返回400","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在缺少必填字段时返回400"},{"ancestorTitles":["费用管理API测试","GET /api/expenses"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 GET /api/expenses 应该成功获取费用列表","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取费用列表"},{"ancestorTitles":["费用管理API测试","GET /api/expenses"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 GET /api/expenses 应该支持按寝室筛选费用","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该支持按寝室筛选费用"},{"ancestorTitles":["费用管理API测试","GET /api/expenses/:id"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 GET /api/expenses/:id 应该成功获取特定费用详情","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取特定费用详情"},{"ancestorTitles":["费用管理API测试","GET /api/expenses/:id"],"duration":1,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 GET /api/expenses/:id 应该在费用不存在时返回404","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在费用不存在时返回404"},{"ancestorTitles":["费用管理API测试","PUT /api/expenses/:id"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 PUT /api/expenses/:id 应该成功更新费用记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功更新费用记录"},{"ancestorTitles":["费用管理API测试","PUT /api/expenses/:id"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 PUT /api/expenses/:id 应该在费用不存在时返回404","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在费用不存在时返回404"},{"ancestorTitles":["费用管理API测试","POST /api/expenses/:id/confirm-split"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 POST /api/expenses/:id/confirm-split 应该成功确认分摊支付","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功确认分摊支付"},{"ancestorTitles":["费用管理API测试","POST /api/expenses/:id/confirm-split"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 POST /api/expenses/:id/confirm-split 应该在分摊ID不存在时返回400","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在分摊ID不存在时返回400"},{"ancestorTitles":["费用管理API测试","DELETE /api/expenses/:id"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 DELETE /api/expenses/:id 应该成功删除费用记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功删除费用记录"},{"ancestorTitles":["费用管理API测试","DELETE /api/expenses/:id"],"duration":0,"failureDetails":[{"length":126,"name":"error","severity":"ERROR","code":"42703","position":"37","file":"parse_target.c","line":"1073","routine":"checkInsertTargets"}],"failureMessages":["error: column \"password\" of relation \"users\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js:19:24)"],"fullName":"费用管理API测试 DELETE /api/expenses/:id 应该在费用不存在时返回404","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在费用不存在时返回404"}],"endTime":1762160869274,"message":"  ● 费用管理API测试 › POST /api/expenses › 应该成功创建费用记录\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n\n  ● 费用管理API测试 › POST /api/expenses › 应该在未提供认证令牌时返回401\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n\n  ● 费用管理API测试 › POST /api/expenses › 应该在缺少必填字段时返回400\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n\n  ● 费用管理API测试 › GET /api/expenses › 应该成功获取费用列表\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n\n  ● 费用管理API测试 › GET /api/expenses › 应该支持按寝室筛选费用\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n\n  ● 费用管理API测试 › GET /api/expenses/:id › 应该成功获取特定费用详情\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n\n  ● 费用管理API测试 › GET /api/expenses/:id › 应该在费用不存在时返回404\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n\n  ● 费用管理API测试 › PUT /api/expenses/:id › 应该成功更新费用记录\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n\n  ● 费用管理API测试 › PUT /api/expenses/:id › 应该在费用不存在时返回404\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n\n  ● 费用管理API测试 › POST /api/expenses/:id/confirm-split › 应该成功确认分摊支付\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n\n  ● 费用管理API测试 › POST /api/expenses/:id/confirm-split › 应该在分摊ID不存在时返回400\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n\n  ● 费用管理API测试 › DELETE /api/expenses/:id › 应该成功删除费用记录\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n\n  ● 费用管理API测试 › DELETE /api/expenses/:id › 应该在费用不存在时返回404\n\n    error: column \"password\" of relation \"users\" does not exist\n\n      17 |   beforeAll(async () => {\n      18 |     // 创建测试用户\n    > 19 |     const userResult = await pool.query(\n         |                        ^\n      20 |       'INSERT INTO users (username, email, password, role) VALUES ($1, $2, $3, $4) RETURNING *',\n      21 |       ['testuser', 'test@example.com', 'password123', 'user']\n      22 |     );\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/expenses.test.js:19:24)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses.test.js","startTime":1762160868490,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["统计控制器集成测试","GET /api/stats/user"],"duration":1,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/user 应该成功获取用户统计信息","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户统计信息"},{"ancestorTitles":["统计控制器集成测试","GET /api/stats/user"],"duration":0,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/user 应该在未认证时返回401错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在未认证时返回401错误"},{"ancestorTitles":["统计控制器集成测试","GET /api/stats/user"],"duration":0,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/user 应该在缺少日期参数时返回400错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在缺少日期参数时返回400错误"},{"ancestorTitles":["统计控制器集成测试","GET /api/stats/expense-types"],"duration":0,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/expense-types 应该成功获取费用类型分布","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取费用类型分布"},{"ancestorTitles":["统计控制器集成测试","GET /api/stats/expense-types"],"duration":0,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/expense-types 应该在未认证时返回401错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在未认证时返回401错误"},{"ancestorTitles":["统计控制器集成测试","GET /api/stats/daily-trend"],"duration":0,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/daily-trend 应该成功获取每日费用趋势","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取每日费用趋势"},{"ancestorTitles":["统计控制器集成测试","GET /api/stats/daily-trend"],"duration":0,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/daily-trend 应该在日期范围过大时返回400错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在日期范围过大时返回400错误"},{"ancestorTitles":["统计控制器集成测试","GET /api/stats/monthly-trend"],"duration":0,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/monthly-trend 应该成功获取每月费用趋势","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取每月费用趋势"},{"ancestorTitles":["统计控制器集成测试","GET /api/stats/monthly-trend"],"duration":0,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/monthly-trend 应该在日期范围过大时返回400错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在日期范围过大时返回400错误"},{"ancestorTitles":["统计控制器集成测试","GET /api/stats/room/:roomId"],"duration":0,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/room/:roomId 应该成功获取寝室统计信息","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取寝室统计信息"},{"ancestorTitles":["统计控制器集成测试","GET /api/stats/room/:roomId"],"duration":0,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/room/:roomId 应该在用户不是寝室成员时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不是寝室成员时返回403错误"},{"ancestorTitles":["统计控制器集成测试","GET /api/stats/room/:roomId/expense-types"],"duration":0,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/room/:roomId/expense-types 应该成功获取寝室费用类型分布","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取寝室费用类型分布"},{"ancestorTitles":["统计控制器集成测试","GET /api/stats/room/:roomId/monthly-trend"],"duration":0,"failureDetails":[{"length":107,"name":"error","severity":"ERROR","code":"42703","position":"28","file":"parse_relation.c","line":"3827","routine":"errorMissingColumn"}],"failureMessages":["error: column \"bill_id\" does not exist\n    at C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\pg-pool\\index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at Object.<anonymous> (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js:22:5)"],"fullName":"统计控制器集成测试 GET /api/stats/room/:roomId/monthly-trend 应该成功获取寝室每月费用趋势","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取寝室每月费用趋势"}],"coverage":{},"endTime":1762160888032,"message":"  ● 统计控制器集成测试 › GET /api/stats/user › 应该成功获取用户统计信息\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n  ● 统计控制器集成测试 › GET /api/stats/user › 应该在未认证时返回401错误\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n  ● 统计控制器集成测试 › GET /api/stats/user › 应该在缺少日期参数时返回400错误\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n  ● 统计控制器集成测试 › GET /api/stats/expense-types › 应该成功获取费用类型分布\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n  ● 统计控制器集成测试 › GET /api/stats/expense-types › 应该在未认证时返回401错误\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n  ● 统计控制器集成测试 › GET /api/stats/daily-trend › 应该成功获取每日费用趋势\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n  ● 统计控制器集成测试 › GET /api/stats/daily-trend › 应该在日期范围过大时返回400错误\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n  ● 统计控制器集成测试 › GET /api/stats/monthly-trend › 应该成功获取每月费用趋势\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n  ● 统计控制器集成测试 › GET /api/stats/monthly-trend › 应该在日期范围过大时返回400错误\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n  ● 统计控制器集成测试 › GET /api/stats/room/:roomId › 应该成功获取寝室统计信息\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n  ● 统计控制器集成测试 › GET /api/stats/room/:roomId › 应该在用户不是寝室成员时返回403错误\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n  ● 统计控制器集成测试 › GET /api/stats/room/:roomId/expense-types › 应该成功获取寝室费用类型分布\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n  ● 统计控制器集成测试 › GET /api/stats/room/:roomId/monthly-trend › 应该成功获取寝室每月费用趋势\n\n    error: column \"bill_id\" does not exist\n\n      20 |     \n      21 |     // 清理测试数据\n    > 22 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n         |     ^\n      23 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [1]);\n      24 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [1]);\n      25 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [1]);\n\n      at node_modules/pg-pool/index.js:45:11\n      at Object.<anonymous> (tests/integration/stats.test.js:22:5)\n\n\n  ● Test suite failed to run\n\n    TypeError: Cannot read properties of undefined (reading 'id')\n\n      129 |     \n      130 |     // 清理测试数据\n    > 131 |     await pool.query('DELETE FROM expenses WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [testUser.id]);\n          |                                                                                                                      ^\n      132 |     await pool.query('DELETE FROM bill_participants WHERE bill_id IN (SELECT id FROM bills WHERE created_by = $1)', [testUser.id]);\n      133 |     await pool.query('DELETE FROM bills WHERE created_by = $1', [testUser.id]);\n      134 |     await pool.query('DELETE FROM room_members WHERE user_id = $1', [testUser.id]);\n\n      at Object.id (tests/integration/stats.test.js:131:118)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\stats.test.js","startTime":1762160888032,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["通知服务测试","sendEmail"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: nodemailer.createTransporter is not a function\n    at Object.createTransporter [as sendEmail] (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:50:32)\n    at Object.sendEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:40:48)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"通知服务测试 sendEmail 应该在开发环境下模拟发送邮件","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在开发环境下模拟发送邮件"},{"ancestorTitles":["通知服务测试","sendEmail"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: nodemailer.createTransporter is not a function\n    at Object.createTransporter [as sendEmail] (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:50:32)\n    at Object.sendEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:75:48)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"通知服务测试 sendEmail 应该在生产环境下真实发送邮件","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在生产环境下真实发送邮件"},{"ancestorTitles":["通知服务测试","sendEmail"],"duration":1,"failureDetails":[{}],"failureMessages":["Error: 缺少必要的邮件参数\n    at Object.sendEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:30:13)\n    at Object.sendEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:116:48)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"通知服务测试 sendEmail 应该在邮件发送失败时返回错误信息","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在邮件发送失败时返回错误信息"},{"ancestorTitles":["通知服务测试","sendEmail"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"缺少必要参数\"\nReceived message:   \"缺少必要的邮件参数\"\n\n      28 |     // 检查必要参数\n      29 |     if (!to || !subject || (!message && !html)) {\n    > 30 |       throw new Error('缺少必要的邮件参数');\n         |             ^\n      31 |     }\n      32 |     \n      33 |     // 创建邮件传输器\n\n      at Object.sendEmail (utils/notification-service.js:30:13)\n      at Object.sendEmail (tests/unit/notification-service.test.js:137:40)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"缺少必要参数\"\nReceived message:   \"缺少必要的邮件参数\"\n\n      28 |     // 检查必要参数\n      29 |     if (!to || !subject || (!message && !html)) {\n    > 30 |       throw new Error('缺少必要的邮件参数');\n         |             ^\n      31 |     }\n      32 |     \n      33 |     // 创建邮件传输器\n\n      at Object.sendEmail (utils/notification-service.js:30:13)\n      at Object.sendEmail (tests/unit/notification-service.test.js:137:40)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"缺少必要参数\"\nReceived message:   \"缺少必要的邮件参数\"\n\n      28 |     // 检查必要参数\n      29 |     if (!to || !subject || (!message && !html)) {\n    > 30 |       throw new Error('缺少必要的邮件参数');\n         |             ^\n      31 |     }\n      32 |     \n      33 |     // 创建邮件传输器\n\n      at Object.sendEmail (utils/notification-service.js:30:13)\n      at Object.sendEmail (tests/unit/notification-service.test.js:137:40)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:138:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"通知服务测试 sendEmail 应该在缺少必要参数时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在缺少必要参数时抛出错误"},{"ancestorTitles":["通知服务测试","sendSMS"],"duration":3,"failureDetails":[{"matcherResult":{"actual":{"success":true,"sid":"dev-sid-1762160870508","status":"simulated"},"expected":{"success":true,"message":"短信发送成功(开发环境模拟)"},"message":"expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 2\n\n  Object {\n-   \"message\": \"短信发送成功(开发环境模拟)\",\n+   \"sid\": \"dev-sid-1762160870508\",\n+   \"status\": \"simulated\",\n    \"success\": true,\n  }","name":"toEqual","pass":false}}],"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 1\n+ Received  + 2\n\n  Object {\n-   \"message\": \"短信发送成功(开发环境模拟)\",\n+   \"sid\": \"dev-sid-1762160870508\",\n+   \"status\": \"simulated\",\n    \"success\": true,\n  }\n    at Object.toEqual (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:158:22)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"通知服务测试 sendSMS 应该在开发环境下模拟发送短信","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在开发环境下模拟发送短信"},{"ancestorTitles":["通知服务测试","sendSMS"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: {\"body\": \"这是一条测试短信\", \"from\": Any<String>, \"to\": \"+1234567890\"}\n\nNumber of calls: 0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: {\"body\": \"这是一条测试短信\", \"from\": Any<String>, \"to\": \"+1234567890\"}\n\nNumber of calls: 0\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:191:26)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"通知服务测试 sendSMS 应该在生产环境下真实发送短信","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"应该在生产环境下真实发送短信"},{"ancestorTitles":["通知服务测试","sendSMS"],"duration":0,"failureDetails":[{"matcherResult":{"actual":{"success":true,"sid":"dev-sid-1762160870512","status":"simulated"},"expected":{"success":false,"message":"短信发送失败: 短信发送失败"},"message":"expect(received).toEqual(expected) // deep equality\n\n- Expected  - 2\n+ Received  + 3\n\n  Object {\n-   \"message\": \"短信发送失败: 短信发送失败\",\n-   \"success\": false,\n+   \"sid\": \"dev-sid-1762160870512\",\n+   \"status\": \"simulated\",\n+   \"success\": true,\n  }","name":"toEqual","pass":false}}],"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 2\n+ Received  + 3\n\n  Object {\n-   \"message\": \"短信发送失败: 短信发送失败\",\n-   \"success\": false,\n+   \"sid\": \"dev-sid-1762160870512\",\n+   \"status\": \"simulated\",\n+   \"success\": true,\n  }\n    at Object.toEqual (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:227:22)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"通知服务测试 sendSMS 应该在短信发送失败时返回错误信息","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在短信发送失败时返回错误信息"},{"ancestorTitles":["通知服务测试","sendSMS"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"缺少必要参数\"\nReceived message:   \"缺少必要的短信参数\"\n\n      107 |     // 检查必要参数\n      108 |     if (!to || !message) {\n    > 109 |       throw new Error('缺少必要的短信参数');\n          |             ^\n      110 |     }\n      111 |     \n      112 |     // 在开发环境中，只记录日志而不实际发送短信\n\n      at Object.sendSMS (utils/notification-service.js:109:13)\n      at Object.sendSMS (tests/unit/notification-service.test.js:244:40)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"缺少必要参数\"\nReceived message:   \"缺少必要的短信参数\"\n\n      107 |     // 检查必要参数\n      108 |     if (!to || !message) {\n    > 109 |       throw new Error('缺少必要的短信参数');\n          |             ^\n      110 |     }\n      111 |     \n      112 |     // 在开发环境中，只记录日志而不实际发送短信\n\n      at Object.sendSMS (utils/notification-service.js:109:13)\n      at Object.sendSMS (tests/unit/notification-service.test.js:244:40)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"缺少必要参数\"\nReceived message:   \"缺少必要的短信参数\"\n\n      107 |     // 检查必要参数\n      108 |     if (!to || !message) {\n    > 109 |       throw new Error('缺少必要的短信参数');\n          |             ^\n      110 |     }\n      111 |     \n      112 |     // 在开发环境中，只记录日志而不实际发送短信\n\n      at Object.sendSMS (utils/notification-service.js:109:13)\n      at Object.sendSMS (tests/unit/notification-service.test.js:244:40)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:245:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"通知服务测试 sendSMS 应该在缺少必要参数时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在缺少必要参数时抛出错误"},{"ancestorTitles":["通知服务测试","sendPaymentReminderEmail"],"duration":0,"failureDetails":[{}],"failureMessages":["Error: 缺少必要的邮件参数\n    at sendEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:30:13)\n    at Object.sendEmail [as sendPaymentReminderEmail] (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:246:16)\n    at Object.sendPaymentReminderEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:263:48)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"通知服务测试 sendPaymentReminderEmail 应该成功发送支付提醒邮件","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功发送支付提醒邮件"},{"ancestorTitles":["通知服务测试","sendPaymentReminderEmail"],"duration":0,"failureDetails":[{}],"failureMessages":["Error: 缺少必要的邮件参数\n    at sendEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:30:13)\n    at Object.sendEmail [as sendPaymentReminderEmail] (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:246:16)\n    at Object.sendPaymentReminderEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:295:48)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"通知服务测试 sendPaymentReminderEmail 应该在邮件发送失败时返回错误信息","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在邮件发送失败时返回错误信息"},{"ancestorTitles":["通知服务测试","sendPaymentConfirmationEmail"],"duration":1,"failureDetails":[{}],"failureMessages":["Error: 缺少必要的邮件参数\n    at sendEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:30:13)\n    at Object.sendEmail [as sendPaymentConfirmationEmail] (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:291:16)\n    at Object.sendPaymentConfirmationEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:322:48)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"通知服务测试 sendPaymentConfirmationEmail 应该成功发送支付确认邮件","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功发送支付确认邮件"},{"ancestorTitles":["通知服务测试","sendPaymentConfirmationEmail"],"duration":0,"failureDetails":[{}],"failureMessages":["Error: 缺少必要的邮件参数\n    at sendEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:30:13)\n    at Object.sendEmail [as sendPaymentConfirmationEmail] (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:291:16)\n    at Object.sendPaymentConfirmationEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:355:48)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"通知服务测试 sendPaymentConfirmationEmail 应该在邮件发送失败时返回错误信息","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在邮件发送失败时返回错误信息"},{"ancestorTitles":["通知服务测试","sendBillShareEmail"],"duration":0,"failureDetails":[{}],"failureMessages":["Error: 缺少必要的邮件参数\n    at sendEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:30:13)\n    at Object.sendEmail [as sendBillShareEmail] (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:328:16)\n    at Object.sendBillShareEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:382:48)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"通知服务测试 sendBillShareEmail 应该成功发送账单分享邮件","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功发送账单分享邮件"},{"ancestorTitles":["通知服务测试","sendBillShareEmail"],"duration":1,"failureDetails":[{}],"failureMessages":["Error: 缺少必要的邮件参数\n    at sendEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:30:13)\n    at Object.sendEmail [as sendBillShareEmail] (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\utils\\notification-service.js:328:16)\n    at Object.sendBillShareEmail (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js:415:48)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"通知服务测试 sendBillShareEmail 应该在邮件发送失败时返回错误信息","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在邮件发送失败时返回错误信息"}],"endTime":1762160870526,"message":"  ● 通知服务测试 › sendEmail › 应该在开发环境下模拟发送邮件\n\n    TypeError: nodemailer.createTransporter is not a function\n\n      48 |     } else {\n      49 |       // 开发环境使用测试账户\n    > 50 |       transporter = nodemailer.createTransporter({\n         |                                ^\n      51 |         host: 'smtp.ethereal.email',\n      52 |         port: 587,\n      53 |         secure: false,\n\n      at Object.createTransporter [as sendEmail] (utils/notification-service.js:50:32)\n      at Object.sendEmail (tests/unit/notification-service.test.js:40:48)\n\n  ● 通知服务测试 › sendEmail › 应该在生产环境下真实发送邮件\n\n    TypeError: nodemailer.createTransporter is not a function\n\n      48 |     } else {\n      49 |       // 开发环境使用测试账户\n    > 50 |       transporter = nodemailer.createTransporter({\n         |                                ^\n      51 |         host: 'smtp.ethereal.email',\n      52 |         port: 587,\n      53 |         secure: false,\n\n      at Object.createTransporter [as sendEmail] (utils/notification-service.js:50:32)\n      at Object.sendEmail (tests/unit/notification-service.test.js:75:48)\n\n  ● 通知服务测试 › sendEmail › 应该在邮件发送失败时返回错误信息\n\n    缺少必要的邮件参数\n\n      28 |     // 检查必要参数\n      29 |     if (!to || !subject || (!message && !html)) {\n    > 30 |       throw new Error('缺少必要的邮件参数');\n         |             ^\n      31 |     }\n      32 |     \n      33 |     // 创建邮件传输器\n\n      at Object.sendEmail (utils/notification-service.js:30:13)\n      at Object.sendEmail (tests/unit/notification-service.test.js:116:48)\n\n  ● 通知服务测试 › sendEmail › 应该在缺少必要参数时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"缺少必要参数\"\n    Received message:   \"缺少必要的邮件参数\"\n\n          28 |     // 检查必要参数\n          29 |     if (!to || !subject || (!message && !html)) {\n        > 30 |       throw new Error('缺少必要的邮件参数');\n             |             ^\n          31 |     }\n          32 |     \n          33 |     // 创建邮件传输器\n\n      at Object.sendEmail (utils/notification-service.js:30:13)\n      at Object.sendEmail (tests/unit/notification-service.test.js:137:40)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/notification-service.test.js:138:18)\n\n  ● 通知服务测试 › sendSMS › 应该在开发环境下模拟发送短信\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 1\n    + Received  + 2\n\n      Object {\n    -   \"message\": \"短信发送成功(开发环境模拟)\",\n    +   \"sid\": \"dev-sid-1762160870508\",\n    +   \"status\": \"simulated\",\n        \"success\": true,\n      }\n\n      156 |\n      157 |       // 验证结果\n    > 158 |       expect(result).toEqual({\n          |                      ^\n      159 |         success: true,\n      160 |         message: '短信发送成功(开发环境模拟)'\n      161 |       });\n\n      at Object.toEqual (tests/unit/notification-service.test.js:158:22)\n\n  ● 通知服务测试 › sendSMS › 应该在生产环境下真实发送短信\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: {\"body\": \"这是一条测试短信\", \"from\": Any<String>, \"to\": \"+1234567890\"}\n\n    Number of calls: 0\n\n      189 |       // 验证结果\n      190 |       expect(twilio).toHaveBeenCalled();\n    > 191 |       expect(mockCreate).toHaveBeenCalledWith({\n          |                          ^\n      192 |         body: smsOptions.message,\n      193 |         from: expect.any(String),\n      194 |         to: smsOptions.to\n\n      at Object.toHaveBeenCalledWith (tests/unit/notification-service.test.js:191:26)\n\n  ● 通知服务测试 › sendSMS › 应该在短信发送失败时返回错误信息\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 2\n    + Received  + 3\n\n      Object {\n    -   \"message\": \"短信发送失败: 短信发送失败\",\n    -   \"success\": false,\n    +   \"sid\": \"dev-sid-1762160870512\",\n    +   \"status\": \"simulated\",\n    +   \"success\": true,\n      }\n\n      225 |\n      226 |       // 验证结果\n    > 227 |       expect(result).toEqual({\n          |                      ^\n      228 |         success: false,\n      229 |         message: '短信发送失败: 短信发送失败'\n      230 |       });\n\n      at Object.toEqual (tests/unit/notification-service.test.js:227:22)\n\n  ● 通知服务测试 › sendSMS › 应该在缺少必要参数时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"缺少必要参数\"\n    Received message:   \"缺少必要的短信参数\"\n\n          107 |     // 检查必要参数\n          108 |     if (!to || !message) {\n        > 109 |       throw new Error('缺少必要的短信参数');\n              |             ^\n          110 |     }\n          111 |     \n          112 |     // 在开发环境中，只记录日志而不实际发送短信\n\n      at Object.sendSMS (utils/notification-service.js:109:13)\n      at Object.sendSMS (tests/unit/notification-service.test.js:244:40)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/notification-service.test.js:245:18)\n\n  ● 通知服务测试 › sendPaymentReminderEmail › 应该成功发送支付提醒邮件\n\n    缺少必要的邮件参数\n\n      28 |     // 检查必要参数\n      29 |     if (!to || !subject || (!message && !html)) {\n    > 30 |       throw new Error('缺少必要的邮件参数');\n         |             ^\n      31 |     }\n      32 |     \n      33 |     // 创建邮件传输器\n\n      at sendEmail (utils/notification-service.js:30:13)\n      at Object.sendEmail [as sendPaymentReminderEmail] (utils/notification-service.js:246:16)\n      at Object.sendPaymentReminderEmail (tests/unit/notification-service.test.js:263:48)\n\n  ● 通知服务测试 › sendPaymentReminderEmail › 应该在邮件发送失败时返回错误信息\n\n    缺少必要的邮件参数\n\n      28 |     // 检查必要参数\n      29 |     if (!to || !subject || (!message && !html)) {\n    > 30 |       throw new Error('缺少必要的邮件参数');\n         |             ^\n      31 |     }\n      32 |     \n      33 |     // 创建邮件传输器\n\n      at sendEmail (utils/notification-service.js:30:13)\n      at Object.sendEmail [as sendPaymentReminderEmail] (utils/notification-service.js:246:16)\n      at Object.sendPaymentReminderEmail (tests/unit/notification-service.test.js:295:48)\n\n  ● 通知服务测试 › sendPaymentConfirmationEmail › 应该成功发送支付确认邮件\n\n    缺少必要的邮件参数\n\n      28 |     // 检查必要参数\n      29 |     if (!to || !subject || (!message && !html)) {\n    > 30 |       throw new Error('缺少必要的邮件参数');\n         |             ^\n      31 |     }\n      32 |     \n      33 |     // 创建邮件传输器\n\n      at sendEmail (utils/notification-service.js:30:13)\n      at Object.sendEmail [as sendPaymentConfirmationEmail] (utils/notification-service.js:291:16)\n      at Object.sendPaymentConfirmationEmail (tests/unit/notification-service.test.js:322:48)\n\n  ● 通知服务测试 › sendPaymentConfirmationEmail › 应该在邮件发送失败时返回错误信息\n\n    缺少必要的邮件参数\n\n      28 |     // 检查必要参数\n      29 |     if (!to || !subject || (!message && !html)) {\n    > 30 |       throw new Error('缺少必要的邮件参数');\n         |             ^\n      31 |     }\n      32 |     \n      33 |     // 创建邮件传输器\n\n      at sendEmail (utils/notification-service.js:30:13)\n      at Object.sendEmail [as sendPaymentConfirmationEmail] (utils/notification-service.js:291:16)\n      at Object.sendPaymentConfirmationEmail (tests/unit/notification-service.test.js:355:48)\n\n  ● 通知服务测试 › sendBillShareEmail › 应该成功发送账单分享邮件\n\n    缺少必要的邮件参数\n\n      28 |     // 检查必要参数\n      29 |     if (!to || !subject || (!message && !html)) {\n    > 30 |       throw new Error('缺少必要的邮件参数');\n         |             ^\n      31 |     }\n      32 |     \n      33 |     // 创建邮件传输器\n\n      at sendEmail (utils/notification-service.js:30:13)\n      at Object.sendEmail [as sendBillShareEmail] (utils/notification-service.js:328:16)\n      at Object.sendBillShareEmail (tests/unit/notification-service.test.js:382:48)\n\n  ● 通知服务测试 › sendBillShareEmail › 应该在邮件发送失败时返回错误信息\n\n    缺少必要的邮件参数\n\n      28 |     // 检查必要参数\n      29 |     if (!to || !subject || (!message && !html)) {\n    > 30 |       throw new Error('缺少必要的邮件参数');\n         |             ^\n      31 |     }\n      32 |     \n      33 |     // 创建邮件传输器\n\n      at sendEmail (utils/notification-service.js:30:13)\n      at Object.sendEmail [as sendBillShareEmail] (utils/notification-service.js:328:16)\n      at Object.sendBillShareEmail (tests/unit/notification-service.test.js:415:48)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\notification-service.test.js","startTime":1762160870033,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["ExpenseTypeController单元测试","createExpenseType"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:69:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 createExpenseType 应该成功创建费用类型","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功创建费用类型"},{"ancestorTitles":["ExpenseTypeController单元测试","createExpenseType"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"ExpenseTypeController单元测试 createExpenseType 应该在缺少必填字段时返回400错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该在缺少必填字段时返回400错误"},{"ancestorTitles":["ExpenseTypeController单元测试","createExpenseType"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:132:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 createExpenseType 应该在费用类型名称已存在时返回409错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在费用类型名称已存在时返回409错误"},{"ancestorTitles":["ExpenseTypeController单元测试","createExpenseType"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockRejectedValueOnce is not a function\n    at Object.mockRejectedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:157:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 createExpenseType 应该在数据库错误时返回500错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在数据库错误时返回500错误"},{"ancestorTitles":["ExpenseTypeController单元测试","getExpenseTypes"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:183:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 getExpenseTypes 应该成功获取费用类型列表","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取费用类型列表"},{"ancestorTitles":["ExpenseTypeController单元测试","getExpenseTypes"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:255:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 getExpenseTypes 应该支持按名称筛选费用类型","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该支持按名称筛选费用类型"},{"ancestorTitles":["ExpenseTypeController单元测试","getExpenseTypes"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:278:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 getExpenseTypes 应该支持按创建者筛选费用类型","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该支持按创建者筛选费用类型"},{"ancestorTitles":["ExpenseTypeController单元测试","getExpenseTypeById"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:298:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 getExpenseTypeById 应该成功获取费用类型详情","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取费用类型详情"},{"ancestorTitles":["ExpenseTypeController单元测试","getExpenseTypeById"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:336:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 getExpenseTypeById 应该在费用类型不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在费用类型不存在时返回404错误"},{"ancestorTitles":["ExpenseTypeController单元测试","updateExpenseType"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:365:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 updateExpenseType 应该成功更新费用类型信息","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功更新费用类型信息"},{"ancestorTitles":["ExpenseTypeController单元测试","updateExpenseType"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:403:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 updateExpenseType 应该在费用类型不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在费用类型不存在时返回404错误"},{"ancestorTitles":["ExpenseTypeController单元测试","updateExpenseType"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:424:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 updateExpenseType 应该在尝试修改系统默认费用类型时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在尝试修改系统默认费用类型时返回403错误"},{"ancestorTitles":["ExpenseTypeController单元测试","updateExpenseType"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:448:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 updateExpenseType 应该在用户不是创建者时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不是创建者时返回403错误"},{"ancestorTitles":["ExpenseTypeController单元测试","deleteExpenseType"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:473:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 deleteExpenseType 应该成功删除费用类型","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功删除费用类型"},{"ancestorTitles":["ExpenseTypeController单元测试","deleteExpenseType"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:495:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 deleteExpenseType 应该在费用类型不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在费用类型不存在时返回404错误"},{"ancestorTitles":["ExpenseTypeController单元测试","deleteExpenseType"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:515:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 deleteExpenseType 应该在尝试删除系统默认费用类型时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在尝试删除系统默认费用类型时返回403错误"},{"ancestorTitles":["ExpenseTypeController单元测试","deleteExpenseType"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:538:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 deleteExpenseType 应该在用户不是创建者时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不是创建者时返回403错误"},{"ancestorTitles":["ExpenseTypeController单元测试","deleteExpenseType"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:561:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 deleteExpenseType 应该在费用类型被使用时返回409错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在费用类型被使用时返回409错误"},{"ancestorTitles":["ExpenseTypeController单元测试","getDefaultExpenseTypes"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js:581:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseTypeController单元测试 getDefaultExpenseTypes 应该成功获取默认费用类型列表","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取默认费用类型列表"}],"endTime":1762160870972,"message":"  ● ExpenseTypeController单元测试 › createExpenseType › 应该成功创建费用类型\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      67 |       // 模拟数据库查询结果\n      68 |       mockPool.query\n    > 69 |         .mockResolvedValueOnce({ rows: [] }) // 检查名称是否已存在\n         |          ^\n      70 |         .mockResolvedValueOnce({\n      71 |           rows: [{\n      72 |             id: 1,\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:69:10)\n\n  ● ExpenseTypeController单元测试 › createExpenseType › 应该在费用类型名称已存在时返回409错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      130 |       \n      131 |       // 模拟数据库查询结果 - 名称已存在\n    > 132 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      133 |         rows: [{ id: 1, name: '餐饮' }]\n      134 |       });\n      135 |       \n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:132:22)\n\n  ● ExpenseTypeController单元测试 › createExpenseType › 应该在数据库错误时返回500错误\n\n    TypeError: mockPool.query.mockRejectedValueOnce is not a function\n\n      155 |       \n      156 |       // 模拟数据库错误\n    > 157 |       mockPool.query.mockRejectedValueOnce(new Error('数据库连接错误'));\n          |                      ^\n      158 |       \n      159 |       // 调用控制器方法\n      160 |       await expenseTypeController.createExpenseType(mockReq, mockRes);\n\n      at Object.mockRejectedValueOnce (tests/unit/expense-type-controller.test.js:157:22)\n\n  ● ExpenseTypeController单元测试 › getExpenseTypes › 应该成功获取费用类型列表\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      181 |       // 模拟数据库查询结果\n      182 |       mockPool.query\n    > 183 |         .mockResolvedValueOnce({\n          |          ^\n      184 |           rows: [\n      185 |             {\n      186 |               id: 1,\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:183:10)\n\n  ● ExpenseTypeController单元测试 › getExpenseTypes › 应该支持按名称筛选费用类型\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      253 |       // 模拟数据库查询结果\n      254 |       mockPool.query\n    > 255 |         .mockResolvedValueOnce({ rows: [] }) // 获取费用类型列表\n          |          ^\n      256 |         .mockResolvedValueOnce({ rows: [{ count: 0 }] }); // 获取总数\n      257 |       \n      258 |       // 调用控制器方法\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:255:10)\n\n  ● ExpenseTypeController单元测试 › getExpenseTypes › 应该支持按创建者筛选费用类型\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      276 |       // 模拟数据库查询结果\n      277 |       mockPool.query\n    > 278 |         .mockResolvedValueOnce({ rows: [] }) // 获取费用类型列表\n          |          ^\n      279 |         .mockResolvedValueOnce({ rows: [{ count: 0 }] }); // 获取总数\n      280 |       \n      281 |       // 调用控制器方法\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:278:10)\n\n  ● ExpenseTypeController单元测试 › getExpenseTypeById › 应该成功获取费用类型详情\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      296 |       \n      297 |       // 模拟数据库查询结果\n    > 298 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      299 |         rows: [{\n      300 |           id: 1,\n      301 |           name: '餐饮',\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:298:22)\n\n  ● ExpenseTypeController单元测试 › getExpenseTypeById › 应该在费用类型不存在时返回404错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      334 |       \n      335 |       // 模拟数据库查询结果 - 费用类型不存在\n    > 336 |       mockPool.query.mockResolvedValueOnce({ rows: [] });\n          |                      ^\n      337 |       \n      338 |       // 调用控制器方法\n      339 |       await expenseTypeController.getExpenseTypeById(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:336:22)\n\n  ● ExpenseTypeController单元测试 › updateExpenseType › 应该成功更新费用类型信息\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      363 |       // 模拟数据库查询结果\n      364 |       mockPool.query\n    > 365 |         .mockResolvedValueOnce({ rows: [{ id: 1, name: '餐饮', is_default: false, created_by: 1 }] }) // 获取费用类型信息\n          |          ^\n      366 |         .mockResolvedValueOnce({ rows: [] }) // 检查新名称是否与其他费用类型冲突\n      367 |         .mockResolvedValueOnce({\n      368 |           rows: [{\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:365:10)\n\n  ● ExpenseTypeController单元测试 › updateExpenseType › 应该在费用类型不存在时返回404错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      401 |       \n      402 |       // 模拟数据库查询结果 - 费用类型不存在\n    > 403 |       mockPool.query.mockResolvedValueOnce({ rows: [] });\n          |                      ^\n      404 |       \n      405 |       // 调用控制器方法\n      406 |       await expenseTypeController.updateExpenseType(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:403:22)\n\n  ● ExpenseTypeController单元测试 › updateExpenseType › 应该在尝试修改系统默认费用类型时返回403错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      422 |       \n      423 |       // 模拟数据库查询结果 - 系统默认费用类型\n    > 424 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      425 |         rows: [{ id: 1, name: '餐饮', is_default: true, created_by: null }]\n      426 |       });\n      427 |       \n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:424:22)\n\n  ● ExpenseTypeController单元测试 › updateExpenseType › 应该在用户不是创建者时返回403错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      446 |       \n      447 |       // 模拟数据库查询结果 - 费用类型存在但创建者不是当前用户\n    > 448 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      449 |         rows: [{ id: 1, name: '餐饮', is_default: false, created_by: 1 }]\n      450 |       });\n      451 |       \n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:448:22)\n\n  ● ExpenseTypeController单元测试 › deleteExpenseType › 应该成功删除费用类型\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      471 |       // 模拟数据库查询结果\n      472 |       mockPool.query\n    > 473 |         .mockResolvedValueOnce({ rows: [{ id: 1, name: '餐饮', is_default: false, created_by: 1 }] }) // 获取费用类型信息\n          |          ^\n      474 |         .mockResolvedValueOnce({ rows: [] }) // 检查是否有账单使用此费用类型\n      475 |         .mockResolvedValueOnce({}); // 删除费用类型\n      476 |       \n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:473:10)\n\n  ● ExpenseTypeController单元测试 › deleteExpenseType › 应该在费用类型不存在时返回404错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      493 |       \n      494 |       // 模拟数据库查询结果 - 费用类型不存在\n    > 495 |       mockPool.query.mockResolvedValueOnce({ rows: [] });\n          |                      ^\n      496 |       \n      497 |       // 调用控制器方法\n      498 |       await expenseTypeController.deleteExpenseType(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:495:22)\n\n  ● ExpenseTypeController单元测试 › deleteExpenseType › 应该在尝试删除系统默认费用类型时返回403错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      513 |       \n      514 |       // 模拟数据库查询结果 - 系统默认费用类型\n    > 515 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      516 |         rows: [{ id: 1, name: '餐饮', is_default: true, created_by: null }]\n      517 |       });\n      518 |       \n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:515:22)\n\n  ● ExpenseTypeController单元测试 › deleteExpenseType › 应该在用户不是创建者时返回403错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      536 |       \n      537 |       // 模拟数据库查询结果 - 费用类型存在但创建者不是当前用户\n    > 538 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      539 |         rows: [{ id: 1, name: '餐饮', is_default: false, created_by: 1 }]\n      540 |       });\n      541 |       \n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:538:22)\n\n  ● ExpenseTypeController单元测试 › deleteExpenseType › 应该在费用类型被使用时返回409错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      559 |       // 模拟数据库查询结果\n      560 |       mockPool.query\n    > 561 |         .mockResolvedValueOnce({ rows: [{ id: 1, name: '餐饮', is_default: false, created_by: 1 }] }) // 获取费用类型信息\n          |          ^\n      562 |         .mockResolvedValueOnce({ rows: [{ id: 1 }] }); // 有账单使用此费用类型\n      563 |       \n      564 |       // 调用控制器方法\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:561:10)\n\n  ● ExpenseTypeController单元测试 › getDefaultExpenseTypes › 应该成功获取默认费用类型列表\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      579 |     it('应该成功获取默认费用类型列表', async () => {\n      580 |       // 模拟数据库查询结果\n    > 581 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      582 |         rows: [\n      583 |           {\n      584 |             id: 1,\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-type-controller.test.js:581:22)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-type-controller.test.js","startTime":1762160870540,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["UserController单元测试","register"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:86:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 register 应该成功注册新用户","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功注册新用户"},{"ancestorTitles":["UserController单元测试","register"],"duration":1,"failureDetails":[{}],"failureMessages":["Error: expect(received).not.toHaveBeenCalled()\n\nMatcher error: received value must be a mock or spy function\n\nReceived has type:  function\nReceived has value: [Function query]\n    at Object.toHaveBeenCalled (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:140:34)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"UserController单元测试 register 应该在缺少必填字段时返回400错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"应该在缺少必填字段时返回400错误"},{"ancestorTitles":["UserController单元测试","register"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:152:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 register 应该在用户名已存在时返回409错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户名已存在时返回409错误"},{"ancestorTitles":["UserController单元测试","register"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:180:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 register 应该在邮箱已存在时返回409错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在邮箱已存在时返回409错误"},{"ancestorTitles":["UserController单元测试","register"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockRejectedValueOnce is not a function\n    at Object.mockRejectedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:208:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 register 应该在数据库错误时返回500错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在数据库错误时返回500错误"},{"ancestorTitles":["UserController单元测试","login"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:233:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 login 应该成功登录并返回token","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功登录并返回token"},{"ancestorTitles":["UserController单元测试","login"],"duration":1,"failureDetails":[{}],"failureMessages":["Error: expect(received).not.toHaveBeenCalled()\n\nMatcher error: received value must be a mock or spy function\n\nReceived has type:  function\nReceived has value: [Function query]\n    at Object.toHaveBeenCalled (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:300:34)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"UserController单元测试 login 应该在缺少必填字段时返回400错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"应该在缺少必填字段时返回400错误"},{"ancestorTitles":["UserController单元测试","login"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:311:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 login 应该在用户不存在时返回401错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不存在时返回401错误"},{"ancestorTitles":["UserController单元测试","login"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:340:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 login 应该在密码错误时返回401错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在密码错误时返回401错误"},{"ancestorTitles":["UserController单元测试","login"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockRejectedValueOnce is not a function\n    at Object.mockRejectedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:378:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 login 应该在数据库错误时返回500错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在数据库错误时返回500错误"},{"ancestorTitles":["UserController单元测试","refreshToken"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:406:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 refreshToken 应该成功刷新token","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功刷新token"},{"ancestorTitles":["UserController单元测试","refreshToken"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"UserController单元测试 refreshToken 应该在缺少刷新token时返回400错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该在缺少刷新token时返回400错误"},{"ancestorTitles":["UserController单元测试","getProfile"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:473:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 getProfile 应该成功获取用户资料","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户资料"},{"ancestorTitles":["UserController单元测试","getProfile"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:512:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 getProfile 应该在用户不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不存在时返回404错误"},{"ancestorTitles":["UserController单元测试","updateProfile"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:540:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 updateProfile 应该成功更新用户资料","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功更新用户资料"},{"ancestorTitles":["UserController单元测试","updateProfile"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:588:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 updateProfile 应该在邮箱已被其他用户使用时返回409错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在邮箱已被其他用户使用时返回409错误"},{"ancestorTitles":["UserController单元测试","changePassword"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:616:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 changePassword 应该成功修改密码","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功修改密码"},{"ancestorTitles":["UserController单元测试","changePassword"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js:655:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"UserController单元测试 changePassword 应该在当前密码错误时返回400错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在当前密码错误时返回400错误"}],"endTime":1762160871411,"message":"  ● UserController单元测试 › register › 应该成功注册新用户\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      84 |       // 模拟数据库查询结果\n      85 |       mockPool.query\n    > 86 |         .mockResolvedValueOnce({ rows: [] }) // 用户名不存在\n         |          ^\n      87 |         .mockResolvedValueOnce({ rows: [] }) // 邮箱不存在\n      88 |         .mockResolvedValueOnce({ rows: [{ id: 1 }] }) // 插入用户成功\n      89 |         .mockResolvedValueOnce({ rows: [{ id: 1, username: 'testuser', email: 'test@example.com', name: 'Test User' }] }); // 获取用户信息\n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:86:10)\n\n  ● UserController单元测试 › register › 应该在缺少必填字段时返回400错误\n\n    expect(received).not.toHaveBeenCalled()\n\n    Matcher error: received value must be a mock or spy function\n\n    Received has type:  function\n    Received has value: [Function query]\n\n      138 |       \n      139 |       // 验证数据库查询未被调用\n    > 140 |       expect(mockPool.query).not.toHaveBeenCalled();\n          |                                  ^\n      141 |     });\n      142 |     \n      143 |     it('应该在用户名已存在时返回409错误', async () => {\n\n      at Object.toHaveBeenCalled (tests/unit/user-controller.test.js:140:34)\n\n  ● UserController单元测试 › register › 应该在用户名已存在时返回409错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      150 |       \n      151 |       // 模拟数据库查询结果 - 用户名已存在\n    > 152 |       mockPool.query.mockResolvedValueOnce({ rows: [{ id: 1 }] });\n          |                      ^\n      153 |       \n      154 |       // 调用控制器方法\n      155 |       await userController.register(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:152:22)\n\n  ● UserController单元测试 › register › 应该在邮箱已存在时返回409错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      178 |       // 模拟数据库查询结果\n      179 |       mockPool.query\n    > 180 |         .mockResolvedValueOnce({ rows: [] }) // 用户名不存在\n          |          ^\n      181 |         .mockResolvedValueOnce({ rows: [{ id: 1 }] }); // 邮箱已存在\n      182 |       \n      183 |       // 调用控制器方法\n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:180:10)\n\n  ● UserController单元测试 › register › 应该在数据库错误时返回500错误\n\n    TypeError: mockPool.query.mockRejectedValueOnce is not a function\n\n      206 |       \n      207 |       // 模拟数据库错误\n    > 208 |       mockPool.query.mockRejectedValueOnce(new Error('数据库连接错误'));\n          |                      ^\n      209 |       \n      210 |       // 调用控制器方法\n      211 |       await userController.register(mockReq, mockRes);\n\n      at Object.mockRejectedValueOnce (tests/unit/user-controller.test.js:208:22)\n\n  ● UserController单元测试 › login › 应该成功登录并返回token\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      231 |       \n      232 |       // 模拟数据库查询结果 - 用户存在\n    > 233 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      234 |         rows: [{\n      235 |           id: 1,\n      236 |           username: 'testuser',\n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:233:22)\n\n  ● UserController单元测试 › login › 应该在缺少必填字段时返回400错误\n\n    expect(received).not.toHaveBeenCalled()\n\n    Matcher error: received value must be a mock or spy function\n\n    Received has type:  function\n    Received has value: [Function query]\n\n      298 |       \n      299 |       // 验证数据库查询未被调用\n    > 300 |       expect(mockPool.query).not.toHaveBeenCalled();\n          |                                  ^\n      301 |     });\n      302 |     \n      303 |     it('应该在用户不存在时返回401错误', async () => {\n\n      at Object.toHaveBeenCalled (tests/unit/user-controller.test.js:300:34)\n\n  ● UserController单元测试 › login › 应该在用户不存在时返回401错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      309 |       \n      310 |       // 模拟数据库查询结果 - 用户不存在\n    > 311 |       mockPool.query.mockResolvedValueOnce({ rows: [] });\n          |                      ^\n      312 |       \n      313 |       // 调用控制器方法\n      314 |       await userController.login(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:311:22)\n\n  ● UserController单元测试 › login › 应该在密码错误时返回401错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      338 |       \n      339 |       // 模拟数据库查询结果 - 用户存在\n    > 340 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      341 |         rows: [{\n      342 |           id: 1,\n      343 |           username: 'testuser',\n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:340:22)\n\n  ● UserController单元测试 › login › 应该在数据库错误时返回500错误\n\n    TypeError: mockPool.query.mockRejectedValueOnce is not a function\n\n      376 |       \n      377 |       // 模拟数据库错误\n    > 378 |       mockPool.query.mockRejectedValueOnce(new Error('数据库连接错误'));\n          |                      ^\n      379 |       \n      380 |       // 调用控制器方法\n      381 |       await userController.login(mockReq, mockRes);\n\n      at Object.mockRejectedValueOnce (tests/unit/user-controller.test.js:378:22)\n\n  ● UserController单元测试 › refreshToken › 应该成功刷新token\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      404 |       \n      405 |       // 模拟数据库查询结果\n    > 406 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      407 |         rows: [{\n      408 |           id: 1,\n      409 |           username: 'testuser',\n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:406:22)\n\n  ● UserController单元测试 › getProfile › 应该成功获取用户资料\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      471 |       \n      472 |       // 模拟数据库查询结果\n    > 473 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      474 |         rows: [{\n      475 |           id: 1,\n      476 |           username: 'testuser',\n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:473:22)\n\n  ● UserController单元测试 › getProfile › 应该在用户不存在时返回404错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      510 |       \n      511 |       // 模拟数据库查询结果 - 用户不存在\n    > 512 |       mockPool.query.mockResolvedValueOnce({ rows: [] });\n          |                      ^\n      513 |       \n      514 |       // 调用控制器方法\n      515 |       await userController.getProfile(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:512:22)\n\n  ● UserController单元测试 › updateProfile › 应该成功更新用户资料\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      538 |       // 模拟数据库查询结果\n      539 |       mockPool.query\n    > 540 |         .mockResolvedValueOnce({ rows: [{ id: 1, username: 'testuser', email: 'test@example.com' }] }) // 用户存在\n          |          ^\n      541 |         .mockResolvedValueOnce({ rows: [] }) // 邮箱未被其他用户使用\n      542 |         .mockResolvedValueOnce({ // 更新成功，返回更新后的用户信息\n      543 |           rows: [{\n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:540:10)\n\n  ● UserController单元测试 › updateProfile › 应该在邮箱已被其他用户使用时返回409错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      586 |       // 模拟数据库查询结果\n      587 |       mockPool.query\n    > 588 |         .mockResolvedValueOnce({ rows: [{ id: 1 }] }) // 用户存在\n          |          ^\n      589 |         .mockResolvedValueOnce({ rows: [{ id: 2 }] }); // 邮箱已被其他用户使用\n      590 |       \n      591 |       // 调用控制器方法\n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:588:10)\n\n  ● UserController单元测试 › changePassword › 应该成功修改密码\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      614 |       // 模拟数据库查询结果\n      615 |       mockPool.query\n    > 616 |         .mockResolvedValueOnce({\n          |          ^\n      617 |           rows: [{ id: 1, password_hash: 'hashedCurrentPassword' }]\n      618 |         }) // 获取用户当前密码\n      619 |         .mockResolvedValueOnce({ rows: [{ id: 1 }] }); // 更新密码成功\n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:616:10)\n\n  ● UserController单元测试 › changePassword › 应该在当前密码错误时返回400错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      653 |       \n      654 |       // 模拟数据库查询结果\n    > 655 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      656 |         rows: [{ id: 1, password_hash: 'hashedCurrentPassword' }]\n      657 |       });\n      658 |       \n\n      at Object.mockResolvedValueOnce (tests/unit/user-controller.test.js:655:22)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\user-controller.test.js","startTime":1762160870987,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["支付记录查询服务测试","getPaymentRecords"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"include\": ArrayContaining [ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}, ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 20, \"offset\": 0, \"order\": [[\"created_at\", \"DESC\"]], \"where\": ObjectContaining {\"bill_id\": 1, \"created_at\": ObjectContaining {\"Any\": Any<Object>}, \"status\": \"completed\", \"user_id\": 1}}\nReceived: {\"include\": [{\"as\": \"bill\", \"attributes\": [\"id\", \"title\", \"amount\", \"dueDate\", \"status\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"user\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": 0, \"order\": [[\"createdAt\", \"DESC\"]], \"where\": {\"billId\": 1, \"paymentTime\": {Symbol(gte): 2023-01-01T00:00:00.000Z, Symbol(lte): 2023-12-31T15:59:59.000Z}, \"status\": \"completed\", \"userId\": 1}}\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"include\": ArrayContaining [ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}, ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 20, \"offset\": 0, \"order\": [[\"created_at\", \"DESC\"]], \"where\": ObjectContaining {\"bill_id\": 1, \"created_at\": ObjectContaining {\"Any\": Any<Object>}, \"status\": \"completed\", \"user_id\": 1}}\nReceived: {\"include\": [{\"as\": \"bill\", \"attributes\": [\"id\", \"title\", \"amount\", \"dueDate\", \"status\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"user\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": 0, \"order\": [[\"createdAt\", \"DESC\"]], \"where\": {\"billId\": 1, \"paymentTime\": {Symbol(gte): 2023-01-01T00:00:00.000Z, Symbol(lte): 2023-12-31T15:59:59.000Z}, \"status\": \"completed\", \"userId\": 1}}\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:100:39)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"支付记录查询服务测试 getPaymentRecords 应该成功获取支付记录列表","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取支付记录列表"},{"ancestorTitles":["支付记录查询服务测试","getPaymentRecords"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"offset\": 0}\nReceived: {\"include\": [{\"as\": \"bill\", \"attributes\": [\"id\", \"title\", \"amount\", \"dueDate\", \"status\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"user\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": -20, \"order\": [[\"createdAt\", \"DESC\"]], \"where\": {}}\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"offset\": 0}\nReceived: {\"include\": [{\"as\": \"bill\", \"attributes\": [\"id\", \"title\", \"amount\", \"dueDate\", \"status\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"user\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": -20, \"order\": [[\"createdAt\", \"DESC\"]], \"where\": {}}\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:189:39)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"支付记录查询服务测试 getPaymentRecords 应该在页码无效时使用默认值","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在页码无效时使用默认值"},{"ancestorTitles":["支付记录查询服务测试","getPaymentRecords"],"duration":0,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"limit\": 20}\nReceived: {\"include\": [{\"as\": \"bill\", \"attributes\": [\"id\", \"title\", \"amount\", \"dueDate\", \"status\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"user\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": 0, \"order\": [[\"createdAt\", \"DESC\"]], \"where\": {}}\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"limit\": 20}\nReceived: {\"include\": [{\"as\": \"bill\", \"attributes\": [\"id\", \"title\", \"amount\", \"dueDate\", \"status\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"user\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": 0, \"order\": [[\"createdAt\", \"DESC\"]], \"where\": {}}\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:215:39)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"支付记录查询服务测试 getPaymentRecords 应该在每页数量无效时使用默认值","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在每页数量无效时使用默认值"},{"ancestorTitles":["支付记录查询服务测试","getPaymentRecords"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"支付记录查询服务测试 getPaymentRecords 应该在数据库查询失败时抛出错误","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"应该在数据库查询失败时抛出错误"},{"ancestorTitles":["支付记录查询服务测试","getPaymentRecordById"],"duration":3,"failureDetails":[{"matcherResult":{"actual":{"id":1,"bill_id":1,"user_id":1,"amount":100.5,"status":"completed","payment_method":"alipay","created_at":{},"updated_at":{},"Bill":{"id":1,"title":"测试账单","description":"测试账单描述"},"User":{"id":1,"username":"testuser","email":"test@example.com"}},"expected":{"id":1,"billId":1,"userId":1,"amount":100.5,"status":"completed","paymentMethod":"alipay","createdAt":{"inverse":false},"updatedAt":{"inverse":false},"Bill":{"id":1,"title":"测试账单","description":"测试账单描述"},"User":{"id":1,"username":"testuser","email":"test@example.com"}},"message":"expect(received).toEqual(expected) // deep equality\n\n- Expected  - 5\n+ Received  + 5\n\n@@ -8,13 +8,13 @@\n      \"email\": \"test@example.com\",\n      \"id\": 1,\n      \"username\": \"testuser\",\n    },\n    \"amount\": 100.5,\n-   \"billId\": 1,\n-   \"createdAt\": Any<Date>,\n+   \"bill_id\": 1,\n+   \"created_at\": 2023-06-15T00:00:00.000Z,\n    \"id\": 1,\n-   \"paymentMethod\": \"alipay\",\n+   \"payment_method\": \"alipay\",\n    \"status\": \"completed\",\n-   \"updatedAt\": Any<Date>,\n-   \"userId\": 1,\n+   \"updated_at\": 2023-06-15T00:00:00.000Z,\n+   \"user_id\": 1,\n  }","name":"toEqual","pass":false}}],"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 5\n+ Received  + 5\n\n@@ -8,13 +8,13 @@\n      \"email\": \"test@example.com\",\n      \"id\": 1,\n      \"username\": \"testuser\",\n    },\n    \"amount\": 100.5,\n-   \"billId\": 1,\n-   \"createdAt\": Any<Date>,\n+   \"bill_id\": 1,\n+   \"created_at\": 2023-06-15T00:00:00.000Z,\n    \"id\": 1,\n-   \"paymentMethod\": \"alipay\",\n+   \"payment_method\": \"alipay\",\n    \"status\": \"completed\",\n-   \"updatedAt\": Any<Date>,\n-   \"userId\": 1,\n+   \"updated_at\": 2023-06-15T00:00:00.000Z,\n+   \"user_id\": 1,\n  }\n    at Object.toEqual (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:281:22)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"支付记录查询服务测试 getPaymentRecordById 应该成功获取支付记录详情","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"应该成功获取支付记录详情"},{"ancestorTitles":["支付记录查询服务测试","getPaymentRecordById"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付记录查询服务测试 getPaymentRecordById 应该在支付记录不存在时返回null","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"应该在支付记录不存在时返回null"},{"ancestorTitles":["支付记录查询服务测试","getPaymentRecordById"],"duration":1,"failureDetails":[{"message":"expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: null"}],"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: null\n    at expect (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:113:15)\n    at Object.expect (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:322:13)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付记录查询服务测试 getPaymentRecordById 应该在支付ID无效时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在支付ID无效时抛出错误"},{"ancestorTitles":["支付记录查询服务测试","getUserPaymentStats"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: Payment.findAll is not a function\n    at Object.findAll [as getUserPaymentStats] (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-query-service.js:228:36)\n    at Object.getUserPaymentStats (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:365:48)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付记录查询服务测试 getUserPaymentStats 应该成功获取用户支付统计","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户支付统计"},{"ancestorTitles":["支付记录查询服务测试","getUserPaymentStats"],"duration":11,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"用户ID无效\"\nReceived message:   \"Cannot destructure property 'userId' of 'queryParams' as it is null.\"\n\n      187 |     \n      188 |     const {\n    > 189 |       userId,\n          |       ^\n      190 |       startDate,\n      191 |       endDate,\n      192 |       roomId\n\n      at Object.userId [as getUserPaymentStats] (services/payment-query-service.js:189:7)\n      at Object.getUserPaymentStats (tests/unit/payment-query-service.test.js:398:40)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"用户ID无效\"\nReceived message:   \"Cannot destructure property 'userId' of 'queryParams' as it is null.\"\n\n      187 |     \n      188 |     const {\n    > 189 |       userId,\n          |       ^\n      190 |       startDate,\n      191 |       endDate,\n      192 |       roomId\n\n      at Object.userId [as getUserPaymentStats] (services/payment-query-service.js:189:7)\n      at Object.getUserPaymentStats (tests/unit/payment-query-service.test.js:398:40)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"用户ID无效\"\nReceived message:   \"Cannot destructure property 'userId' of 'queryParams' as it is null.\"\n\n      187 |     \n      188 |     const {\n    > 189 |       userId,\n          |       ^\n      190 |       startDate,\n      191 |       endDate,\n      192 |       roomId\n\n      at Object.userId [as getUserPaymentStats] (services/payment-query-service.js:189:7)\n      at Object.getUserPaymentStats (tests/unit/payment-query-service.test.js:398:40)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:399:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付记录查询服务测试 getUserPaymentStats 应该在用户ID无效时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户ID无效时抛出错误"},{"ancestorTitles":["支付记录查询服务测试","getBillPayments"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"include\": ArrayContaining [ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 20, \"offset\": 0, \"order\": [[\"created_at\", \"DESC\"]], \"where\": ObjectContaining {\"bill_id\": 1}}\nReceived: {\"include\": [{\"as\": \"user\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": 0, \"order\": [[\"paymentTime\", \"DESC\"]], \"where\": {\"billId\": 1}}\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"include\": ArrayContaining [ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 20, \"offset\": 0, \"order\": [[\"created_at\", \"DESC\"]], \"where\": ObjectContaining {\"bill_id\": 1}}\nReceived: {\"include\": [{\"as\": \"user\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": 0, \"order\": [[\"paymentTime\", \"DESC\"]], \"where\": {\"billId\": 1}}\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:451:39)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"支付记录查询服务测试 getBillPayments 应该成功获取账单支付记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取账单支付记录"},{"ancestorTitles":["支付记录查询服务测试","getBillPayments"],"duration":1,"failureDetails":[{"message":"expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: {\"items\": [{\"User\": {\"email\": \"test@example.com\", \"id\": 1, \"username\": \"testuser\"}, \"amount\": 100.5, \"bill_id\": 1, \"created_at\": 2023-06-15T00:00:00.000Z, \"id\": 1, \"payment_method\": \"alipay\", \"status\": \"completed\", \"user_id\": 1}, {\"User\": {\"email\": \"test2@example.com\", \"id\": 2, \"username\": \"testuser2\"}, \"amount\": 50, \"bill_id\": 1, \"created_at\": 2023-06-20T00:00:00.000Z, \"id\": 2, \"payment_method\": \"wechat\", \"status\": \"pending\", \"user_id\": 2}], \"page\": 1, \"pageSize\": 10, \"total\": 2, \"totalPages\": 1}"}],"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: {\"items\": [{\"User\": {\"email\": \"test@example.com\", \"id\": 1, \"username\": \"testuser\"}, \"amount\": 100.5, \"bill_id\": 1, \"created_at\": 2023-06-15T00:00:00.000Z, \"id\": 1, \"payment_method\": \"alipay\", \"status\": \"completed\", \"user_id\": 1}, {\"User\": {\"email\": \"test2@example.com\", \"id\": 2, \"username\": \"testuser2\"}, \"amount\": 50, \"bill_id\": 1, \"created_at\": 2023-06-20T00:00:00.000Z, \"id\": 2, \"payment_method\": \"wechat\", \"status\": \"pending\", \"user_id\": 2}], \"page\": 1, \"pageSize\": 10, \"total\": 2, \"totalPages\": 1}\n    at expect (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:113:15)\n    at Object.expect (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:508:13)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付记录查询服务测试 getBillPayments 应该在账单ID无效时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在账单ID无效时抛出错误"},{"ancestorTitles":["支付记录查询服务测试","getUserPaymentTransfers"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"include\": ArrayContaining [ObjectContaining {\"as\": \"FromPayment\", \"include\": ArrayContaining [ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}], \"model\": {\"findAndCountAll\": [Function mockConstructor], \"findByPk\": [Function mockConstructor]}}, ObjectContaining {\"as\": \"ToPayment\", \"include\": ArrayContaining [ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}], \"model\": {\"findAndCountAll\": [Function mockConstructor], \"findByPk\": [Function mockConstructor]}}], \"limit\": 20, \"offset\": 0, \"order\": [[\"created_at\", \"DESC\"]], \"where\": ObjectContaining {\"Any\": ObjectContaining {\"Any\": 1}}}\nReceived: {\"include\": [{\"as\": \"bill\", \"attributes\": [\"id\", \"title\", \"amount\", \"status\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"fromUser\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"toUser\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": 0, \"order\": [[\"createdAt\", \"DESC\"]], \"where\": {Symbol(or): [{\"fromUserId\": 1}, {\"toUserId\": 1}]}}\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"include\": ArrayContaining [ObjectContaining {\"as\": \"FromPayment\", \"include\": ArrayContaining [ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}], \"model\": {\"findAndCountAll\": [Function mockConstructor], \"findByPk\": [Function mockConstructor]}}, ObjectContaining {\"as\": \"ToPayment\", \"include\": ArrayContaining [ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}], \"model\": {\"findAndCountAll\": [Function mockConstructor], \"findByPk\": [Function mockConstructor]}}], \"limit\": 20, \"offset\": 0, \"order\": [[\"created_at\", \"DESC\"]], \"where\": ObjectContaining {\"Any\": ObjectContaining {\"Any\": 1}}}\nReceived: {\"include\": [{\"as\": \"bill\", \"attributes\": [\"id\", \"title\", \"amount\", \"status\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"fromUser\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"toUser\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": 0, \"order\": [[\"createdAt\", \"DESC\"]], \"where\": {Symbol(or): [{\"fromUserId\": 1}, {\"toUserId\": 1}]}}\n\nNumber of calls: 1\n    at Object.toHaveBeenCalledWith (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:559:47)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"支付记录查询服务测试 getUserPaymentTransfers 应该成功获取用户支付转移记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户支付转移记录"},{"ancestorTitles":["支付记录查询服务测试","getUserPaymentTransfers"],"duration":0,"failureDetails":[{"message":"expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: {\"items\": [{\"FromPayment\": {\"Bill\": {\"id\": 1, \"title\": \"测试账单\"}, \"amount\": 100.5, \"bill_id\": 1, \"id\": 1}, \"ToPayment\": {\"Bill\": {\"id\": 2, \"title\": \"测试账单2\"}, \"amount\": 150, \"bill_id\": 2, \"id\": 2}, \"amount\": 50, \"created_at\": 2023-06-15T00:00:00.000Z, \"from_payment_id\": 1, \"id\": 1, \"status\": \"completed\", \"to_payment_id\": 2}], \"page\": 1, \"pageSize\": 10, \"total\": 1, \"totalPages\": 1}"}],"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: {\"items\": [{\"FromPayment\": {\"Bill\": {\"id\": 1, \"title\": \"测试账单\"}, \"amount\": 100.5, \"bill_id\": 1, \"id\": 1}, \"ToPayment\": {\"Bill\": {\"id\": 2, \"title\": \"测试账单2\"}, \"amount\": 150, \"bill_id\": 2, \"id\": 2}, \"amount\": 50, \"created_at\": 2023-06-15T00:00:00.000Z, \"from_payment_id\": 1, \"id\": 1, \"status\": \"completed\", \"to_payment_id\": 2}], \"page\": 1, \"pageSize\": 10, \"total\": 1, \"totalPages\": 1}\n    at expect (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:113:15)\n    at Object.expect (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:629:13)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付记录查询服务测试 getUserPaymentTransfers 应该在用户ID无效时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户ID无效时抛出错误"},{"ancestorTitles":["支付记录查询服务测试","getRoomPaymentStats"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: Payment.findAll is not a function\n    at Object.findAll [as getRoomPaymentStats] (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\services\\payment-query-service.js:495:36)\n    at Object.getRoomPaymentStats (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:673:48)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付记录查询服务测试 getRoomPaymentStats 应该成功获取房间支付统计","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取房间支付统计"},{"ancestorTitles":["支付记录查询服务测试","getRoomPaymentStats"],"duration":4,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"房间ID无效\"\nReceived message:   \"Cannot destructure property 'roomId' of 'queryParams' as it is null.\"\n\n      473 |     \n      474 |     const {\n    > 475 |       roomId,\n          |       ^\n      476 |       startDate,\n      477 |       endDate\n      478 |     } = queryParams;\n\n      at Object.roomId [as getRoomPaymentStats] (services/payment-query-service.js:475:7)\n      at Object.getRoomPaymentStats (tests/unit/payment-query-service.test.js:727:40)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"房间ID无效\"\nReceived message:   \"Cannot destructure property 'roomId' of 'queryParams' as it is null.\"\n\n      473 |     \n      474 |     const {\n    > 475 |       roomId,\n          |       ^\n      476 |       startDate,\n      477 |       endDate\n      478 |     } = queryParams;\n\n      at Object.roomId [as getRoomPaymentStats] (services/payment-query-service.js:475:7)\n      at Object.getRoomPaymentStats (tests/unit/payment-query-service.test.js:727:40)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"房间ID无效\"\nReceived message:   \"Cannot destructure property 'roomId' of 'queryParams' as it is null.\"\n\n      473 |     \n      474 |     const {\n    > 475 |       roomId,\n          |       ^\n      476 |       startDate,\n      477 |       endDate\n      478 |     } = queryParams;\n\n      at Object.roomId [as getRoomPaymentStats] (services/payment-query-service.js:475:7)\n      at Object.getRoomPaymentStats (tests/unit/payment-query-service.test.js:727:40)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\expect\\build\\index.js:218:22)\n    at Object.toThrow (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js:728:18)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"支付记录查询服务测试 getRoomPaymentStats 应该在房间ID无效时抛出错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在房间ID无效时抛出错误"}],"endTime":1762160871909,"message":"  ● 支付记录查询服务测试 › getPaymentRecords › 应该成功获取支付记录列表\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: ObjectContaining {\"include\": ArrayContaining [ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}, ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 20, \"offset\": 0, \"order\": [[\"created_at\", \"DESC\"]], \"where\": ObjectContaining {\"bill_id\": 1, \"created_at\": ObjectContaining {\"Any\": Any<Object>}, \"status\": \"completed\", \"user_id\": 1}}\n    Received: {\"include\": [{\"as\": \"bill\", \"attributes\": [\"id\", \"title\", \"amount\", \"dueDate\", \"status\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"user\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": 0, \"order\": [[\"createdAt\", \"DESC\"]], \"where\": {\"billId\": 1, \"paymentTime\": {Symbol(gte): 2023-01-01T00:00:00.000Z, Symbol(lte): 2023-12-31T15:59:59.000Z}, \"status\": \"completed\", \"userId\": 1}}\n\n    Number of calls: 1\n\n       98 |\n       99 |       // 验证结果\n    > 100 |       expect(Payment.findAndCountAll).toHaveBeenCalledWith(\n          |                                       ^\n      101 |         expect.objectContaining({\n      102 |           include: expect.arrayContaining([\n      103 |             expect.objectContaining({ model: Bill }),\n\n      at Object.toHaveBeenCalledWith (tests/unit/payment-query-service.test.js:100:39)\n\n  ● 支付记录查询服务测试 › getPaymentRecords › 应该在页码无效时使用默认值\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: ObjectContaining {\"offset\": 0}\n    Received: {\"include\": [{\"as\": \"bill\", \"attributes\": [\"id\", \"title\", \"amount\", \"dueDate\", \"status\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"user\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": -20, \"order\": [[\"createdAt\", \"DESC\"]], \"where\": {}}\n\n    Number of calls: 1\n\n      187 |\n      188 |       // 验证结果\n    > 189 |       expect(Payment.findAndCountAll).toHaveBeenCalledWith(\n          |                                       ^\n      190 |         expect.objectContaining({\n      191 |           offset: 0 // 应该使用默认页码1，偏移量为0\n      192 |         })\n\n      at Object.toHaveBeenCalledWith (tests/unit/payment-query-service.test.js:189:39)\n\n  ● 支付记录查询服务测试 › getPaymentRecords › 应该在每页数量无效时使用默认值\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: ObjectContaining {\"limit\": 20}\n    Received: {\"include\": [{\"as\": \"bill\", \"attributes\": [\"id\", \"title\", \"amount\", \"dueDate\", \"status\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"user\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": 0, \"order\": [[\"createdAt\", \"DESC\"]], \"where\": {}}\n\n    Number of calls: 1\n\n      213 |\n      214 |       // 验证结果\n    > 215 |       expect(Payment.findAndCountAll).toHaveBeenCalledWith(\n          |                                       ^\n      216 |         expect.objectContaining({\n      217 |           limit: 20 // 应该使用默认限制20\n      218 |         })\n\n      at Object.toHaveBeenCalledWith (tests/unit/payment-query-service.test.js:215:39)\n\n  ● 支付记录查询服务测试 › getPaymentRecordById › 应该成功获取支付记录详情\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 5\n    + Received  + 5\n\n    @@ -8,13 +8,13 @@\n          \"email\": \"test@example.com\",\n          \"id\": 1,\n          \"username\": \"testuser\",\n        },\n        \"amount\": 100.5,\n    -   \"billId\": 1,\n    -   \"createdAt\": Any<Date>,\n    +   \"bill_id\": 1,\n    +   \"created_at\": 2023-06-15T00:00:00.000Z,\n        \"id\": 1,\n    -   \"paymentMethod\": \"alipay\",\n    +   \"payment_method\": \"alipay\",\n        \"status\": \"completed\",\n    -   \"updatedAt\": Any<Date>,\n    -   \"userId\": 1,\n    +   \"updated_at\": 2023-06-15T00:00:00.000Z,\n    +   \"user_id\": 1,\n      }\n\n      279 |       );\n      280 |\n    > 281 |       expect(result).toEqual({\n          |                      ^\n      282 |         id: paymentId,\n      283 |         billId: 1,\n      284 |         userId: 1,\n\n      at Object.toEqual (tests/unit/payment-query-service.test.js:281:22)\n\n  ● 支付记录查询服务测试 › getPaymentRecordById › 应该在支付ID无效时抛出错误\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: null\n\n      320 |\n      321 |       // 验证函数抛出错误\n    > 322 |       await expect(paymentQueryService.getPaymentRecordById(invalidPaymentId))\n          |             ^\n      323 |         .rejects.toThrow('支付ID无效');\n      324 |     });\n      325 |   });\n\n      at expect (node_modules/expect/build/index.js:113:15)\n      at Object.expect (tests/unit/payment-query-service.test.js:322:13)\n\n  ● 支付记录查询服务测试 › getUserPaymentStats › 应该成功获取用户支付统计\n\n    TypeError: Payment.findAll is not a function\n\n      226 |     \n      227 |     // 查询支付记录\n    > 228 |     const payments = await Payment.findAll({\n          |                                    ^\n      229 |       where: whereClause,\n      230 |       include: includeConditions,\n      231 |       attributes: ['amount', 'status', 'paymentMethod', 'paymentTime']\n\n      at Object.findAll [as getUserPaymentStats] (services/payment-query-service.js:228:36)\n      at Object.getUserPaymentStats (tests/unit/payment-query-service.test.js:365:48)\n\n  ● 支付记录查询服务测试 › getUserPaymentStats › 应该在用户ID无效时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"用户ID无效\"\n    Received message:   \"Cannot destructure property 'userId' of 'queryParams' as it is null.\"\n\n          187 |     \n          188 |     const {\n        > 189 |       userId,\n              |       ^\n          190 |       startDate,\n          191 |       endDate,\n          192 |       roomId\n\n      at Object.userId [as getUserPaymentStats] (services/payment-query-service.js:189:7)\n      at Object.getUserPaymentStats (tests/unit/payment-query-service.test.js:398:40)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/payment-query-service.test.js:399:18)\n\n  ● 支付记录查询服务测试 › getBillPayments › 应该成功获取账单支付记录\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: ObjectContaining {\"include\": ArrayContaining [ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 20, \"offset\": 0, \"order\": [[\"created_at\", \"DESC\"]], \"where\": ObjectContaining {\"bill_id\": 1}}\n    Received: {\"include\": [{\"as\": \"user\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": 0, \"order\": [[\"paymentTime\", \"DESC\"]], \"where\": {\"billId\": 1}}\n\n    Number of calls: 1\n\n      449 |\n      450 |       // 验证结果\n    > 451 |       expect(Payment.findAndCountAll).toHaveBeenCalledWith(\n          |                                       ^\n      452 |         expect.objectContaining({\n      453 |           include: expect.arrayContaining([\n      454 |             expect.objectContaining({ model: User })\n\n      at Object.toHaveBeenCalledWith (tests/unit/payment-query-service.test.js:451:39)\n\n  ● 支付记录查询服务测试 › getBillPayments › 应该在账单ID无效时抛出错误\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: {\"items\": [{\"User\": {\"email\": \"test@example.com\", \"id\": 1, \"username\": \"testuser\"}, \"amount\": 100.5, \"bill_id\": 1, \"created_at\": 2023-06-15T00:00:00.000Z, \"id\": 1, \"payment_method\": \"alipay\", \"status\": \"completed\", \"user_id\": 1}, {\"User\": {\"email\": \"test2@example.com\", \"id\": 2, \"username\": \"testuser2\"}, \"amount\": 50, \"bill_id\": 1, \"created_at\": 2023-06-20T00:00:00.000Z, \"id\": 2, \"payment_method\": \"wechat\", \"status\": \"pending\", \"user_id\": 2}], \"page\": 1, \"pageSize\": 10, \"total\": 2, \"totalPages\": 1}\n\n      506 |\n      507 |       // 验证函数抛出错误\n    > 508 |       await expect(paymentQueryService.getBillPayments(invalidBillId))\n          |             ^\n      509 |         .rejects.toThrow('账单ID无效');\n      510 |     });\n      511 |   });\n\n      at expect (node_modules/expect/build/index.js:113:15)\n      at Object.expect (tests/unit/payment-query-service.test.js:508:13)\n\n  ● 支付记录查询服务测试 › getUserPaymentTransfers › 应该成功获取用户支付转移记录\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: ObjectContaining {\"include\": ArrayContaining [ObjectContaining {\"as\": \"FromPayment\", \"include\": ArrayContaining [ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}], \"model\": {\"findAndCountAll\": [Function mockConstructor], \"findByPk\": [Function mockConstructor]}}, ObjectContaining {\"as\": \"ToPayment\", \"include\": ArrayContaining [ObjectContaining {\"model\": {\"findByPk\": [Function mockConstructor]}}], \"model\": {\"findAndCountAll\": [Function mockConstructor], \"findByPk\": [Function mockConstructor]}}], \"limit\": 20, \"offset\": 0, \"order\": [[\"created_at\", \"DESC\"]], \"where\": ObjectContaining {\"Any\": ObjectContaining {\"Any\": 1}}}\n    Received: {\"include\": [{\"as\": \"bill\", \"attributes\": [\"id\", \"title\", \"amount\", \"status\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"fromUser\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}, {\"as\": \"toUser\", \"attributes\": [\"id\", \"name\", \"email\", \"avatar\"], \"model\": {\"findByPk\": [Function mockConstructor]}}], \"limit\": 10, \"offset\": 0, \"order\": [[\"createdAt\", \"DESC\"]], \"where\": {Symbol(or): [{\"fromUserId\": 1}, {\"toUserId\": 1}]}}\n\n    Number of calls: 1\n\n      557 |\n      558 |       // 验证结果\n    > 559 |       expect(PaymentTransfer.findAndCountAll).toHaveBeenCalledWith(\n          |                                               ^\n      560 |         expect.objectContaining({\n      561 |           include: expect.arrayContaining([\n      562 |             expect.objectContaining({\n\n      at Object.toHaveBeenCalledWith (tests/unit/payment-query-service.test.js:559:47)\n\n  ● 支付记录查询服务测试 › getUserPaymentTransfers › 应该在用户ID无效时抛出错误\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: {\"items\": [{\"FromPayment\": {\"Bill\": {\"id\": 1, \"title\": \"测试账单\"}, \"amount\": 100.5, \"bill_id\": 1, \"id\": 1}, \"ToPayment\": {\"Bill\": {\"id\": 2, \"title\": \"测试账单2\"}, \"amount\": 150, \"bill_id\": 2, \"id\": 2}, \"amount\": 50, \"created_at\": 2023-06-15T00:00:00.000Z, \"from_payment_id\": 1, \"id\": 1, \"status\": \"completed\", \"to_payment_id\": 2}], \"page\": 1, \"pageSize\": 10, \"total\": 1, \"totalPages\": 1}\n\n      627 |\n      628 |       // 验证函数抛出错误\n    > 629 |       await expect(paymentQueryService.getUserPaymentTransfers(invalidUserId))\n          |             ^\n      630 |         .rejects.toThrow('用户ID无效');\n      631 |     });\n      632 |   });\n\n      at expect (node_modules/expect/build/index.js:113:15)\n      at Object.expect (tests/unit/payment-query-service.test.js:629:13)\n\n  ● 支付记录查询服务测试 › getRoomPaymentStats › 应该成功获取房间支付统计\n\n    TypeError: Payment.findAll is not a function\n\n      493 |     \n      494 |     // 查询支付记录\n    > 495 |     const payments = await Payment.findAll({\n          |                                    ^\n      496 |       where: whereClause,\n      497 |       include: [\n      498 |         {\n\n      at Object.findAll [as getRoomPaymentStats] (services/payment-query-service.js:495:36)\n      at Object.getRoomPaymentStats (tests/unit/payment-query-service.test.js:673:48)\n\n  ● 支付记录查询服务测试 › getRoomPaymentStats › 应该在房间ID无效时抛出错误\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"房间ID无效\"\n    Received message:   \"Cannot destructure property 'roomId' of 'queryParams' as it is null.\"\n\n          473 |     \n          474 |     const {\n        > 475 |       roomId,\n              |       ^\n          476 |       startDate,\n          477 |       endDate\n          478 |     } = queryParams;\n\n      at Object.roomId [as getRoomPaymentStats] (services/payment-query-service.js:475:7)\n      at Object.getRoomPaymentStats (tests/unit/payment-query-service.test.js:727:40)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at Object.toThrow (tests/unit/payment-query-service.test.js:728:18)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-query-service.test.js","startTime":1762160871426,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["StatsController单元测试","getUserStats"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js:67:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"StatsController单元测试 getUserStats 应该成功获取用户统计信息","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取用户统计信息"},{"ancestorTitles":["StatsController单元测试","getUserStats"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockRejectedValueOnce is not a function\n    at Object.mockRejectedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js:132:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"StatsController单元测试 getUserStats 应该在数据库错误时返回500错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在数据库错误时返回500错误"},{"ancestorTitles":["StatsController单元测试","getExpenseTypeDistribution"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js:157:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"StatsController单元测试 getExpenseTypeDistribution 应该成功获取费用类型分布","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取费用类型分布"},{"ancestorTitles":["StatsController单元测试","getExpenseTypeDistribution"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js:222:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"StatsController单元测试 getExpenseTypeDistribution 应该在无数据时返回空数组","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在无数据时返回空数组"},{"ancestorTitles":["StatsController单元测试","getDailyExpenseTrend"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js:248:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"StatsController单元测试 getDailyExpenseTrend 应该成功获取每日费用趋势","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取每日费用趋势"},{"ancestorTitles":["StatsController单元测试","getDailyExpenseTrend"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: statsController.getDailyExpenseTrend is not a function\n    at Object.getDailyExpenseTrend (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js:319:29)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"StatsController单元测试 getDailyExpenseTrend 应该在日期范围过大时返回400错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在日期范围过大时返回400错误"},{"ancestorTitles":["StatsController单元测试","getMonthlyExpenseTrend"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js:344:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"StatsController单元测试 getMonthlyExpenseTrend 应该成功获取每月费用趋势","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取每月费用趋势"},{"ancestorTitles":["StatsController单元测试","getMonthlyExpenseTrend"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: statsController.getMonthlyExpenseTrend is not a function\n    at Object.getMonthlyExpenseTrend (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js:395:29)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"StatsController单元测试 getMonthlyExpenseTrend 应该在日期范围过大时返回400错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在日期范围过大时返回400错误"},{"ancestorTitles":["StatsController单元测试","getRoomStats"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js:422:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"StatsController单元测试 getRoomStats 应该成功获取寝室统计信息","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取寝室统计信息"},{"ancestorTitles":["StatsController单元测试","getRoomStats"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js:497:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"StatsController单元测试 getRoomStats 应该在用户不是寝室成员时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不是寝室成员时返回403错误"},{"ancestorTitles":["StatsController单元测试","getRoomExpenseTypeDistribution"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js:524:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"StatsController单元测试 getRoomExpenseTypeDistribution 应该成功获取寝室费用类型分布","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取寝室费用类型分布"},{"ancestorTitles":["StatsController单元测试","getRoomMonthlyTrend"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js:603:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"StatsController单元测试 getRoomMonthlyTrend 应该成功获取寝室每月费用趋势","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取寝室每月费用趋势"}],"endTime":1762160872357,"message":"  ● StatsController单元测试 › getUserStats › 应该成功获取用户统计信息\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      65 |       // 模拟数据库查询结果\n      66 |       mockPool.query\n    > 67 |         .mockResolvedValueOnce({\n         |          ^\n      68 |           rows: [{\n      69 |             total_paid: 1000.50,\n      70 |             total_owed: 500.25,\n\n      at Object.mockResolvedValueOnce (tests/unit/stats-controller.test.js:67:10)\n\n  ● StatsController单元测试 › getUserStats › 应该在数据库错误时返回500错误\n\n    TypeError: mockPool.query.mockRejectedValueOnce is not a function\n\n      130 |       \n      131 |       // 模拟数据库错误\n    > 132 |       mockPool.query.mockRejectedValueOnce(new Error('数据库连接错误'));\n          |                      ^\n      133 |       \n      134 |       // 调用控制器方法\n      135 |       await statsController.getUserStats(mockReq, mockRes);\n\n      at Object.mockRejectedValueOnce (tests/unit/stats-controller.test.js:132:22)\n\n  ● StatsController单元测试 › getExpenseTypeDistribution › 应该成功获取费用类型分布\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      155 |       \n      156 |       // 模拟数据库查询结果\n    > 157 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      158 |         rows: [\n      159 |           {\n      160 |             expense_type_id: 1,\n\n      at Object.mockResolvedValueOnce (tests/unit/stats-controller.test.js:157:22)\n\n  ● StatsController单元测试 › getExpenseTypeDistribution › 应该在无数据时返回空数组\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      220 |       \n      221 |       // 模拟数据库查询结果 - 无数据\n    > 222 |       mockPool.query.mockResolvedValueOnce({ rows: [] });\n          |                      ^\n      223 |       \n      224 |       // 调用控制器方法\n      225 |       await statsController.getExpenseTypeDistribution(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/stats-controller.test.js:222:22)\n\n  ● StatsController单元测试 › getDailyExpenseTrend › 应该成功获取每日费用趋势\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      246 |       \n      247 |       // 模拟数据库查询结果\n    > 248 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      249 |         rows: [\n      250 |           {\n      251 |             date: '2023-01-01',\n\n      at Object.mockResolvedValueOnce (tests/unit/stats-controller.test.js:248:22)\n\n  ● StatsController单元测试 › getDailyExpenseTrend › 应该在日期范围过大时返回400错误\n\n    TypeError: statsController.getDailyExpenseTrend is not a function\n\n      317 |       \n      318 |       // 调用控制器方法\n    > 319 |       await statsController.getDailyExpenseTrend(mockReq, mockRes);\n          |                             ^\n      320 |       \n      321 |       // 验证响应\n      322 |       expect(mockRes.status).toHaveBeenCalledWith(400);\n\n      at Object.getDailyExpenseTrend (tests/unit/stats-controller.test.js:319:29)\n\n  ● StatsController单元测试 › getMonthlyExpenseTrend › 应该成功获取每月费用趋势\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      342 |       \n      343 |       // 模拟数据库查询结果\n    > 344 |       mockPool.query.mockResolvedValueOnce({\n          |                      ^\n      345 |         rows: [\n      346 |           {\n      347 |             month: '2023-01',\n\n      at Object.mockResolvedValueOnce (tests/unit/stats-controller.test.js:344:22)\n\n  ● StatsController单元测试 › getMonthlyExpenseTrend › 应该在日期范围过大时返回400错误\n\n    TypeError: statsController.getMonthlyExpenseTrend is not a function\n\n      393 |       \n      394 |       // 调用控制器方法\n    > 395 |       await statsController.getMonthlyExpenseTrend(mockReq, mockRes);\n          |                             ^\n      396 |       \n      397 |       // 验证响应\n      398 |       expect(mockRes.status).toHaveBeenCalledWith(400);\n\n      at Object.getMonthlyExpenseTrend (tests/unit/stats-controller.test.js:395:29)\n\n  ● StatsController单元测试 › getRoomStats › 应该成功获取寝室统计信息\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      420 |       // 模拟数据库查询结果\n      421 |       mockPool.query\n    > 422 |         .mockResolvedValueOnce({ rows: [{ id: 1, creator_id: 1 }] }) // 检查用户是否是寝室成员\n          |          ^\n      423 |         .mockResolvedValueOnce({\n      424 |           rows: [{\n      425 |             total_amount: 5000.00,\n\n      at Object.mockResolvedValueOnce (tests/unit/stats-controller.test.js:422:10)\n\n  ● StatsController单元测试 › getRoomStats › 应该在用户不是寝室成员时返回403错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      495 |       \n      496 |       // 模拟数据库查询结果 - 用户不是寝室成员\n    > 497 |       mockPool.query.mockResolvedValueOnce({ rows: [] });\n          |                      ^\n      498 |       \n      499 |       // 调用控制器方法\n      500 |       await statsController.getRoomStats(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/stats-controller.test.js:497:22)\n\n  ● StatsController单元测试 › getRoomExpenseTypeDistribution › 应该成功获取寝室费用类型分布\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      522 |       // 模拟数据库查询结果\n      523 |       mockPool.query\n    > 524 |         .mockResolvedValueOnce({ rows: [{ id: 1 }] }) // 检查用户是否是寝室成员\n          |          ^\n      525 |         .mockResolvedValueOnce({\n      526 |           rows: [\n      527 |             {\n\n      at Object.mockResolvedValueOnce (tests/unit/stats-controller.test.js:524:10)\n\n  ● StatsController单元测试 › getRoomMonthlyTrend › 应该成功获取寝室每月费用趋势\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      601 |       // 模拟数据库查询结果\n      602 |       mockPool.query\n    > 603 |         .mockResolvedValueOnce({ rows: [{ id: 1 }] }) // 检查用户是否是寝室成员\n          |          ^\n      604 |         .mockResolvedValueOnce({\n      605 |           rows: [\n      606 |             {\n\n      at Object.mockResolvedValueOnce (tests/unit/stats-controller.test.js:603:10)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\stats-controller.test.js","startTime":1762160871923,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["ExpenseController单元测试","createExpense"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:80:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 createExpense 应该成功创建费用记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功创建费用记录"},{"ancestorTitles":["ExpenseController单元测试","createExpense"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"ExpenseController单元测试 createExpense 应该在缺少必填字段时返回400错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该在缺少必填字段时返回400错误"},{"ancestorTitles":["ExpenseController单元测试","createExpense"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:138:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 createExpense 应该在用户不是寝室成员时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不是寝室成员时返回403错误"},{"ancestorTitles":["ExpenseController单元测试","createExpense"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockRejectedValueOnce is not a function\n    at Object.mockRejectedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:164:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 createExpense 应该在数据库错误时返回500错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在数据库错误时返回500错误"},{"ancestorTitles":["ExpenseController单元测试","getExpenses"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:191:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 getExpenses 应该成功获取费用列表","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取费用列表"},{"ancestorTitles":["ExpenseController单元测试","getExpenses"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:227:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 getExpenses 应该在用户不是寝室成员时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在用户不是寝室成员时返回403错误"},{"ancestorTitles":["ExpenseController单元测试","getExpenseById"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:250:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 getExpenseById 应该成功获取特定费用详情","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功获取特定费用详情"},{"ancestorTitles":["ExpenseController单元测试","getExpenseById"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:280:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 getExpenseById 应该在费用不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在费用不存在时返回404错误"},{"ancestorTitles":["ExpenseController单元测试","updateExpense"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:308:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 updateExpense 应该成功更新费用记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功更新费用记录"},{"ancestorTitles":["ExpenseController单元测试","updateExpense"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:335:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 updateExpense 应该在费用不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在费用不存在时返回404错误"},{"ancestorTitles":["ExpenseController单元测试","deleteExpense"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:358:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 deleteExpense 应该成功删除费用记录","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功删除费用记录"},{"ancestorTitles":["ExpenseController单元测试","deleteExpense"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:381:22)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 deleteExpense 应该在费用不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在费用不存在时返回404错误"},{"ancestorTitles":["ExpenseController单元测试","confirmSplitPayment"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:405:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 confirmSplitPayment 应该成功确认分摊支付","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该成功确认分摊支付"},{"ancestorTitles":["ExpenseController单元测试","confirmSplitPayment"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: mockPool.query.mockResolvedValueOnce is not a function\n    at Object.mockResolvedValueOnce (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js:430:10)\n    at Promise.then.completed (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at _runTestsForDescribeBlock (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"ExpenseController单元测试 confirmSplitPayment 应该在分摊ID不存在时返回400错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"应该在分摊ID不存在时返回400错误"}],"endTime":1762160872912,"message":"  ● ExpenseController单元测试 › createExpense › 应该成功创建费用记录\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      78 |       // 模拟数据库查询结果\n      79 |       mockPool.query\n    > 80 |         .mockResolvedValueOnce({ rows: [{ id: 1, user_id: 1 }] }) // 检查寝室成员\n         |          ^\n      81 |         .mockResolvedValueOnce({ rows: [] }) // 检查费用类型\n      82 |         .mockResolvedValueOnce({ rows: [{ id: 1 }] }) // 插入费用\n      83 |         .mockResolvedValueOnce({ rows: [{ id: 1, user_id: 2 }] }) // 获取寝室成员\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-controller.test.js:80:10)\n\n  ● ExpenseController单元测试 › createExpense › 应该在用户不是寝室成员时返回403错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      136 |       \n      137 |       // 模拟数据库查询结果 - 用户不是寝室成员\n    > 138 |       mockPool.query.mockResolvedValueOnce({ rows: [] });\n          |                      ^\n      139 |       \n      140 |       // 调用控制器方法\n      141 |       await expenseController.createExpense(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-controller.test.js:138:22)\n\n  ● ExpenseController单元测试 › createExpense › 应该在数据库错误时返回500错误\n\n    TypeError: mockPool.query.mockRejectedValueOnce is not a function\n\n      162 |       \n      163 |       // 模拟数据库错误\n    > 164 |       mockPool.query.mockRejectedValueOnce(new Error('数据库连接错误'));\n          |                      ^\n      165 |       \n      166 |       // 调用控制器方法\n      167 |       await expenseController.createExpense(mockReq, mockRes);\n\n      at Object.mockRejectedValueOnce (tests/unit/expense-controller.test.js:164:22)\n\n  ● ExpenseController单元测试 › getExpenses › 应该成功获取费用列表\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      189 |       // 模拟数据库查询结果\n      190 |       mockPool.query\n    > 191 |         .mockResolvedValueOnce({ rows: [{ id: 1, user_id: 1 }] }) // 检查寝室成员\n          |          ^\n      192 |         .mockResolvedValueOnce({ rows: [{ id: 1, title: '测试费用', amount: 100.50 }] }) // 获取费用列表\n      193 |         .mockResolvedValueOnce({ rows: [{ count: 1 }] }); // 获取总数\n      194 |       \n\n      at Object.mockResolvedValueOnce (tests/unit/expense-controller.test.js:191:10)\n\n  ● ExpenseController单元测试 › getExpenses › 应该在用户不是寝室成员时返回403错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      225 |       \n      226 |       // 模拟数据库查询结果 - 用户不是寝室成员\n    > 227 |       mockPool.query.mockResolvedValueOnce({ rows: [] });\n          |                      ^\n      228 |       \n      229 |       // 调用控制器方法\n      230 |       await expenseController.getExpenses(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-controller.test.js:227:22)\n\n  ● ExpenseController单元测试 › getExpenseById › 应该成功获取特定费用详情\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      248 |       // 模拟数据库查询结果\n      249 |       mockPool.query\n    > 250 |         .mockResolvedValueOnce({ rows: [{ id: 1, room_id: 1, user_id: 1 }] }) // 获取费用\n          |          ^\n      251 |         .mockResolvedValueOnce({ rows: [{ id: 1, user_id: 1 }] }) // 检查寝室成员\n      252 |         .mockResolvedValueOnce({ rows: [{ id: 1, user_id: 1, amount: 50.25 }] }); // 获取分摊详情\n      253 |       \n\n      at Object.mockResolvedValueOnce (tests/unit/expense-controller.test.js:250:10)\n\n  ● ExpenseController单元测试 › getExpenseById › 应该在费用不存在时返回404错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      278 |       \n      279 |       // 模拟数据库查询结果 - 费用不存在\n    > 280 |       mockPool.query.mockResolvedValueOnce({ rows: [] });\n          |                      ^\n      281 |       \n      282 |       // 调用控制器方法\n      283 |       await expenseController.getExpenseById(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-controller.test.js:280:22)\n\n  ● ExpenseController单元测试 › updateExpense › 应该成功更新费用记录\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      306 |       // 模拟数据库查询结果\n      307 |       mockPool.query\n    > 308 |         .mockResolvedValueOnce({ rows: [{ id: 1, room_id: 1, user_id: 1 }] }) // 获取费用\n          |          ^\n      309 |         .mockResolvedValueOnce({ rows: [{ id: 1, user_id: 1 }] }) // 检查寝室成员\n      310 |         .mockResolvedValueOnce({ rows: [{ id: 1, title: '更新后的测试费用', amount: 150.75 }] }); // 更新费用\n      311 |       \n\n      at Object.mockResolvedValueOnce (tests/unit/expense-controller.test.js:308:10)\n\n  ● ExpenseController单元测试 › updateExpense › 应该在费用不存在时返回404错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      333 |       \n      334 |       // 模拟数据库查询结果 - 费用不存在\n    > 335 |       mockPool.query.mockResolvedValueOnce({ rows: [] });\n          |                      ^\n      336 |       \n      337 |       // 调用控制器方法\n      338 |       await expenseController.updateExpense(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-controller.test.js:335:22)\n\n  ● ExpenseController单元测试 › deleteExpense › 应该成功删除费用记录\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      356 |       // 模拟数据库查询结果\n      357 |       mockPool.query\n    > 358 |         .mockResolvedValueOnce({ rows: [{ id: 1, room_id: 1, user_id: 1 }] }) // 获取费用\n          |          ^\n      359 |         .mockResolvedValueOnce({ rows: [{ id: 1, user_id: 1 }] }) // 检查寝室成员\n      360 |         .mockResolvedValueOnce({ rows: [] }); // 删除分摊记录\n      361 |       mockPool.query.mockResolvedValueOnce({ rows: [] }); // 删除费用\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-controller.test.js:358:10)\n\n  ● ExpenseController单元测试 › deleteExpense › 应该在费用不存在时返回404错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      379 |       \n      380 |       // 模拟数据库查询结果 - 费用不存在\n    > 381 |       mockPool.query.mockResolvedValueOnce({ rows: [] });\n          |                      ^\n      382 |       \n      383 |       // 调用控制器方法\n      384 |       await expenseController.deleteExpense(mockReq, mockRes);\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-controller.test.js:381:22)\n\n  ● ExpenseController单元测试 › confirmSplitPayment › 应该成功确认分摊支付\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      403 |       // 模拟数据库查询结果\n      404 |       mockPool.query\n    > 405 |         .mockResolvedValueOnce({ rows: [{ id: 1, room_id: 1, user_id: 1 }] }) // 获取费用\n          |          ^\n      406 |         .mockResolvedValueOnce({ rows: [{ id: 1, user_id: 1 }] }) // 检查寝室成员\n      407 |         .mockResolvedValueOnce({ rows: [{ id: 1, user_id: 1, is_paid: false }] }) // 获取分摊记录\n      408 |         .mockResolvedValueOnce({ rows: [{ id: 1, is_paid: true }] }); // 更新分摊记录\n\n      at Object.mockResolvedValueOnce (tests/unit/expense-controller.test.js:405:10)\n\n  ● ExpenseController单元测试 › confirmSplitPayment › 应该在分摊ID不存在时返回400错误\n\n    TypeError: mockPool.query.mockResolvedValueOnce is not a function\n\n      428 |       // 模拟数据库查询结果\n      429 |       mockPool.query\n    > 430 |         .mockResolvedValueOnce({ rows: [{ id: 1, room_id: 1, user_id: 1 }] }) // 获取费用\n          |          ^\n      431 |         .mockResolvedValueOnce({ rows: [{ id: 1, user_id: 1 }] }) // 检查寝室成员\n      432 |         .mockResolvedValueOnce({ rows: [] }); // 分摊记录不存在\n      433 |       \n\n      at Object.mockResolvedValueOnce (tests/unit/expense-controller.test.js:430:10)\n","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\expense-controller.test.js","startTime":1762160872369,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["UserController API测试","POST /api/users/register"],"duration":210,"failureDetails":[],"failureMessages":[],"fullName":"UserController API测试 POST /api/users/register 应该成功注册新用户","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"应该成功注册新用户"},{"ancestorTitles":["UserController API测试","POST /api/users/register"],"duration":136,"failureDetails":[],"failureMessages":[],"fullName":"UserController API测试 POST /api/users/register 应该在缺少必填字段时返回400错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在缺少必填字段时返回400错误"},{"ancestorTitles":["UserController API测试","POST /api/users/register"],"duration":133,"failureDetails":[],"failureMessages":[],"fullName":"UserController API测试 POST /api/users/register 应该在用户名已存在时返回409错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在用户名已存在时返回409错误"},{"ancestorTitles":["UserController API测试","POST /api/auth/login"],"duration":198,"failureDetails":[],"failureMessages":[],"fullName":"UserController API测试 POST /api/auth/login 应该成功登录并返回token","invocations":1,"location":null,"numPassingAsserts":6,"retryReasons":[],"status":"passed","title":"应该成功登录并返回token"},{"ancestorTitles":["UserController API测试","POST /api/auth/login"],"duration":192,"failureDetails":[],"failureMessages":[],"fullName":"UserController API测试 POST /api/auth/login 应该在密码错误时返回401错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在密码错误时返回401错误"},{"ancestorTitles":["UserController API测试","GET /api/users/profile"],"duration":140,"failureDetails":[],"failureMessages":[],"fullName":"UserController API测试 GET /api/users/profile 应该成功获取用户资料","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功获取用户资料"},{"ancestorTitles":["UserController API测试","GET /api/users/profile"],"duration":129,"failureDetails":[],"failureMessages":[],"fullName":"UserController API测试 GET /api/users/profile 应该在未授权时返回401错误","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"应该在未授权时返回401错误"},{"ancestorTitles":["UserController API测试","PUT /api/users/profile"],"duration":140,"failureDetails":[],"failureMessages":[],"fullName":"UserController API测试 PUT /api/users/profile 应该成功更新用户资料","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"应该成功更新用户资料"},{"ancestorTitles":["UserController API测试","PUT /api/users/profile"],"duration":128,"failureDetails":[],"failureMessages":[],"fullName":"UserController API测试 PUT /api/users/profile 没有token时应该无法更新用户资料","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"没有token时应该无法更新用户资料"},{"ancestorTitles":["UserController API测试","POST /api/auth/refresh"],"duration":145,"failureDetails":[],"failureMessages":[],"fullName":"UserController API测试 POST /api/auth/refresh 应该成功刷新token","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"应该成功刷新token"}],"endTime":1762160875050,"message":"","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\user-api.test.js","startTime":1762160872924,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["费用类型管理API集成测试","POST /api/expense-types"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 POST /api/expense-types 应该成功创建费用类型","invocations":1,"location":null,"numPassingAsserts":9,"retryReasons":[],"status":"passed","title":"应该成功创建费用类型"},{"ancestorTitles":["费用类型管理API集成测试","POST /api/expense-types"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 POST /api/expense-types 应该在未认证时返回401错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该在未认证时返回401错误"},{"ancestorTitles":["费用类型管理API集成测试","POST /api/expense-types"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 POST /api/expense-types 应该在缺少必填字段时返回400错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在缺少必填字段时返回400错误"},{"ancestorTitles":["费用类型管理API集成测试","POST /api/expense-types"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 POST /api/expense-types 应该在费用类型名称已存在时返回409错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在费用类型名称已存在时返回409错误"},{"ancestorTitles":["费用类型管理API集成测试","GET /api/expense-types"],"duration":186,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 GET /api/expense-types 应该成功获取费用类型列表","invocations":1,"location":null,"numPassingAsserts":11,"retryReasons":[],"status":"passed","title":"应该成功获取费用类型列表"},{"ancestorTitles":["费用类型管理API集成测试","GET /api/expense-types"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 GET /api/expense-types 应该支持分页查询","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该支持分页查询"},{"ancestorTitles":["费用类型管理API集成测试","GET /api/expense-types"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 GET /api/expense-types 应该支持按名称筛选","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该支持按名称筛选"},{"ancestorTitles":["费用类型管理API集成测试","GET /api/expense-types"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 GET /api/expense-types 应该支持按创建者筛选","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该支持按创建者筛选"},{"ancestorTitles":["费用类型管理API集成测试","GET /api/expense-types/default"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 GET /api/expense-types/default 应该成功获取默认费用类型列表","invocations":1,"location":null,"numPassingAsserts":14,"retryReasons":[],"status":"passed","title":"应该成功获取默认费用类型列表"},{"ancestorTitles":["费用类型管理API集成测试","GET /api/expense-types/:id"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 GET /api/expense-types/:id 应该成功获取费用类型详情","invocations":1,"location":null,"numPassingAsserts":8,"retryReasons":[],"status":"passed","title":"应该成功获取费用类型详情"},{"ancestorTitles":["费用类型管理API集成测试","GET /api/expense-types/:id"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 GET /api/expense-types/:id 应该在费用类型不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在费用类型不存在时返回404错误"},{"ancestorTitles":["费用类型管理API集成测试","PUT /api/expense-types/:id"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 PUT /api/expense-types/:id 应该成功更新费用类型信息","invocations":1,"location":null,"numPassingAsserts":7,"retryReasons":[],"status":"passed","title":"应该成功更新费用类型信息"},{"ancestorTitles":["费用类型管理API集成测试","PUT /api/expense-types/:id"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 PUT /api/expense-types/:id 应该在费用类型不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在费用类型不存在时返回404错误"},{"ancestorTitles":["费用类型管理API集成测试","PUT /api/expense-types/:id"],"duration":15,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 PUT /api/expense-types/:id 应该在费用类型名称已存在时返回409错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在费用类型名称已存在时返回409错误"},{"ancestorTitles":["费用类型管理API集成测试","DELETE /api/expense-types/:id"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 DELETE /api/expense-types/:id 应该成功删除费用类型","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"应该成功删除费用类型"},{"ancestorTitles":["费用类型管理API集成测试","DELETE /api/expense-types/:id"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 DELETE /api/expense-types/:id 应该在费用类型不存在时返回404错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在费用类型不存在时返回404错误"},{"ancestorTitles":["费用类型管理API集成测试","DELETE /api/expense-types/:id"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 DELETE /api/expense-types/:id 应该在尝试删除系统默认费用类型时返回403错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在尝试删除系统默认费用类型时返回403错误"},{"ancestorTitles":["费用类型管理API集成测试","权限测试"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 权限测试 应该在非创建者尝试更新费用类型时返回403错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在非创建者尝试更新费用类型时返回403错误"},{"ancestorTitles":["费用类型管理API集成测试","权限测试"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"费用类型管理API集成测试 权限测试 应该在非创建者尝试删除费用类型时返回403错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在非创建者尝试删除费用类型时返回403错误"}],"endTime":1762160876337,"message":"","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expense-types.test.js","startTime":1762160875061,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["支付流程优化控制器测试","createOfflinePayment"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 createOfflinePayment 应该成功创建离线支付","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功创建离线支付"},{"ancestorTitles":["支付流程优化控制器测试","createOfflinePayment"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 createOfflinePayment 应该在缺少必要参数时返回错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该在缺少必要参数时返回错误"},{"ancestorTitles":["支付流程优化控制器测试","createOfflinePayment"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 createOfflinePayment 应该在服务失败时返回错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该在服务失败时返回错误"},{"ancestorTitles":["支付流程优化控制器测试","syncOfflinePayment"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 syncOfflinePayment 应该成功同步离线支付","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功同步离线支付"},{"ancestorTitles":["支付流程优化控制器测试","syncOfflinePayment"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 syncOfflinePayment 应该在ID无效时返回错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该在ID无效时返回错误"},{"ancestorTitles":["支付流程优化控制器测试","syncOfflinePayment"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 syncOfflinePayment 应该在支付记录不存在时返回错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该在支付记录不存在时返回错误"},{"ancestorTitles":["支付流程优化控制器测试","getUserOfflinePayments"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 getUserOfflinePayments 应该成功获取用户离线支付记录","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功获取用户离线支付记录"},{"ancestorTitles":["支付流程优化控制器测试","getUserOfflinePayments"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 getUserOfflinePayments 应该在用户ID无效时返回错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该在用户ID无效时返回错误"},{"ancestorTitles":["支付流程优化控制器测试","getPendingSyncPayments"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 getPendingSyncPayments 应该成功获取待同步的离线支付记录","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功获取待同步的离线支付记录"},{"ancestorTitles":["支付流程优化控制器测试","createPaymentReminder"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 createPaymentReminder 应该成功创建支付提醒","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功创建支付提醒"},{"ancestorTitles":["支付流程优化控制器测试","createPaymentReminder"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 createPaymentReminder 应该在缺少必要参数时返回错误","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该在缺少必要参数时返回错误"},{"ancestorTitles":["支付流程优化控制器测试","getUserPaymentReminders"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 getUserPaymentReminders 应该成功获取用户支付提醒列表","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功获取用户支付提醒列表"},{"ancestorTitles":["支付流程优化控制器测试","getPaymentRecords"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 getPaymentRecords 应该成功获取支付记录列表","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功获取支付记录列表"},{"ancestorTitles":["支付流程优化控制器测试","getPaymentRecordById"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 getPaymentRecordById 应该成功获取支付记录详情","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功获取支付记录详情"},{"ancestorTitles":["支付流程优化控制器测试","getPaymentRecordById"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 getPaymentRecordById 应该在支付记录不存在时返回404","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在支付记录不存在时返回404"},{"ancestorTitles":["支付流程优化控制器测试","getUserPaymentStats"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 getUserPaymentStats 应该成功获取用户支付统计","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功获取用户支付统计"},{"ancestorTitles":["支付流程优化控制器测试","getRoomPaymentStats"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 getRoomPaymentStats 应该成功获取房间支付统计","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功获取房间支付统计"},{"ancestorTitles":["支付流程优化控制器测试","triggerTask"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 triggerTask 应该成功触发定时任务","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功触发定时任务"},{"ancestorTitles":["支付流程优化控制器测试","triggerTask"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 triggerTask 应该在任务不存在时返回错误","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该在任务不存在时返回错误"},{"ancestorTitles":["支付流程优化控制器测试","getTaskStatus"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"支付流程优化控制器测试 getTaskStatus 应该成功获取任务状态","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功获取任务状态"}],"endTime":1762160877022,"message":"","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\payment-optimization-controller.test.js","startTime":1762160876348,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Payments Bill Flow"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Payments Bill Flow should get bill qr-code info and confirm payment","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"should get bill qr-code info and confirm payment"}],"endTime":1762160877687,"message":"","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\payments-bill-flow.test.js","startTime":1762160877035,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Rooms API - integration"],"duration":150,"failureDetails":[],"failureMessages":[],"fullName":"Rooms API - integration create room, list rooms, get detail, second user joins","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"create room, list rooms, get detail, second user joins"}],"endTime":1762160878332,"message":"","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\rooms.test.js","startTime":1762160877695,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["QR Codes API"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"QR Codes API should upload and list qr codes","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"should upload and list qr codes"}],"endTime":1762160878990,"message":"","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\qr-codes.test.js","startTime":1762160878341,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["定时任务服务测试","startAllTasks"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 startAllTasks 应该成功启动所有定时任务","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"应该成功启动所有定时任务"},{"ancestorTitles":["定时任务服务测试","startAllTasks"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 startAllTasks 应该在任务已启动时返回相应消息","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"应该在任务已启动时返回相应消息"},{"ancestorTitles":["定时任务服务测试","stopAllTasks"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 stopAllTasks 应该成功停止所有定时任务","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"应该成功停止所有定时任务"},{"ancestorTitles":["定时任务服务测试","stopAllTasks"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 stopAllTasks 应该在任务未启动时返回相应消息","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"应该在任务未启动时返回相应消息"},{"ancestorTitles":["定时任务服务测试","checkPaymentReminders"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 checkPaymentReminders 应该成功检查并发送支付提醒","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功检查并发送支付提醒"},{"ancestorTitles":["定时任务服务测试","checkPaymentReminders"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 checkPaymentReminders 应该处理没有待发送提醒的情况","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该处理没有待发送提醒的情况"},{"ancestorTitles":["定时任务服务测试","checkPaymentReminders"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 checkPaymentReminders 应该处理发送提醒失败的情况","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该处理发送提醒失败的情况"},{"ancestorTitles":["定时任务服务测试","checkPaymentReminders"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 checkPaymentReminders 应该处理获取提醒失败的情况","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该处理获取提醒失败的情况"},{"ancestorTitles":["定时任务服务测试","syncOfflinePayments"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 syncOfflinePayments 应该成功同步离线支付","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功同步离线支付"},{"ancestorTitles":["定时任务服务测试","syncOfflinePayments"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 syncOfflinePayments 应该处理没有待同步支付的情况","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该处理没有待同步支付的情况"},{"ancestorTitles":["定时任务服务测试","syncOfflinePayments"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 syncOfflinePayments 应该处理部分同步失败的情况","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该处理部分同步失败的情况"},{"ancestorTitles":["定时任务服务测试","syncOfflinePayments"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 syncOfflinePayments 应该处理获取待同步支付失败的情况","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该处理获取待同步支付失败的情况"},{"ancestorTitles":["定时任务服务测试","cleanupExpiredReminders"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 cleanupExpiredReminders 应该成功清理过期提醒","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该成功清理过期提醒"},{"ancestorTitles":["定时任务服务测试","cleanupExpiredReminders"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 cleanupExpiredReminders 应该处理没有过期提醒的情况","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该处理没有过期提醒的情况"},{"ancestorTitles":["定时任务服务测试","cleanupExpiredReminders"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 cleanupExpiredReminders 应该处理清理过期提醒失败的情况","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该处理清理过期提醒失败的情况"},{"ancestorTitles":["定时任务服务测试","generatePaymentStats"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 generatePaymentStats 应该成功生成支付统计报告","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该成功生成支付统计报告"},{"ancestorTitles":["定时任务服务测试","generatePaymentStats"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 generatePaymentStats 应该处理没有支付记录的情况","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"应该处理没有支付记录的情况"},{"ancestorTitles":["定时任务服务测试","generatePaymentStats"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 generatePaymentStats 应该处理生成支付统计失败的情况","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该处理生成支付统计失败的情况"},{"ancestorTitles":["定时任务服务测试","getTaskStatus"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 getTaskStatus 应该返回所有任务状态","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"应该返回所有任务状态"},{"ancestorTitles":["定时任务服务测试","getTaskStatus"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 getTaskStatus 应该在任务未启动时返回相应状态","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"应该在任务未启动时返回相应状态"},{"ancestorTitles":["定时任务服务测试","triggerTask"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 triggerTask 应该成功触发指定任务","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该成功触发指定任务"},{"ancestorTitles":["定时任务服务测试","triggerTask"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 triggerTask 应该在任务不存在时返回错误","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"应该在任务不存在时返回错误"},{"ancestorTitles":["定时任务服务测试","triggerTask"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"定时任务服务测试 triggerTask 应该处理任务执行失败的情况","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该处理任务执行失败的情况"}],"endTime":1762160879768,"message":"","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\scheduler.test.js","startTime":1762160879002,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Expenses API - basic flows"],"duration":171,"failureDetails":[],"failureMessages":[],"fullName":"Expenses API - basic flows list expenses empty, calculate split works, create expense guarded","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"list expenses empty, calculate split works, create expense guarded"}],"endTime":1762160880568,"message":"","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\expenses-basic.test.js","startTime":1762160879781,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Bills API - basic flows"],"duration":193,"failureDetails":[],"failureMessages":[],"fullName":"Bills API - basic flows create bill (optional), list bills, get one, review/payment guarded","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"create bill (optional), list bills, get one, review/payment guarded"}],"endTime":1762160881504,"message":"","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bills-basic.test.js","startTime":1762160880578,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["最小测试","变量初始化测试"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"最小测试 变量初始化测试 应该正确初始化testUser变量","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"应该正确初始化testUser变量"}],"endTime":1762160882339,"message":"","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\minimal.test.js","startTime":1762160881515,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["BillController单元测试","createBill"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"BillController单元测试 createBill 应该成功创建账单","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"pending","title":"应该成功创建账单"},{"ancestorTitles":["BillController单元测试","createBill"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"BillController单元测试 createBill 应该在缺少必填字段时返回500错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"pending","title":"应该在缺少必填字段时返回500错误"},{"ancestorTitles":["BillController单元测试","createBill"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"BillController单元测试 createBill 应该在用户不是寝室成员时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"pending","title":"应该在用户不是寝室成员时返回403错误"},{"ancestorTitles":["BillController单元测试","getBills"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"BillController单元测试 getBills 应该成功获取账单列表","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"pending","title":"应该成功获取账单列表"},{"ancestorTitles":["BillController单元测试","getBillById"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"BillController单元测试 getBillById 应该成功获取特定账单详情","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"pending","title":"应该成功获取特定账单详情"},{"ancestorTitles":["BillController单元测试","getBillById"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"BillController单元测试 getBillById 应该在账单不存在时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"pending","title":"应该在账单不存在时返回403错误"},{"ancestorTitles":["BillController单元测试","reviewBill"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"BillController单元测试 reviewBill 应该成功审核账单","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"pending","title":"应该成功审核账单"},{"ancestorTitles":["BillController单元测试","reviewBill"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"BillController单元测试 reviewBill 应该在账单不存在时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"pending","title":"应该在账单不存在时返回403错误"},{"ancestorTitles":["BillController单元测试","confirmBillPayment"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"BillController单元测试 confirmBillPayment 应该成功确认账单支付","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"pending","title":"应该成功确认账单支付"},{"ancestorTitles":["BillController单元测试","confirmBillPayment"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"BillController单元测试 confirmBillPayment 应该在分摊ID不存在时返回403错误","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"pending","title":"应该在分摊ID不存在时返回403错误"}],"coverage":{},"endTime":1762160888033,"message":"","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\unit\\bill-controller.test.js","startTime":1762160888033,"status":"skipped","summary":""},{"assertionResults":[{"ancestorTitles":["BillController 真实数据库集成测试"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"BillController 真实数据库集成测试 should connect to real DB and run a simple query","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should connect to real DB and run a simple query"},{"ancestorTitles":["BillController 真实数据库集成测试"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"BillController 真实数据库集成测试 should not throw when calling getBills with empty data","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should not throw when calling getBills with empty data"}],"endTime":1762160883075,"message":"","name":"C:\\Users\\MH\\Desktop\\记账系统\\Server-side\\tests\\integration\\bill-controller-real-db.test.js","startTime":1762160882587,"status":"passed","summary":""}],"wasInterrupted":false}
