# 记账系统项目整体开发计划（实时同步版）

最后更新：2025-11-03  
当前版本：v1.0.0

## 一、项目概述

### 1.1 项目简介
记账系统是一个面向宿舍/室友费用分摊的智能记账平台，采用前后端分离架构，提供费用记录、智能分摊、账单生成与支付确认、争议处理、统计分析以及管理后台等完整能力。

### 1.2 项目目标
- 前端：提供友好高效的交互体验，支持费用管理、账单与支付确认、实时通知、统计分析等。
- 后端：提供稳定可靠的 API 服务，支持用户/房间/费用/账单/统计等核心业务，并提供 WebSocket 实时通知。
- 管理端：提供系统配置、用户与房间管理、审核与文档管理、统计监控等能力。

### 1.3 技术架构（以当前仓库为准）
- 前端技术栈：Vue 3.3.4 + Composition API + Element Plus 2.3.8 + Vite 4.4.5 + Pinia 2.1.6 + Vue Router 4.2.4 + Axios 1.4.0 + ECharts 6.0.0
- 后端技术栈：Node.js 16+/18+（engines>=18）+ Express 4.18.2 + PostgreSQL 14+ + Redis 6+（可选）+ WebSocket(ws 8.13.0) + Multer 2.0.2 + JWT + Winston + Helmet
- 管理端技术栈：Vue 3.3.4 + Element Plus 2.3.8 + Vite 4.4.5 + ECharts 6.0.0
- 其他：ESLint/Prettier、Jest+Supertest（后端测试）、Vitest（前端测试）

参考：`README.md`、`项目介绍与启动指南.md`、根 `package.json` 脚本

---

## 二、开发进度总览（与实际代码同步）

### 2.1 当前阶段
多数核心功能已实现，正在进行完善、测试与部署准备。

### 2.2 已完成功能
- ✅ 用户注册/登录（JWT 认证）
- ✅ 房间创建与管理（含邀请码加入）
- ✅ 费用记录与分类管理（多种费用类型）
- ✅ 多种分摊方式（平均/按天数/自定义/按面积）
- ✅ 账单生成与支付确认（含微信/支付宝收款码流程对接能力）
- ✅ 实时通知提醒（WebSocket）
- ✅ 费用统计与趋势分析（ECharts）
- ✅ 管理后台：用户/房间/系统配置、统计、审核、文档管理、日志与审计
- ✅ 项目脚手架与多应用并行开发脚本（根 `package.json` 的 `dev/build` 等）

来源：`README.md` 功能特性章节与目录结构、脚本

### 2.3 待完善与进行中
- ⏳ 测试覆盖率提升（单元/集成/端到端）与质量门禁
- ⏳ 性能优化（前端首屏/后端查询与缓存策略）
- ⏳ 安全与隐私完善（更严格的输入校验、审计策略、数据最小化）
- ⏳ 统计报表丰富度与可视化细节打磨
- ⏳ 云端部署与环境参数校验（Zeabur 配置、监控与备份策略）
- ⏳ 文档联动与一致性检查（接口说明与实现对齐）

---

## 三、里程碑与周期

总体目标周期为 45 天（初版计划），当前已完成“核心功能开发”大部分内容，进入“测试与部署”阶段。

- 阶段一：前端功能开发（已完成绝大部分）
- 阶段二：后端功能开发（已完成绝大部分）
- 阶段三：管理端功能开发（已完成主要页面与功能）
- 阶段四：测试与部署（进行中）

交付物现状：
- 代码与多应用目录结构稳定；
- 前后端主要业务链路贯通；
- 管理端具备基础运营能力；
- 待补齐测试覆盖、优化与部署文档细节。

---

## 四、分阶段任务清单（实时更新）

说明：以下清单与现状对齐，将“已完成/进行中/待办”明确标记；对尚未在仓库出现的接口或能力，标为“规划中”。

### 4.1 前端（Client application）
- 实时通知系统（WebSocket 客户端连接、事件订阅、自动重连）
  - 状态：已完成基本链路，优化中
- 用户认证与权限（登录/注册、角色与权限、个人资料）
  - 状态：已完成，细节优化中
- 房间管理（创建/加入、成员管理、信息展示、邀请码）
  - 状态：已完成
- 费用管理（创建/编辑、分摊明细展示、列表与详情）
  - 状态：已完成主要流程，体验打磨中
- 账单管理与支付（创建、支付确认、列表/详情、图表）
  - 状态：已完成主要流程
- 统计分析（开销趋势、成员对比、图表）
  - 状态：已完成基础图表，丰富中

### 4.2 后端（Server-side）
- 认证与用户服务（注册/登录、JWT、用户资料）
  - 状态：已完成
- 房间服务（创建/管理、成员关系、邀请码）
  - 状态：已完成
- 费用服务（记录/分类、分摊计算、审核流程基础）
  - 状态：已完成主要接口
- 账单与支付（账单生成、支付记录处理、状态跟踪）
  - 状态：已完成主要接口（见 README API）
- 统计服务（支出统计、数据分析接口）
  - 状态：已完成基础能力
- WebSocket 实时通信（事件订阅/发布）
  - 状态：已完成
- 收款码管理（上传/列表/启停/删除）
  - 状态：规划中（计划接口：`/api/user-qr-codes` 系列）

### 4.3 管理端（Admin panel）
- 文档管理（需求/数据库/接口文档维护）
  - 状态：已上线，完善中
- 系统管理（用户/房间、费用审计、规则配置）
  - 状态：已上线，优化中
- 审核与争议管理（流程监控、统计分析）
  - 状态：已上线基础能力
- 统计与监控（业务报表、性能指标）
  - 状态：基础已具备，继续完善

---

## 五、接口与事件（与现状对齐）

参考 `README.md` 已提供的主要接口：
- 认证：`/api/auth/register`、`/api/auth/login`、`/api/auth/logout`、`/api/auth/profile`
- 房间：`/api/rooms` CRUD、加入房间
- 费用：`/api/expenses` CRUD
- 账单：`/api/bills` CRUD、`POST /api/bills/:id/confirm`（支付确认）
- 费用类型：`/api/expense-types` CRUD
- 统计：`/api/stats/*`

规划中（新增接口，已在 README 标注为规划中并提供草案链接）：
- 收款码管理 API：
  - `POST /api/user-qr-codes`（上传）
  - `GET /api/user-qr-codes`（列表）
  - `PUT /api/user-qr-codes/{id}/status`（启停）
  - `DELETE /api/user-qr-codes/{id}`（删除）
- 支付流程补充：
  - `POST /api/bills/{id}/pay`（触发支付确认流程）
  - `POST /api/payments/{id}/confirm`（收款人二次确认）
- 详见：`Server-side/docs/QR_CODE_AND_PAYMENT_API_DRAFT.md`

WebSocket 事件（现有：通知与状态更新；规划补充）：
- 规划新增：`payment_confirmed`、`qr_code_uploaded`、`payment_status_changed`

---

## 六、质量与安全

### 6.1 代码质量
- ESLint + Prettier 一致化
- 后端：Jest + Supertest；前端：Vitest（按模块补齐测试）
- 目标覆盖率：单元 > 90%，集成 > 85%

### 6.2 性能指标（目标）
- 前端首屏 < 2s（本地开发环境下）
- API P95 响应 < 500ms
- 图表渲染首屏 < 1s

### 6.3 安全基线
- Helmet、输入校验、XSS/CSRF/SQL 注入防护
- 凭证与敏感信息隔离（.env）、最小权限访问控制
- 文件上传校验（收款码等）与日志审计

---

## 七、部署与运维

### 7.1 本地与脚本
- 根脚本：
  - `npm run dev`：并行启动后端、前端与管理端
  - `npm run build:all`：构建前端与管理端
  - `npm run start:prod`：启动后端生产模式
- 子项目脚本：参考各目录 `package.json`

### 7.2 环境参数
- 后端环境变量：`Server-side/.env.*`（`PORT`、`DB_*`、`REDIS_URL`、`JWT_SECRET` 等）
- 访问地址（本地默认）：
  - 前端：http://localhost:8000
  - 后端：http://localhost:4000（健康检查：/health）
  - 管理端：http://localhost:8100

### 7.3 云端部署（规划）
- Zeabur 云平台部署：按 `zeabur-deploy-guide.md` 与后端部署文档完善
- 监控与备份：增加日志采集、性能指标与数据库备份策略

---

## 八、当前风险与对策
- 接口文档与实现存在漂移风险 → 建立自动化同步/校验清单
- 测试覆盖不足 → 制定模块化补测计划与覆盖率门槛
- 性能与资源消耗 → 引入缓存策略与慢查询优化
- 部署一致性 → 标准化环境变量与启动脚本，自检清单

---

## 九、下一步行动（两周内）
1. 明确“收款码管理 API”和“支付流程补充 API”的落地范围并对齐 README（已完成：见 README 收款码/支付流程小节）
2. 提升后端核心模块（账单/费用/房间）单元与集成测试覆盖率（进行中：新增支付/收款码/房间/费用集成测试骨架）
3. 前端图表与账单/支付流程的细节打磨与可用性测试（未开始）
4. 完成 Zeabur 初次部署与基础监控/备份配置（未开始）
5. 同步更新 API 文档与管理端文档页面，确保一致性（进行中）

---

更新记录：
- 2025-11-03：完成 README 中“收款码管理/支付流程”端点对齐；标注已完成与进行中项；新增房间/费用/账单集成测试骨架；测试DB初始化切换为SQL脚本。

以上内容已根据当前仓库文件与脚本实时校准，后续将随代码变更继续更新本计划。