# 请假记录管理接口设计

## 1. 获取请假记录列表
- **接口地址**: `/admin/leave-records`
- **请求方法**: `GET`
- **接口描述**: 获取请假记录列表，支持分页和筛选
- **请求参数**:
  ```json
  {
    "page": "number", // 页码，可选，默认1
    "limit": "number", // 每页数量，可选，默认20
    "user_id": "number", // 用户ID，可选
    "status": "string", // 状态筛选，可选：pending/approved/rejected/cancelled
    "start_date": "string", // 开始日期，可选，格式：YYYY-MM-DD
    "end_date": "string", // 结束日期，可选，格式：YYYY-MM-DD
    "keyword": "string" // 关键词搜索，可选（搜索用户名、请假原因等）
  }
  ```
- **返回结果**:
  ```json
  {
    "success": true,
    "data": {
      "leave_records": [
        {
          "id": "number",
          "user_id": "number",
          "username": "string",
          "leave_type": "string", // 请假类型：annual/sick/personal/maternity/paternity/others
          "start_date": "string", // 开始日期，格式：YYYY-MM-DD
          "end_date": "string", // 结束日期，格式：YYYY-MM-DD
          "days": "number", // 请假天数
          "reason": "string", // 请假原因
          "status": "string", // 状态：pending/approved/rejected/cancelled
          "approved_by": "number", // 审批人ID
          "approved_by_name": "string", // 审批人姓名
          "approved_at": "string", // 审批时间
          "created_at": "string", // 申请时间
          "updated_at": "string" // 更新时间
        }
      ],
      "pagination": {
        "page": "number",
        "limit": "number",
        "total": "number",
        "total_pages": "number"
      }
    }
  }
  ```
- **错误处理**:
  - 401: 未授权访问
  - 403: 权限不足
  - 500: 服务器内部错误
- **说明**: 需要管理员权限或请假记录查看权限

## 2. 获取请假记录详情
- **接口地址**: `/admin/leave-records/{id}`
- **请求方法**: `GET`
- **接口描述**: 获取指定请假记录的详细信息
- **请求参数**:
  ```json
  {
    "id": "number" // 请假记录ID（路径参数）
  }
  ```
- **返回结果**:
  ```json
  {
    "success": true,
    "data": {
      "leave_record": {
        "id": "number",
        "user_id": "number",
        "username": "string",
        "employee_id": "string", // 员工编号
        "department": "string", // 部门
        "position": "string", // 职位
        "leave_type": "string", // 请假类型
        "start_date": "string",
        "end_date": "string",
        "days": "number",
        "reason": "string",
        "attachments": [ // 附件列表
          {
            "id": "number",
            "name": "string",
            "url": "string"
          }
        ],
        "status": "string",
        "approver_id": "number",
        "approver_name": "string",
        "approved_at": "string",
        "approval_notes": "string", // 审批备注
        "created_at": "string",
        "updated_at": "string"
      }
    }
  }
  ```
- **错误处理**:
  - 401: 未授权访问
  - 403: 权限不足
  - 404: 请假记录不存在
  - 500: 服务器内部错误
- **说明**: 需要管理员权限或请假记录查看权限

## 3. 创建请假记录
- **接口地址**: `/admin/leave-records`
- **请求方法**: `POST`
- **接口描述**: 创建新的请假记录
- **请求参数**:
  ```json
  {
    "user_id": "number", // 用户ID，必填
    "leave_type": "string", // 请假类型，必填
    "start_date": "string", // 开始日期，必填，格式：YYYY-MM-DD
    "end_date": "string", // 结束日期，必填，格式：YYYY-MM-DD
    "reason": "string", // 请假原因，必填
    "attachments": ["string"] // 附件URL列表，可选
  }
  ```
- **返回结果**:
  ```json
  {
    "success": true,
    "data": {
      "leave_record": {
        "id": "number",
        "user_id": "number",
        "username": "string",
        "leave_type": "string",
        "start_date": "string",
        "end_date": "string",
        "days": "number",
        "reason": "string",
        "status": "pending", // 默认状态为待审批
        "created_at": "string",
        "updated_at": "string"
      }
    }
  }
  ```
- **错误处理**:
  - 400: 请求参数错误
  - 401: 未授权访问
  - 403: 权限不足
  - 500: 服务器内部错误
- **说明**: 需要管理员权限或请假记录创建权限

## 4. 更新请假记录
- **接口地址**: `/admin/leave-records/{id}`
- **请求方法**: `PUT`
- **接口描述**: 更新请假记录信息
- **请求参数**:
  ```json
  {
    "id": "number", // 请假记录ID（路径参数）
    "leave_type": "string", // 请假类型，可选
    "start_date": "string", // 开始日期，可选
    "end_date": "string", // 结束日期，可选
    "reason": "string", // 请假原因，可选
    "attachments": ["string"] // 附件URL列表，可选
  }
  ```
- **返回结果**:
  ```json
  {
    "success": true,
    "data": {
      "leave_record": {
        "id": "number",
        "user_id": "number",
        "username": "string",
        "leave_type": "string",
        "start_date": "string",
        "end_date": "string",
        "days": "number",
        "reason": "string",
        "status": "string",
        "created_at": "string",
        "updated_at": "string"
      }
    }
  }
  ```
- **错误处理**:
  - 400: 请求参数错误
  - 401: 未授权访问
  - 403: 权限不足
  - 404: 请假记录不存在
  - 500: 服务器内部错误
- **说明**: 需要管理员权限或请假记录编辑权限，只有状态为pending的记录才能更新

## 5. 删除请假记录
- **接口地址**: `/admin/leave-records/{id}`
- **请求方法**: `DELETE`
- **接口描述**: 删除请假记录
- **请求参数**:
  ```json
  {
    "id": "number" // 请假记录ID（路径参数）
  }
  ```
- **返回结果**:
  ```json
  {
    "success": true,
    "data": {
      "message": "请假记录删除成功"
    }
  }
  ```
- **错误处理**:
  - 401: 未授权访问
  - 403: 权限不足
  - 404: 请假记录不存在
  - 409: 已审批的请假记录不能删除
  - 500: 服务器内部错误
- **说明**: 需要管理员权限或请假记录删除权限，只有状态为pending的记录才能删除

## 6. 审批请假记录
- **接口地址**: `/admin/leave-records/{id}/approve`
- **请求方法**: `POST`
- **接口描述**: 审批请假记录
- **请求参数**:
  ```json
  {
    "id": "number", // 请假记录ID（路径参数）
    "status": "string", // 审批结果，必填：approved/rejected
    "approval_notes": "string" // 审批备注，可选
  }
  ```
- **返回结果**:
  ```json
  {
    "success": true,
    "data": {
      "leave_record": {
        "id": "number",
        "user_id": "number",
        "username": "string",
        "leave_type": "string",
        "start_date": "string",
        "end_date": "string",
        "days": "number",
        "reason": "string",
        "status": "string", // 更新后的状态
        "approved_by": "number", // 审批人ID
        "approved_by_name": "string", // 审批人姓名
        "approved_at": "string", // 审批时间
        "approval_notes": "string", // 审批备注
        "created_at": "string",
        "updated_at": "string"
      }
    }
  }
  ```
- **错误处理**:
  - 400: 请求参数错误
  - 401: 未授权访问
  - 403: 权限不足
  - 404: 请假记录不存在
  - 409: 请假记录状态不是pending，不能审批
  - 500: 服务器内部错误
- **说明**: 需要管理员权限或请假审批权限

## 7. 批量审批请假记录
- **接口地址**: `/admin/leave-records/batch-approve`
- **请求方法**: `POST`
- **接口描述**: 批量审批请假记录
- **请求参数**:
  ```json
  {
    "record_ids": ["number"], // 请假记录ID列表，必填
    "status": "string", // 审批结果，必填：approved/rejected
    "approval_notes": "string" // 审批备注，可选
  }
  ```
- **返回结果**:
  ```json
  {
    "success": true,
    "data": {
      "success_count": "number", // 成功审批数量
      "failure_count": "number", // 失败数量
      "failed_items": [ // 失败项目
        {
          "id": "number",
          "error": "string"
        }
      ]
    }
  }
  ```
- **错误处理**:
  - 400: 请求参数错误
  - 401: 未授权访问
  - 403: 权限不足
  - 500: 服务器内部错误
- **说明**: 需要管理员权限或请假审批权限

## 8. 导出请假记录
- **接口地址**: `/admin/leave-records/export`
- **请求方法**: `GET`
- **接口描述**: 导出请假记录为Excel文件
- **请求参数**:
  ```json
  {
    "status": "string", // 状态筛选，可选
    "start_date": "string", // 开始日期，可选
    "end_date": "string", // 结束日期，可选
    "user_id": "number" // 用户ID，可选
  }
  ```
- **返回结果**:
  ```json
  {
    "success": true,
    "data": {
      "download_url": "string", // 下载链接
      "expires_at": "string" // 链接过期时间
    }
  }
  ```
- **错误处理**:
  - 400: 请求参数错误
  - 401: 未授权访问
  - 403: 权限不足
  - 500: 服务器内部错误
- **说明**: 需要管理员权限或请假记录导出权限

## 9. 获取请假统计
- **接口地址**: `/admin/leave-records/stats`
- **请求方法**: `GET`
- **接口描述**: 获取请假统计数据
- **请求参数**:
  ```json
  {
    "start_date": "string", // 开始日期，可选
    "end_date": "string", // 结束日期，可选
    "user_id": "number" // 用户ID，可选
  }
  ```
- **返回结果**:
  ```json
  {
    "success": true,
    "data": {
      "total_records": "number", // 总记录数
      "pending_count": "number", // 待审批数量
      "approved_count": "number", // 已批准数量
      "rejected_count": "number", // 已拒绝数量
      "cancelled_count": "number", // 已取消数量
      "leave_type_stats": [ // 按请假类型统计
        {
          "type": "string",
          "count": "number",
          "days": "number" // 总天数
        }
      ],
      "monthly_stats": [ // 按月统计
        {
          "month": "string", // 月份，格式：YYYY-MM
          "count": "number",
          "days": "number"
        }
      ],
      "user_stats": [ // 按用户统计（前10名）
        {
          "user_id": "number",
          "username": "string",
          "count": "number",
          "days": "number"
        }
      ]
    }
  }
  ```
- **错误处理**:
  - 401: 未授权访问
  - 403: 权限不足
  - 500: 服务器内部错误
- **说明**: 需要管理员权限或请假统计查看权限

## 10. 获取请假类型列表
- **接口地址**: `/admin/leave-records/types`
- **请求方法**: `GET`
- **接口描述**: 获取系统支持的请假类型列表
- **请求参数**: 无
- **返回结果**:
  ```json
  {
    "success": true,
    "data": {
      "leave_types": [
        {
          "key": "string", // 类型键名
          "name": "string", // 类型名称
          "description": "string" // 描述
        }
      ]
    }
  }
  ```
- **错误处理**:
  - 401: 未授权访问
  - 403: 权限不足
  - 500: 服务器内部错误
- **说明**: 需要管理员权限或请假记录查看权限

## 附录：状态说明

| 状态 | 说明 |
|------|------|
| pending | 待审批 |
| approved | 已批准 |
| rejected | 已拒绝 |
| cancelled | 已取消 |

## 附录：请假类型说明

| 类型 | 说明 |
|------|------|
| annual | 年假 |
| sick | 病假 |
| personal | 事假 |
| maternity | 产假 |
| paternity | 陪产假 |
| others | 其他 |

---
文档版本: v1.0
最后更新: 2023-12-31