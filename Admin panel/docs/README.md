# 管理端文档

## 📋 文档一致性更新状态

### 已更新文档
- [x] 数据库设计文档.md - 已与统一数据库设计.sql保持一致
- [x] 前端接口.txt - 已更新为最新API接口
- [x] 管理端接口.txt - 已更新为最新API接口
- [x] 支付码功能开发计划.md - 已更新为已完成状态
- [x] README.md - 已更新项目概述和文档状态

### 待更新文档
- [ ] API接口详细说明文档
- [ ] 部署文档
- [ ] 用户手册

## 📖 项目概述

寝室费用分摊记账系统管理端是基于Vue 3和Element Plus构建的管理后台，提供系统管理、数据统计、用户管理等功能。管理端采用响应式设计，支持多设备访问，提供直观的数据可视化和操作界面。

### 主要功能

1. **仪表板**
   - 系统概览
   - 关键指标展示
   - 实时数据更新

2. **用户管理**
   - 用户列表查看
   - 用户信息编辑
   - 用户权限管理
   - 用户状态管理

3. **房间管理**
   - 房间列表查看
   - 房间信息管理
   - 房间成员管理

4. **账单管理**
   - 账单列表查看
   - 账单详情查看
   - 账单统计分析

5. **费用管理**
   - 费用类型管理
   - 费用统计分析
   - 费用趋势图表

6. **支付码管理**
   - 支付码列表查看
   - 支付码状态管理
   - 支付统计分析

7. **系统设置**
   - 系统参数配置
   - 权限角色管理
   - 系统日志查看

## 🛠 技术栈

### 前端框架
- **Vue 3**: 渐进式JavaScript框架
- **Element Plus**: Vue 3 UI组件库
- **Pinia**: Vue状态管理库
- **Vue Router**: Vue官方路由管理器

### 数据可视化
- **ECharts**: 数据可视化图表库
- **Vue-ECharts**: Vue的ECharts封装

### 工具库
- **Axios**: HTTP客户端
- **Day.js**: 日期处理库
- **Lodash**: 实用工具库
- **XLSX**: Excel文件处理库

### 构建工具
- **Vite**: 现代前端构建工具
- **ESLint**: 代码质量检查工具
- **Prettier**: 代码格式化工具

## 🔄 WebSocket实时通信

管理端通过WebSocket与服务器建立实时连接，实现以下功能：

1. **实时数据更新**
   - 账单状态变化
   - 支付状态更新
   - 用户活动状态

2. **系统通知**
   - 新账单提醒
   - 支付成功通知
   - 系统消息推送

3. **实时监控**
   - 在线用户统计
   - 系统性能监控
   - 异常告警

### WebSocket事件类型

- `expense_created` - 费用记录创建
- `expense_updated` - 费用记录更新
- `bill_created` - 账单创建
- `payment_created` - 支付记录创建
- `review_status_updated` - 审核状态更新
- `dispute_processed` - 争议处理
- `notification` - 通用通知

### 客户端使用示例

```javascript
import websocketClient from '@/utils/websocket-client';

// 连接到WebSocket服务器
websocketClient.connect();

// 订阅事件
websocketClient.subscribe(['expenses', 'bills']);

// 监听事件
websocketClient.on('expense_created', (data) => {
  console.log('新费用记录:', data);
});

// 发送消息
websocketClient.send({
  type: 'subscribe',
  events: ['payments']
});
```

## ⚙️ 环境配置说明

本项目支持开发和生产两种环境，通过不同的环境配置文件来区分使用的数据库。

### 端口配置
- **管理端应用**: http://localhost:8100
- **客户端应用**: http://localhost:8000
- **后端API**: http://localhost:4000
- **健康检查**: http://localhost:4000/health

### 环境配置文件

1. `Server-side/.env.development` - 开发环境配置（使用测试数据库）
2. `Server-side/.env.production` - 生产环境配置（使用真实数据库）

### 数据库环境分离

根据项目需求，系统采用双数据库架构：

- **开发环境**: 使用测试数据库，仅用于系统开发和测试
  - 包含模拟测试数据
  - 表结构与生产数据库完全一致
  - 开发人员可以自由操作，不会影响真实用户数据

- **生产环境**: 使用真实用户数据库，用于部署后处理真实业务数据
  - 包含实际用户数据
  - 实施严格的安全防护措施
  - 系统管理员严格禁止接触任何真实业务数据

### 环境切换方式

```bash
# 进入服务器端目录
cd Server-side

# 开发环境
NODE_ENV=development npm start

# 生产环境
NODE_ENV=production npm start

# 开发环境（使用nodemon自动重启）
npm run dev
```

### 配置说明

#### 开发环境配置
- **数据库**: PostgreSQL 13.0+ (测试数据库)
- **数据库名称**: `dormitory_accounting_dev`
- **用途**: 开发和测试阶段使用
- **数据特点**: 包含模拟测试数据，可随意操作

#### 生产环境配置
- **数据库**: PostgreSQL 13.0+ (生产数据库)
- **数据库名称**: `dormitory_accounting`
- **用途**: 部署后处理真实用户数据
- **数据特点**: 包含实际业务数据，需要严格保护

### 数据库初始化

项目提供了数据库初始化脚本：

```bash
# 进入服务器端目录
cd Server-side

# 初始化测试数据库
npm run init:testdb

# 初始化生产数据库
npm run init:proddb
```

## 🛠 技术栈

### 前端框架
- **Vue 3**: 渐进式JavaScript框架
- **Element Plus**: Vue 3 UI组件库
- **Pinia**: Vue状态管理库
- **Vue Router**: Vue官方路由管理器

### 数据可视化
- **ECharts**: 数据可视化图表库
- **Vue-ECharts**: Vue的ECharts封装

### 工具库
- **Axios**: HTTP客户端
- **Day.js**: 日期处理库
- **Lodash**: 实用工具库
- **XLSX**: Excel文件处理库

### 构建工具
- **Vite**: 现代前端构建工具
- **ESLint**: 代码质量检查工具
- **Prettier**: 代码格式化工具

### 后端技术栈
- **后端**: Node.js + Express + PostgreSQL + Redis
- **数据库**: PostgreSQL 13.0+ (主数据库), Redis 6.0+ (缓存数据库)
- **实时通信**: WebSocket (Socket.IO)
- **部署平台**: Zeabur

## 📊 功能特性

1. **仪表板**
   - 系统概览
   - 关键指标展示
   - 实时数据更新

2. **用户管理**
   - 用户列表查看
   - 用户信息编辑
   - 用户权限管理
   - 用户状态管理

3. **房间管理**
   - 房间列表查看
   - 房间信息管理
   - 房间成员管理

4. **账单管理**
   - 账单列表查看
   - 账单详情查看
   - 账单统计分析

5. **费用管理**
   - 费用类型管理
   - 费用统计分析
   - 费用趋势图表

6. **支付码管理**
   - 支付码列表查看
   - 支付码状态管理
   - 支付统计分析

7. **系统设置**
   - 系统参数配置
   - 权限角色管理
   - 系统日志查看

## 📈 开发进度

### 已完成 ✅
- 项目基础架构搭建（Vue 3 + Composition API）
- 数据库设计完成（PostgreSQL迁移完成）
- API接口设计完成
- 前端组件框架搭建
- 支付码功能开发完成
- WebSocket实时通信功能
- 用户管理模块
- 房间管理模块
- 账单管理模块
- 费用管理模块
- 数据可视化图表
- 响应式布局

### 进行中 ⏳
- 智能分摊算法优化
- 高级统计分析功能
- 系统性能优化
- 单元测试完善

### 待开发 📋
- 系统集成测试
- 生产环境部署
- 部署文档编写
- 用户手册编写
- 性能监控与优化
- 数据导入导出功能

## 🔐 系统角色与数据访问权限

根据项目规范，系统设置了严格的权限控制：

1. **系统管理员**:
   - 仅具备系统维护相关权限
   - 严格禁止接触任何真实业务数据和用户个人信息
   - 只能访问经过脱敏处理的统计数据和系统管理信息

2. **其他角色** (管理员、寝室长、缴费人、普通用户):
   - 根据角色分配相应的业务数据访问权限
   - 在生产环境中访问真实业务数据
   - 在开发环境中访问测试数据

### 注意事项

1. 确保在不同环境中使用对应的数据库配置
2. 开发过程中不应访问生产数据库
3. 生产环境中系统管理员角色严格禁止接触任何真实业务数据
4. 两个数据库的表结构必须保持完全一致
5. 定期备份生产数据库，确保数据安全
6. 在开发环境中测试所有功能后再部署到生产环境