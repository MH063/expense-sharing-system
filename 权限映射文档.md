# 用户角色与页面权限映射文档

## 角色定义

| 角色代码 | 角色名称 | 描述 |
|---------|---------|------|
| sysadmin | 系统管理员 | 拥有系统所有权限，可以管理所有数据和设置 |
| admin | 管理员 | 管理寝室、费用和账单，但不能修改系统级设置 |
| room_leader | 寝室长 | 管理特定寝室的成员、费用和账单 |
| payer | 缴费人 | 可以查看和创建费用、账单记录 |
| user | 普通用户 | 基本权限，可以查看和创建自己的费用、账单 |
| guest | 访客 | 未登录用户，只能访问公开页面 |

## 权限定义

### 系统级权限

| 权限代码 | 权限名称 | 描述 |
|---------|---------|------|
| admin.access | 管理员访问 | 访问管理后台 |
| admin.roles.assign | 分配角色 | 分配和管理用户角色 |
| admin.users.read | 查看用户 | 查看用户列表和详情 |
| system.admin | 系统管理 | 系统级管理权限 |

### 寝室级权限

| 权限代码 | 权限名称 | 描述 |
|---------|---------|------|
| room:create | 创建寝室 | 创建新的寝室 |
| room:view | 查看寝室 | 查看寝室信息和成员列表 |
| room:edit | 编辑寝室 | 修改寝室信息 |
| room:delete | 删除寝室 | 删除寝室 |
| room:invite | 邀请成员 | 邀请新成员加入寝室 |
| room:manage | 管理寝室 | 全面管理寝室 |
| room:join | 加入寝室 | 申请加入寝室 |

### 成员管理权限

| 权限代码 | 权限名称 | 描述 |
|---------|---------|------|
| member:manage | 管理成员 | 全面管理寝室成员 |
| member:invite | 邀请成员 | 邀请新成员 |
| member:remove | 移除成员 | 从寝室移除成员 |
| member:role.change | 更改角色 | 修改成员在寝室中的角色 |

### 费用相关权限

| 权限代码 | 权限名称 | 描述 |
|---------|---------|------|
| expense:create | 创建费用 | 创建新的费用记录 |
| expense:view | 查看费用 | 查看费用记录 |
| expense:edit | 编辑费用 | 修改费用记录 |
| expense:delete | 删除费用 | 删除费用记录 |

### 账单相关权限

| 权限代码 | 权限名称 | 描述 |
|---------|---------|------|
| bill:create | 创建账单 | 创建新的账单 |
| bill:view | 查看账单 | 查看账单详情 |
| bill:edit | 编辑账单 | 修改账单信息 |
| bill:delete | 删除账单 | 删除账单 |
| bill:pay | 支付账单 | 支付账单 |

### 个人信息权限

| 权限代码 | 权限名称 | 描述 |
|---------|---------|------|
| profile:view | 查看资料 | 查看个人资料 |
| profile:edit | 编辑资料 | 修改个人资料 |

### 请假记录权限

| 权限代码 | 权限名称 | 描述 |
|---------|---------|------|
| leave_record:create | 创建请假 | 创建请假记录 |
| leave_record:view | 查看请假 | 查看请假记录 |
| leave_record:edit | 编辑请假 | 修改请假记录 |
| leave_record:delete | 删除请假 | 删除请假记录 |
| leave_record:approve | 审批请假 | 审批请假申请 |

## 角色权限映射

### 系统管理员 (sysadmin)
拥有所有权限，包括：
- 所有系统级权限
- 所有寝室级权限
- 所有成员管理权限
- 所有费用相关权限
- 所有账单相关权限
- 所有个人信息权限
- 所有请假记录权限

### 管理员 (admin)
拥有以下权限：
- admin.access (管理员访问)
- 所有寝室级权限 (除 room:delete)
- 所有成员管理权限
- 所有费用相关权限
- 所有账单相关权限
- 所有个人信息权限

### 寝室长 (room_leader)
拥有以下权限：
- room:view (查看寝室)
- room:edit (编辑寝室)
- room:invite (邀请成员)
- 所有费用相关权限
- 所有账单相关权限
- 所有个人信息权限

### 缴费人 (payer)
拥有以下权限：
- room:view (查看寝室)
- 所有费用相关权限
- 所有账单相关权限
- 所有个人信息权限

### 普通用户 (user)
拥有以下权限：
- room:view (查看寝室)
- expense:view (查看费用)
- expense:create (创建费用)
- bill:view (查看账单)
- bill:create (创建账单)
- bill:pay (支付账单)
- profile:view (查看资料)
- profile:edit (编辑资料)

### 访客 (guest)
拥有以下权限：
- profile:view (查看资料)

## 页面权限映射

### 认证相关页面
- `/auth/login` - 仅访客可访问
- `/auth/register` - 仅访客可访问
- `/auth/forgot-password` - 仅访客可访问

### 仪表盘页面
- `/dashboard` - 需要登录

### 个人资料页面
- `/profile` - 需要 `profile:view` 权限

### 寝室相关页面
- `/rooms` - 需要 `room:view` 权限
- `/rooms/create` - 需要 `room:create` 权限
- `/rooms/:roomId` - 需要对应寝室的 `room:view` 权限
- `/rooms/:roomId/invitations` - 需要对应寝室的 `room:invite` 权限

### 费用相关页面
- `/expenses` - 需要 `expense:view` 权限
- `/expenses/create` - 需要 `expense:create` 权限
- `/expenses/:expenseId` - 需要 `expense:view` 权限

### 账单相关页面
- `/bills` - 需要 `bill:view` 权限
- `/bills/list` - 需要 `bill:view` 权限
- `/bills/create` - 需要 `bill:create` 权限
- `/bills/:billId` - 需要 `bill:view` 权限
- `/bills/:billId/edit` - 需要 `bill:edit` 权限
- `/bills/:billId/payment` - 需要 `bill:pay` 权限

### 管理相关页面
- `/admin/permissions` - 需要 `admin.access` 权限
- `/admin/users` - 需要 `admin.users.read` 权限
- `/admin/roles` - 需要 `admin.roles.assign` 权限

## 权限检查机制

系统通过以下方式实现权限控制：

1. **路由守卫** - 在路由跳转前检查用户是否有权限访问目标页面
2. **权限指令** - 在组件中使用 `v-permission` 指令控制元素显示
3. **权限方法** - 在组件方法中调用 `checkPermission` 方法进行权限检查
4. **API权限** - 后端API也会验证用户权限，确保前后端权限一致

## 权限升级流程

1. 用户登录后，系统根据用户角色获取对应权限列表
2. 权限列表存储在Pinia store中，供全局访问
3. 用户角色变更时，重新获取权限列表并更新store
4. 权限变更后，触发权限更新事件，通知相关组件重新渲染

## 特殊权限处理

1. **资源所有者** - 用户对自己创建的资源拥有额外权限
2. **寝室权限** - 用户在不同寝室可能有不同权限
3. **临时权限** - 可以通过特殊授权给予用户临时权限
4. **权限继承** - 高级角色自动拥有低级角色的所有权限